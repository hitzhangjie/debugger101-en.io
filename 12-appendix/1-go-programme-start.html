
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>12.1 Go Program Startup Process · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="2-auto-trace-cloned-threads.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../2-preface/">
            
                <a href="../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../3-terms/">
            
                <a href="../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../4-basics/">
            
                <a href="../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../4-basics/1-purposes.html">
            
                <a href="../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../4-basics/2-dependencies.html">
            
                <a href="../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../4-basics/3-countertactics.html">
            
                <a href="../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../5-debugger-skeleton/">
            
                <a href="../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../6-develop-inst-debugger/">
            
                <a href="../6-develop-inst-debugger/">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../6-develop-inst-debugger/1-process_start.html">
            
                <a href="../6-develop-inst-debugger/1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../6-develop-inst-debugger/2-process_attach.html">
            
                <a href="../6-develop-inst-debugger/2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../6-develop-inst-debugger/3-process_start_attach.html">
            
                <a href="../6-develop-inst-debugger/3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../6-develop-inst-debugger/4-debug-session.html">
            
                <a href="../6-develop-inst-debugger/4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../6-develop-inst-debugger/5-disassemble.html">
            
                <a href="../6-develop-inst-debugger/5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../6-develop-inst-debugger/6-breakpoint.html">
            
                <a href="../6-develop-inst-debugger/6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../6-develop-inst-debugger/7-breakpoints.html">
            
                <a href="../6-develop-inst-debugger/7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../6-develop-inst-debugger/8-clear.html">
            
                <a href="../6-develop-inst-debugger/8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../6-develop-inst-debugger/9-clearall.html">
            
                <a href="../6-develop-inst-debugger/9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../6-develop-inst-debugger/10-step.html">
            
                <a href="../6-develop-inst-debugger/10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../6-develop-inst-debugger/11-continue.html">
            
                <a href="../6-develop-inst-debugger/11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../6-develop-inst-debugger/12-pmem.html">
            
                <a href="../6-develop-inst-debugger/12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../6-develop-inst-debugger/13-pregs.html">
            
                <a href="../6-develop-inst-debugger/13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../6-develop-inst-debugger/14-set-mem.html">
            
                <a href="../6-develop-inst-debugger/14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../6-develop-inst-debugger/15-set-regs.html">
            
                <a href="../6-develop-inst-debugger/15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../6-develop-inst-debugger/20-trace_new_threads.html">
            
                <a href="../6-develop-inst-debugger/20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../6-develop-inst-debugger/21-trace_old_threads.html">
            
                <a href="../6-develop-inst-debugger/21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../6-develop-inst-debugger/80-aslr.html">
            
                <a href="../6-develop-inst-debugger/80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../6-develop-inst-debugger/99-more.html">
            
                <a href="../6-develop-inst-debugger/99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../7-headto-sym-debugger/">
            
                <a href="../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../7-headto-sym-debugger/2-elf.html">
            
                <a href="../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../7-headto-sym-debugger/3-syms.html">
            
                <a href="../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../7-headto-sym-debugger/5-loading.html">
            
                <a href="../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../8-dwarf/">
            
                <a href="../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../8-dwarf/1-history.html">
            
                <a href="../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../8-dwarf/2-overview.html">
            
                <a href="../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../8-dwarf/3-dwarfdata.html">
            
                <a href="../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../8-dwarf/4-die/">
            
                <a href="../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../8-dwarf/4-die/4-encoding.html">
            
                <a href="../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../8-dwarf/5-other/">
            
                <a href="../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../8-dwarf/6-practices.html">
            
                <a href="../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../8-dwarf/7-summary.html">
            
                <a href="../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../9-develop-sym-debugger/">
            
                <a href="../9-develop-sym-debugger/">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../9-develop-sym-debugger/1-架构设计/">
            
                <a href="../9-develop-sym-debugger/1-架构设计/">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../9-develop-sym-debugger/2-核心调试逻辑/">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../9-develop-sym-debugger/3-高级功能扩展/">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../10-extras/">
            
                <a href="../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../10-extras/1-development-of-debugger.html">
            
                <a href="../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../10-extras/2-development-of-logging.html">
            
                <a href="../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../10-extras/3-development-of-metrics.html">
            
                <a href="../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../10-extras/4-development-of-tracing.html">
            
                <a href="../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../10-extras/5-development-of-bisect.html">
            
                <a href="../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../10-extras/6-development-of-ebpf.html">
            
                <a href="../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../10-extras/7-development-of-replay.html">
            
                <a href="../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../11-thanks/">
            
                <a href="../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="./">
            
                <a href="./">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.12.1" data-path="1-go-programme-start.html">
            
                <a href="1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="2-auto-trace-cloned-threads.html">
            
                <a href="2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="3-git-bisect.html">
            
                <a href="3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="80-go-tool-compile.html">
            
                <a href="80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="81-go-tool-asm.html">
            
                <a href="81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="82-go-tool-link.html">
            
                <a href="82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="90-why-buildid-loaded.html">
            
                <a href="90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="91-syntax-and-semantic-analysis.html">
            
                <a href="91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="92-why-gdb-uses-symtab.html">
            
                <a href="92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >12.1 Go Program Startup Process</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="go-runtime-go-program-startup-process">go runtime: Go Program Startup Process</h1>
<h2 id="overview-of-go-program-startup-process">Overview of Go Program Startup Process</h2>
<p>Let&apos;s examine the startup process of a Go program using the following source code as an example:</p>
<p><strong>file: main.go</strong></p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-keyword">func</span> main() {
    fmt.Println(<span class="hljs-string">&quot;vim-go&quot;</span>)
}
</code></pre>
<p>Run dlv for debugging and execute the program until main.main:</p>
<pre><code>$ dlv debug main.go
Type &apos;help&apos; for list of commands.
(dlv) b main.main
Breakpoint 1 set at 0x10d0faf for main.main() ./main.go:5
(dlv) c
&gt; main.main() ./main.go:5 (hits goroutine(1):1 total:1) (PC: 0x10d0faf)
     1:    package main
     2:    
     3:    import &quot;fmt&quot;
     4:    
=&gt;   5:    func main() {
     6:        fmt.Println(&quot;vim-go&quot;)
     7:    }
(dlv)
</code></pre><p>Let&apos;s look at the call stack:</p>
<pre><code class="lang-bash">(dlv) bt
0  0x00000000010d0faf <span class="hljs-keyword">in</span> main.main
   at ./main.go:5
1  0x000000000103aacf <span class="hljs-keyword">in</span> runtime.main
   at /usr/<span class="hljs-built_in">local</span>/go/src/runtime/proc.go:204
2  0x000000000106d021 <span class="hljs-keyword">in</span> runtime.goexit
   at /usr/<span class="hljs-built_in">local</span>/go/src/runtime/asm_amd64.s:1374
(dlv)
</code></pre>
<p>From this, we can see that the Go program starts up in the following sequence:</p>
<ol>
<li><p>asm_amd64.s:1374 runtime&#xB7;goexit:runtime&#xB7;goexit1(SB)</p>
</li>
<li><p>runtime/proc.go:204 runtime.main:fn()
Here, fn is the main.main from our test source program</p>
</li>
<li><p>Now PC is stopped at main.main, waiting for us to continue debugging.</p>
</li>
</ol>
<h2 id="pre-startup-initialization">Pre-Startup Initialization</h2>
<p>Here we discuss the pre-startup initialization, which refers to the operations before our entry function main.main is executed. Understanding this part will help establish a global understanding of Go and strengthen our knowledge of implementing Go debuggers.</p>
<h3 id="go-process-instantiation">Go Process Instantiation</h3>
<p>When we type <code>./prog</code> in the shell, the operating system instantiates an instance of the prog program, and the process starts. What happens during this process?</p>
<ul>
<li>First, the shell forks a child process (let&apos;s call it child shell);</li>
<li>The child shell then replaces the process&apos;s code, data, etc., by executing execvp;</li>
<li>Once everything is ready, the operating system hands the prepared process state to the scheduler for execution;</li>
</ul>
<p>Let&apos;s assume the current scheduler has selected our process and see what logic the Go process executes from startup.</p>
<p>When compiling C programs, we know that a source program is first compiled into *.o files, then linked with system-provided shared libraries and startup code to form the final executable. Linking can be done through internal linkage (static linking) or external linkage (dynamic linking).</p>
<p>Go programs are similar to C programs, with different linking methods. Refer to the <code>-linkmode</code> option description in <code>go tool link</code> for details. Typically, if there&apos;s no cgo, Go build by default produces internal linkage, which is why the size is slightly larger. This can be confirmed by checking the shared library dependencies with the system tool <code>ldd &lt;prog&gt;</code>, which will show an error <code>not dynamic executable</code>.</p>
<h3 id="go-process-startup-code">Go Process Startup Code</h3>
<p>After a Go program&apos;s process starts executing, its first instructions are the startup code, as shown below:</p>
<p><strong>file: asm_amd64.s</strong></p>
<pre><code class="lang-asm">// _rt0_amd64 is common startup code for most amd64 systems when using
// internal linking. This is the entry point for the program from the
// kernel for an ordinary -buildmode=exe program. The stack holds the
// number of arguments and the C-style argv.
TEXT _rt0_amd64(SB),NOSPLIT,$-8
    MOVQ    0(SP), DI    // argc
    LEAQ    8(SP), SI    // argv
    JMP    runtime&#xB7;rt0_go(SB)

// main is common startup code for most amd64 systems when using
// external linking. The C startup code will call the symbol &quot;main&quot;
// passing argc and argv in the usual C ABI registers DI and SI.
TEXT main(SB),NOSPLIT,$-8
    JMP    runtime&#xB7;rt0_go(SB)
</code></pre>
<p>The above is the startup code used when building Go programs with internal and external linkage respectively. When a Go process starts, it will first execute these instructions. The first one passes the process arguments argc and argv, then jumps to <code>runtime.rt0_go(SB)</code> for execution. The second one indicates that the C startup code will be responsible for passing argc and argv before calling main, then <code>runtime.rt0_go(SB)</code>.</p>
<p>Let&apos;s not discuss the impact of linkmode on startup code further and directly look at <code>runtime.rt0_go(SB)</code>.</p>
<h3 id="runtimert0gosb"><code>runtime.rt0_go(SB)</code></h3>
<p>The assembly code here is quite lengthy, so we&apos;ll omit most of it and only keep the important steps.</p>
<pre><code class="lang-asm">TEXT runtime&#xB7;rt0_go(SB),NOSPLIT,$0
    // copy arguments forward on an even stack
    ...

    // create istack out of the given (operating system) stack.
    ...

    // find out information about the processor we&apos;re on
    ...

    // others
    ...
ok:
    // set the per-goroutine and per-mach &quot;registers&quot;
    ...

    // save m-&gt;g0 = g0
    ...
    // save m0 to g0-&gt;m
    ...


    // copy argc
    ...
    // copy argv
    ...
    CALL    runtime&#xB7;args(SB)
    CALL    runtime&#xB7;osinit(SB)
    CALL    runtime&#xB7;schedinit(SB)

    // create a new goroutine to start program
    MOVQ    $runtime&#xB7;mainPC(SB), AX        // entry
    PUSHQ    AX
    PUSHQ    $0            // arg size
    CALL    runtime&#xB7;newproc(SB)
    POPQ    AX
    POPQ    AX

    // start this M
    CALL    runtime&#xB7;mstart(SB)

    CALL    runtime&#xB7;abort(SB)    // mstart should never return
    RET

    // Prevent dead-code elimination of debugCallV1, which is
    // intended to be called by debuggers.
    MOVQ    $runtime&#xB7;debugCallV1(SB), AX
    RET
</code></pre>
<p>We can see that after completing some initialization in the first half, it also performs these operations:</p>
<ol>
<li>copy argc, copy argv</li>
<li>call runtime&#xB7;args(SB), call runtime&#xB7;osinit(SB), call runtime&#xB7;schedinit(SB)</li>
<li>create a new goroutine to start program<ol>
<li>push entry: $runtime&#xB7;mainPC(SB)</li>
<li>push arg size: $0</li>
<li>call runtime&#xB7;newproc(SB)</li>
</ol>
</li>
<li>call runtime&#xB7;mstart(SB)</li>
</ol>
<p>These steps are the key parts of Go program startup that we&apos;re interested in. Let&apos;s look at them one by one.</p>
<blockquote>
<p>Note: To read Go assembly, you need to first read some basic knowledge. You can refer to <a href="https://golang.org/doc/asm" target="_blank">a quick guide to go&apos;s assembler</a>.</p>
<ul>
<li><code>FP</code>: Frame pointer: arguments and locals.</li>
<li><code>PC</code>: Program counter: jumps and branches.</li>
<li><code>SB</code>: Static base pointer: global symbols.</li>
<li><code>SP</code>: Stack pointer: top of stack.</li>
</ul>
<p>All user-defined symbols are written as offsets to the pseudo-registers <code>FP</code> (arguments and locals) and <code>SB</code> (globals).</p>
<p>The <code>SB</code> pseudo-register can be thought of as the origin of memory, so the symbol <code>foo(SB)</code> is the name <code>foo</code> as an address in memory. This form is used to name global functions and data. Adding <code>&lt;&gt;</code> to the name, as in <code>foo&lt;&gt;(SB)</code>, makes the name visible only in the current source file, like a top-level <code>static</code> declaration in a C file. Adding an offset to the name refers to that offset from the symbol&apos;s address, so <code>foo+4(SB)</code> is four bytes past the start of <code>foo</code>.</p>
</blockquote>
<h4 id="call-runtime&#xB7;argssb">call runtime&#xB7;args(SB)</h4>
<p>Refers to the args function in the runtime package, which sets up argc, argv, and other parameters.</p>
<p><strong>file: runtime/runtime1.go</strong></p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> args(c <span class="hljs-keyword">int32</span>, v **<span class="hljs-keyword">byte</span>) {
    argc = c
    argv = v
    sysargs(c, v)
}
</code></pre>
<h4 id="runtime&#xB7;osinitsb">runtime&#xB7;osinit(SB)</h4>
<p>Refers to the osinit function in the runtime package, which handles system settings. We won&apos;t focus on this for now.</p>
<p><strong>file: runtime/os_linux.go</strong></p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> osinit() {
    ncpu = getproccount()
    physHugePageSize = getHugePageSize()
    osArchInit()
}
</code></pre>
<h4 id="call-runtime&#xB7;schedinitsb">call runtime&#xB7;schedinit(SB)</h4>
<p>Refers to the schedinit function in the runtime package, which prepares for scheduling execution.</p>
<pre><code class="lang-go"><span class="hljs-comment">// The bootstrap sequence is:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//    call osinit</span>
<span class="hljs-comment">//    call schedinit</span>
<span class="hljs-comment">//    make &amp; queue new G</span>
<span class="hljs-comment">//    call runtime&#xB7;mstart</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// The new G calls runtime&#xB7;main.</span>
<span class="hljs-keyword">func</span> schedinit() {
    <span class="hljs-comment">// lockInit is a no-op on Linux</span>
    ...

    <span class="hljs-comment">// raceinit must be the first call to race detector.</span>
    <span class="hljs-comment">// In particular, it must be done before mallocinit below calls racemapshadow.</span>

    <span class="hljs-comment">// @see https://github.com/golang/go/blob/master/src/runtime/HACKING.md</span>
    <span class="hljs-comment">// Reference for getg() explanation: This should be running on the system stack, </span>
    <span class="hljs-comment">// the returned _g_ should be the g0 of the current M</span>
    _g_ := getg()
    <span class="hljs-keyword">if</span> raceenabled {
        _g_.racectx, raceprocctx0 = raceinit()
    }

    sched.maxmcount = <span class="hljs-number">10000</span>

    moduledataverify()
    stackinit()
    mallocinit()
    fastrandinit() <span class="hljs-comment">// must run before mcommoninit</span>
    mcommoninit(_g_.m, <span class="hljs-number">-1</span>)
    cpuinit()       <span class="hljs-comment">// must run before alginit</span>
    alginit()       <span class="hljs-comment">// maps must not be used before this call</span>
    modulesinit()   <span class="hljs-comment">// provides activeModules</span>
    typelinksinit() <span class="hljs-comment">// uses maps, activeModules</span>
    itabsinit()     <span class="hljs-comment">// uses activeModules</span>

    msigsave(_g_.m)
    initSigmask = _g_.m.sigmask

    goargs()
    goenvs()
    parsedebugvars()
    gcinit()

    lock(&amp;sched.lock)
    sched.lastpoll = <span class="hljs-keyword">uint64</span>(nanotime())
    procs := ncpu
    <span class="hljs-keyword">if</span> n, ok := atoi32(gogetenv(<span class="hljs-string">&quot;GOMAXPROCS&quot;</span>)); ok &amp;&amp; n &gt; <span class="hljs-number">0</span> {
        procs = n
    }
    procresize(procs)
    ...
    unlock(&amp;sched.lock)
    ...
}
</code></pre>
<h4 id="starting-runtimemain--mainmain">Starting runtime.main &amp; main.main</h4>
<p>After all the initialization work above, let&apos;s look at the most direct part of runtime.main startup:</p>
<pre><code class="lang-asm">    // create a new goroutine to start program
    MOVQ    $runtime&#xB7;mainPC(SB), AX        // entry
    PUSHQ    AX
    PUSHQ    $0            // arg size
    CALL    runtime&#xB7;newproc(SB)
    POPQ    AX
    POPQ    AX

    // start this M
    CALL    runtime&#xB7;mstart(SB)
</code></pre>
<p>Here, it first gets the address of the symbol <code>$runtime.mainPC(SB)</code> and puts it in AX. This is actually the entry address of the runtime.main function. Then it pushes the function call parameter argsize 0, because this function has no parameters.</p>
<pre><code class="lang-asm">DATA    runtime&#xB7;mainPC+0(SB)/8,$runtime&#xB7;main(SB)
GLOBL    runtime&#xB7;mainPC(SB),RODATA,$8
</code></pre>
<p>runtime&#xB7;main(SB) corresponds to the runtime.main function:</p>
<pre><code class="lang-go"><span class="hljs-comment">// The main goroutine.</span>
<span class="hljs-keyword">func</span> main() {
    g := getg()

    <span class="hljs-comment">// Racectx of m0-&gt;g0 is used only as the parent of the main goroutine.</span>
    <span class="hljs-comment">// It must not be used for anything else.</span>
    g.m.g0.racectx = <span class="hljs-number">0</span>

    <span class="hljs-comment">// Adjust goroutine stack size, maximum 1GB for 64-bit, 250M for 32-bit</span>
    ...

    <span class="hljs-comment">// Allow newproc to start new Ms.</span>
    mainStarted = <span class="hljs-literal">true</span>

    <span class="hljs-keyword">if</span> GOARCH != <span class="hljs-string">&quot;wasm&quot;</span> { <span class="hljs-comment">// no threads on wasm yet, so no sysmon</span>
        systemstack(<span class="hljs-keyword">func</span>() {
            <span class="hljs-comment">// Create new m and execute sysmon, -1 means no pre-specified m id</span>
            newm(sysmon, <span class="hljs-literal">nil</span>, <span class="hljs-number">-1</span>)
        })
    }

    <span class="hljs-comment">// Note, we&apos;re now executing the main goroutine, and the current thread is the main thread.</span>
    <span class="hljs-comment">// Calling this method will bind the main goroutine to the main thread,</span>
    <span class="hljs-comment">// meaning we can be certain that main.main will always run on the main thread, unless unbound later</span>
    lockOSThread()
    ...

    <span class="hljs-comment">// Here we execute the initialization logic of the runtime package:</span>
    <span class="hljs-comment">// - Each package has some imported dependencies, and these imported packages need initialization logic;</span>
    <span class="hljs-comment">// - Each package&apos;s internal func init() needs to be called after its dependencies are initialized;</span>
    doInit(&amp;runtime_inittask) <span class="hljs-comment">// must be before defer</span>
    ...

    <span class="hljs-comment">// Defer unlock so that runtime.Goexit during init does the unlock too.</span>
    needUnlock := <span class="hljs-literal">true</span>
    <span class="hljs-keyword">defer</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">if</span> needUnlock {
            unlockOSThread()
        }
    }()
    ...

    <span class="hljs-comment">// Before calling user-written program code, enable gc. Note that this doesn&apos;t create a separate thread for gc, maybe later</span>
    gcenable()

    main_init_done = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>)
    <span class="hljs-keyword">if</span> iscgo {
        ...
        <span class="hljs-comment">// Start the template thread in case we enter Go from</span>
        <span class="hljs-comment">// a C-created thread and need to create a new thread.</span>
        startTemplateThread()
        cgocall(_cgo_notify_runtime_init_done, <span class="hljs-literal">nil</span>)
    }

    <span class="hljs-comment">// Initialize main package, including its imported dependencies and func init() in the main package</span>
    doInit(&amp;main_inittask)
    <span class="hljs-comment">// main package initialization complete</span>
    <span class="hljs-built_in">close</span>(main_init_done)

    needUnlock = <span class="hljs-literal">false</span>

    <span class="hljs-comment">// Note, here we unbind the current goroutine from the thread again. It seems the Go designers</span>
    <span class="hljs-comment">// only wanted to perform certain initialization actions on the main thread, and didn&apos;t want to</span>
    <span class="hljs-comment">// treat the main goroutine specially afterward. The main goroutine, like other goroutines,</span>
    <span class="hljs-comment">// can be scheduled by the scheduler to run on other threads</span>
    unlockOSThread()

    <span class="hljs-comment">// If compiled as a static library or dynamic library, even though there&apos;s a main function, it can&apos;t be executed</span>
    <span class="hljs-keyword">if</span> isarchive || islibrary {
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// Note, calling main_main is actually main.main, see the go directive definition above:</span>
    <span class="hljs-comment">// //go:linkname main_main main.main, the call to main_main will transfer to main.main</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Since we&apos;ve already unbound the main goroutine from the main thread, the only thing we can be certain of</span>
    <span class="hljs-comment">// is that the main.main method is executed on the main goroutine, but not necessarily on the main thread</span>
    fn := main_main 
    fn()
    <span class="hljs-keyword">if</span> raceenabled {
        racefini()
    }

    <span class="hljs-comment">// When main.main ends, it means the entire program is ready to end.</span>
    <span class="hljs-comment">// If a panic occurs, it will notify all goroutines to print their stacks</span>
    <span class="hljs-keyword">if</span> atomic.Load(&amp;runningPanicDefers) != <span class="hljs-number">0</span> {
        <span class="hljs-comment">// Running deferred functions should not take long.</span>
        <span class="hljs-keyword">for</span> c := <span class="hljs-number">0</span>; c &lt; <span class="hljs-number">1000</span>; c++ {
            <span class="hljs-keyword">if</span> atomic.Load(&amp;runningPanicDefers) == <span class="hljs-number">0</span> {
                <span class="hljs-keyword">break</span>
            }
            Gosched()
        }
    }
    <span class="hljs-keyword">if</span> atomic.Load(&amp;panicking) != <span class="hljs-number">0</span> {
        gopark(<span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, waitReasonPanicWait, traceEvGoStop, <span class="hljs-number">1</span>)
    }

    exit(<span class="hljs-number">0</span>)
    ...
}
</code></pre>
<p>Here we&apos;ve analyzed the startup process of a Go program and can draw a very important conclusion:</p>
<blockquote>
<p>The main.main method is executed by the main goroutine, but the main goroutine is not necessarily scheduled by the main thread.</p>
<p>There is no default binding relationship between the main goroutine and the main thread!</p>
</blockquote>
<p>Understanding this is very important, as it will help us understand why the main method doesn&apos;t stop when using <code>godbg attach &lt;pid&gt;</code>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: 12 Appendix">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="2-auto-trace-cloned-threads.html" class="navigation navigation-next " aria-label="Next page: 12.2 Automatic Thread Tracing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"12.1 Go Program Startup Process","level":"1.12.1","depth":2,"next":{"title":"12.2 Automatic Thread Tracing","level":"1.12.2","depth":2,"path":"12-appendix/2-auto-trace-cloned-threads.md","ref":"12-appendix/2-auto-trace-cloned-threads.md","articles":[]},"previous":{"title":"12 Appendix","level":"1.12","depth":1,"path":"12-appendix/README.md","ref":"12-appendix/README.md","articles":[{"title":"12.1 Go Program Startup Process","level":"1.12.1","depth":2,"path":"12-appendix/1-go-programme-start.md","ref":"12-appendix/1-go-programme-start.md","articles":[]},{"title":"12.2 Automatic Thread Tracing","level":"1.12.2","depth":2,"path":"12-appendix/2-auto-trace-cloned-threads.md","ref":"12-appendix/2-auto-trace-cloned-threads.md","articles":[]},{"title":"12.3 git bisect","level":"1.12.3","depth":2,"path":"12-appendix/3-git-bisect.md","ref":"12-appendix/3-git-bisect.md","articles":[]},{"title":"12.10 Compilation Toolchain/compile","level":"1.12.4","depth":2,"path":"12-appendix/80-go-tool-compile.md","ref":"12-appendix/80-go-tool-compile.md","articles":[]},{"title":"12.11 Compilation Toolchain/asm","level":"1.12.5","depth":2,"path":"12-appendix/81-go-tool-asm.md","ref":"12-appendix/81-go-tool-asm.md","articles":[]},{"title":"12.12 Compilation Toolchain/link","level":"1.12.6","depth":2,"path":"12-appendix/82-go-tool-link.md","ref":"12-appendix/82-go-tool-link.md","articles":[]},{"title":"12.13 More: GNU build-id+gobuildid","level":"1.12.7","depth":2,"path":"12-appendix/90-why-buildid-loaded.md","ref":"12-appendix/90-why-buildid-loaded.md","articles":[]},{"title":"12.14 More: Syntax Analysis vs Semantic Analysis","level":"1.12.8","depth":2,"path":"12-appendix/91-syntax-and-semantic-analysis.md","ref":"12-appendix/91-syntax-and-semantic-analysis.md","articles":[]},{"title":"12.15 More: Why GDB Uses Symbol Table+DWARF","level":"1.12.9","depth":2,"path":"12-appendix/92-why-gdb-uses-symtab.md","ref":"12-appendix/92-why-gdb-uses-symtab.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc"],"pluginsConfig":{"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"12-appendix/1-go-programme-start.md","mtime":"2025-06-15T13:05:49.369Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-15T18:12:36.160Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>



<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>6.2 Process Attach · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="3-process_start_attach.html" />
    
    
    <link rel="prev" href="1-process_start.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../2-preface/">
            
                <a href="../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../3-terms/">
            
                <a href="../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../4-basics/">
            
                <a href="../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../4-basics/1-purposes.html">
            
                <a href="../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../4-basics/2-dependencies.html">
            
                <a href="../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../4-basics/3-countertactics.html">
            
                <a href="../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../5-debugger-skeleton/">
            
                <a href="../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="1-process_start.html">
            
                <a href="1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.2" data-path="2-process_attach.html">
            
                <a href="2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="3-process_start_attach.html">
            
                <a href="3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="4-debug-session.html">
            
                <a href="4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="5-disassemble.html">
            
                <a href="5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="6-breakpoint.html">
            
                <a href="6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="7-breakpoints.html">
            
                <a href="7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="8-clear.html">
            
                <a href="8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="9-clearall.html">
            
                <a href="9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="10-step.html">
            
                <a href="10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="11-continue.html">
            
                <a href="11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="12-pmem.html">
            
                <a href="12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="13-pregs.html">
            
                <a href="13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="14-set-mem.html">
            
                <a href="14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="15-set-regs.html">
            
                <a href="15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="20-trace_new_threads.html">
            
                <a href="20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="21-trace_old_threads.html">
            
                <a href="21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="80-aslr.html">
            
                <a href="80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="99-more.html">
            
                <a href="99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../7-headto-sym-debugger/">
            
                <a href="../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../7-headto-sym-debugger/2-elf.html">
            
                <a href="../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../7-headto-sym-debugger/3-syms.html">
            
                <a href="../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../7-headto-sym-debugger/5-loading.html">
            
                <a href="../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../8-dwarf/">
            
                <a href="../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../8-dwarf/1-history.html">
            
                <a href="../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../8-dwarf/2-overview.html">
            
                <a href="../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../8-dwarf/3-dwarfdata.html">
            
                <a href="../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../8-dwarf/4-die/">
            
                <a href="../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../8-dwarf/4-die/4-encoding.html">
            
                <a href="../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../8-dwarf/5-other/">
            
                <a href="../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../8-dwarf/6-practices.html">
            
                <a href="../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../8-dwarf/7-summary.html">
            
                <a href="../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../9-develop-sym-debugger/">
            
                <a href="../9-develop-sym-debugger/">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../9-develop-sym-debugger/1-架构设计/">
            
                <a href="../9-develop-sym-debugger/1-架构设计/">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../9-develop-sym-debugger/2-核心调试逻辑/">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../9-develop-sym-debugger/3-高级功能扩展/">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../10-extras/">
            
                <a href="../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../10-extras/1-development-of-debugger.html">
            
                <a href="../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../10-extras/2-development-of-logging.html">
            
                <a href="../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../10-extras/3-development-of-metrics.html">
            
                <a href="../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../10-extras/4-development-of-tracing.html">
            
                <a href="../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../10-extras/5-development-of-bisect.html">
            
                <a href="../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../10-extras/6-development-of-ebpf.html">
            
                <a href="../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../10-extras/7-development-of-replay.html">
            
                <a href="../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../11-thanks/">
            
                <a href="../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../12-appendix/">
            
                <a href="../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../12-appendix/1-go-programme-start.html">
            
                <a href="../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../12-appendix/3-git-bisect.html">
            
                <a href="../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../12-appendix/80-go-tool-compile.html">
            
                <a href="../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../12-appendix/81-go-tool-asm.html">
            
                <a href="../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../12-appendix/82-go-tool-link.html">
            
                <a href="../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >6.2 Process Attach</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="attaching-to-a-process">Attaching to a Process</h2>
<h3 id="implementation-goal-godbg-attach--p-pid">Implementation Goal: <code>godbg attach -p &lt;pid&gt;</code></h3>
<p>If a process is already running and we want to debug it, we need to attach to the process to make it stop and wait for the debugger to control it.</p>
<p>Common debuggers like dlv and gdb support passing the target process ID through the <code>-p pid</code> parameter to debug running processes.</p>
<p>We will implement the program godbg, which supports the subcommand <code>attach -p &lt;pid&gt;</code>. If the target process exists, godbg will attach to it, and the target process will pause execution. Then we&apos;ll make godbg sleep for a few seconds before detaching from the target process, which will then resume execution.</p>
<blockquote>
<p>ps: The few seconds of sleep here can be imagined as a series of debugging operations, such as setting breakpoints, checking process registers, examining memory, etc. We will support these capabilities in later sections.</p>
</blockquote>
<h3 id="basic-knowledge">Basic Knowledge</h3>
<h4 id="tracee">Tracee</h4>
<p>First, let&apos;s clarify the concept of tracee. Although it appears we&apos;re debugging a process, the debugger actually works with individual threads.</p>
<p>A tracee refers to the thread being debugged, not the process. For a multi-threaded program, we may need to trace some or all threads to facilitate debugging. Untraced threads will continue to execute, while traced threads are controlled by the debugger. Even different threads in the same debugged process can be controlled by different tracers.</p>
<h4 id="tracer">Tracer</h4>
<p>A tracer refers to the debugger process (more accurately, thread) that sends debugging control commands to the tracee.</p>
<p>Once a tracer and tracee establish a connection, the tracer can send various debugging commands to the tracee.</p>
<h4 id="ptrace">Ptrace</h4>
<p>Our debugger example is written for the Linux platform, and its debugging capabilities depend on Linux ptrace.</p>
<p>Typically, if the debugger is also a multi-threaded program, we need to pay attention to ptrace constraints. After a tracer and tracee establish a tracing relationship, all subsequent debugging commands received by the tracee (traced thread) should come from the same tracer (tracing thread). This means that when implementing the debugger, we need to bind the task that sends debugging commands to the tracee to a specific thread. More specifically, this task can be a goroutine.</p>
<p>Therefore, when we look at the implementation of debuggers like dlv, we find that the goroutine sending debugging commands typically calls <code>runtime.LockOSThread()</code> to bind to a thread, specifically for sending debugging instructions (various ptrace operations) to the attached tracee.</p>
<blockquote>
<p>runtime.LockOSThread(), this function binds the calling goroutine to the current operating system thread, meaning this operating system thread will only be used to execute operations on this goroutine. Unless the goroutine calls runtime.UnLockOSThread() to remove this binding, the thread won&apos;t be used to schedule other goroutines. The calling goroutine can only execute on the current thread and won&apos;t be migrated to other threads by the scheduler. See:</p>
<pre><code>package runtime // import &quot;runtime&quot;

func LockOSThread()
    LockOSThread wires the calling goroutine to its current operating system
    thread. The calling goroutine will always execute in that thread, and no
    other goroutine will execute in it, until the calling goroutine has made as
    many calls to UnlockOSThread as to LockOSThread. If the calling goroutine
    exits without unlocking the thread, the thread will be terminated.

    All init functions are run on the startup thread. Calling LockOSThread from
    an init function will cause the main function to be invoked on that thread.

    A goroutine should call LockOSThread before calling OS services or non-Go
    library functions that depend on per-thread state.
</code></pre><p>After calling this function, we can meet the tracee&apos;s requirements for the tracer: once a tracer attaches to a tracee through ptrace_attach, all subsequent ptrace requests sent to this tracee must come from the same tracer. Both tracee and tracer specifically refer to threads.</p>
</blockquote>
<p>When we call attach, the tracee might not have stopped when attach returns. At this point, we need to use the wait method to wait for the tracee to stop and obtain its status information. When debugging ends, we can use the detach operation to let the tracee resume execution.</p>
<blockquote>
<p>Below is the man page description of ptrace operations attach and detach, which we&apos;ll use:</p>
</blockquote>
<pre><code>**PTRACE_ATTACH**
*Attach to the process specified in pid, making it a tracee of*
*the calling process.  The tracee is sent a SIGSTOP, but will*
*not necessarily have stopped by the completion of this call;*
</code></pre><blockquote>
<p><em>use waitpid(2) to wait for the tracee to stop.  See the &quot;At&#x2010;</em>
<em>taching and detaching&quot; subsection for additional information.</em></p>
</blockquote>
<pre><code>**PTRACE_DETACH**
*Restart the stopped tracee as for PTRACE_CONT, but first de&#x2010;*
*tach from it.  Under Linux, a tracee can be detached in this*
*way regardless of which method was used to initiate tracing.*
</code></pre><h3 id="code-implementation">Code Implementation</h3>
<p><strong>Source code see: golang-debugger-lessons/2_process_attach</strong></p>
<p>file: main.go</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;os/exec&quot;</span>
    <span class="hljs-string">&quot;runtime&quot;</span>
    <span class="hljs-string">&quot;strconv&quot;</span>
    <span class="hljs-string">&quot;syscall&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">const</span> (
    usage = <span class="hljs-string">&quot;Usage: go run main.go exec &lt;path/to/prog&gt;&quot;</span>

    cmdExec   = <span class="hljs-string">&quot;exec&quot;</span>
    cmdAttach = <span class="hljs-string">&quot;attach&quot;</span>
)

<span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// issue: https://github.com/golang/go/issues/7699</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Why does syscall.PtraceDetach, detach error: no such process?</span>
    <span class="hljs-comment">// Because ptrace requests should come from the same tracer thread,</span>
    <span class="hljs-comment">// </span>
    <span class="hljs-comment">// ps: If it&apos;s not, we might need more complex handling of the tracee&apos;s status display, need to consider signals?</span>
    <span class="hljs-comment">// Currently, this is how the system call parameters are passed.</span>
    runtime.LockOSThread()

    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) &lt; <span class="hljs-number">3</span> {
        fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;%s\n\n&quot;</span>, usage)
        os.Exit(<span class="hljs-number">1</span>)
    }
    cmd := os.Args[<span class="hljs-number">1</span>]

    <span class="hljs-keyword">switch</span> cmd {
    <span class="hljs-keyword">case</span> cmdExec:
        prog := os.Args[<span class="hljs-number">2</span>]

        <span class="hljs-comment">// run prog</span>
        progCmd := exec.Command(prog)
        buf, err := progCmd.CombinedOutput()

        fmt.Fprintf(os.Stdout, <span class="hljs-string">&quot;tracee pid: %d\n&quot;</span>, progCmd.Process.Pid)

        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;%s exec error: %v, \n\n%s\n\n&quot;</span>, err, <span class="hljs-keyword">string</span>(buf))
            os.Exit(<span class="hljs-number">1</span>)
        }
        fmt.Fprintf(os.Stdout, <span class="hljs-string">&quot;%s\n&quot;</span>, <span class="hljs-keyword">string</span>(buf))

    <span class="hljs-keyword">case</span> cmdAttach:
        pid, err := strconv.ParseInt(os.Args[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>, <span class="hljs-number">64</span>)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;%s invalid pid\n\n&quot;</span>, os.Args[<span class="hljs-number">2</span>])
            os.Exit(<span class="hljs-number">1</span>)
        }

        <span class="hljs-comment">// check pid</span>
        <span class="hljs-keyword">if</span> !checkPid(<span class="hljs-keyword">int</span>(pid)) {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;process %d not existed\n\n&quot;</span>, pid)
            os.Exit(<span class="hljs-number">1</span>)
        }

        <span class="hljs-comment">// attach</span>
        err = syscall.PtraceAttach(<span class="hljs-keyword">int</span>(pid))
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;process %d attach error: %v\n\n&quot;</span>, pid, err)
            os.Exit(<span class="hljs-number">1</span>)
        }
        fmt.Fprintf(os.Stdout, <span class="hljs-string">&quot;process %d attach succ\n\n&quot;</span>, pid)

        <span class="hljs-comment">// wait</span>
        <span class="hljs-keyword">var</span> (
            status syscall.WaitStatus
            rusage syscall.Rusage
        )
        _, err = syscall.Wait4(<span class="hljs-keyword">int</span>(pid), &amp;status, syscall.WSTOPPED, &amp;rusage)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;process %d wait error: %v\n\n&quot;</span>, pid, err)
            os.Exit(<span class="hljs-number">1</span>)
        }
        fmt.Fprintf(os.Stdout, <span class="hljs-string">&quot;process %d wait succ, status:%v, rusage:%v\n\n&quot;</span>, pid, status, rusage)

        <span class="hljs-comment">// detach</span>
        fmt.Printf(<span class="hljs-string">&quot;we&apos;re doing some debugging...\n&quot;</span>)
        time.Sleep(time.Second * <span class="hljs-number">10</span>)

        <span class="hljs-comment">// MUST: call runtime.LockOSThread() first</span>
        err = syscall.PtraceDetach(<span class="hljs-keyword">int</span>(pid))
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;process %d detach error: %v\n\n&quot;</span>, pid, err)
            os.Exit(<span class="hljs-number">1</span>)
        }
        fmt.Fprintf(os.Stdout, <span class="hljs-string">&quot;process %d detach succ\n\n&quot;</span>, pid)

    <span class="hljs-keyword">default</span>:
        fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;%s unknown cmd\n\n&quot;</span>, cmd)
        os.Exit(<span class="hljs-number">1</span>)
    }

}

<span class="hljs-comment">// checkPid check whether pid is valid process&apos;s id</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// On Unix systems, os.FindProcess always succeeds and returns a Process for</span>
<span class="hljs-comment">// the given pid, regardless of whether the process exists.</span>
<span class="hljs-keyword">func</span> checkPid(pid <span class="hljs-keyword">int</span>) <span class="hljs-keyword">bool</span> {
    out, err := exec.Command(<span class="hljs-string">&quot;kill&quot;</span>, <span class="hljs-string">&quot;-s&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>, strconv.Itoa(pid)).CombinedOutput()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }

    <span class="hljs-comment">// output error message, means pid is invalid</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">string</span>(out) != <span class="hljs-string">&quot;&quot;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}
</code></pre>
<p>The program logic here is also relatively simple:</p>
<ul>
<li>When the program runs, it first checks the command line arguments,<ul>
<li><code>godbg attach &lt;pid&gt;</code>, there should be at least 3 arguments. If the number of arguments is incorrect, it reports an error and exits;</li>
<li>Next, it checks the second argument. If it&apos;s an invalid subcommand, it also reports an error and exits;</li>
<li>If it&apos;s attach, then the pid parameter should be an integer, if not, it exits directly;</li>
</ul>
</li>
<li>With normal arguments, it begins trying to attach to the tracee;</li>
<li>After attaching, the tracee might not stop immediately, so we need to wait to get its status changes;</li>
<li>After the tracee stops, we sleep for 10 seconds, as if we&apos;re doing some debugging operations;</li>
<li>After 10 seconds, the tracer tries to detach from the tracee, letting the tracee resume execution.</li>
</ul>
<p>When implementing on the Linux platform, we need to consider platform-specific issues, including:</p>
<ul>
<li>Checking if a pid corresponds to a valid process. Usually, we would use <code>exec.FindProcess(pid)</code> to check, but on Unix platforms, this function always returns OK, so it doesn&apos;t work. Therefore, we use the classic approach of <code>kill -s 0 pid</code> to check the validity of the pid.</li>
<li>When performing detach operations between tracer and tracee, we use the ptrace system call, which is also platform-dependent. As the Linux man page states, we must ensure that all ptrace requests for a tracee come from the same tracer thread, which we need to pay attention to in our implementation.</li>
</ul>
<h3 id="code-testing">Code Testing</h3>
<p>Here&apos;s a test example to help you better understand the role of attach and detach.</p>
<p>First, we start a command in bash that runs continuously, then get its pid and have godbg attach to it, observing the program&apos;s pause and resume execution.</p>
<p>For example, we first execute the following command in bash, which prints the current pid every second:</p>
<pre><code class="lang-bash">$ <span class="hljs-keyword">while</span> [ 1 <span class="hljs-_">-eq</span> 1 ]; <span class="hljs-keyword">do</span> t=`date`; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$t</span> pid: $$&quot;</span>; sleep 1; <span class="hljs-keyword">done</span>

Sat Nov 14 14:29:04 UTC 2020 pid: 1311
Sat Nov 14 14:29:06 UTC 2020 pid: 1311
Sat Nov 14 14:29:07 UTC 2020 pid: 1311
Sat Nov 14 14:29:08 UTC 2020 pid: 1311
Sat Nov 14 14:29:09 UTC 2020 pid: 1311
Sat Nov 14 14:29:10 UTC 2020 pid: 1311
Sat Nov 14 14:29:11 UTC 2020 pid: 1311
Sat Nov 14 14:29:12 UTC 2020 pid: 1311
Sat Nov 14 14:29:13 UTC 2020 pid: 1311
Sat Nov 14 14:29:14 UTC 2020 pid: 1311  ==&gt; 14s
^C
</code></pre>
<p>Then we execute the command:</p>
<pre><code class="lang-bash">$ go run main.go attach 1311

process 1311 attach succ

process 1311 <span class="hljs-built_in">wait</span> succ, status:4991, rusage:{{12 607026} {4 42304} 43580 0 0 0 375739 348 0 68224 35656 0 0 0 29245 153787}
</code></pre>
<h3 id="discussion">Discussion</h3>
<p>To help readers quickly grasp the core debugging principles, we intentionally simplified the example. For instance, the debugged process is a single-threaded program. Would the results be different for a multi-threaded program? Yes, and we would need to make some special handling. Let&apos;s discuss this further.</p>
<h4 id="issue-multi-threaded-program-still-running-after-attach">Issue: Multi-threaded Program Still Running After Attach?</h4>
<p>Some readers might develop a Go program as the debugged program and may encounter some confusion due to multi-threading. Let&apos;s address this.</p>
<p>If I use the following Go program as the debugged program:</p>
<pre><code class="lang-go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
)
<span class="hljs-keyword">func</span> main() {
    <span class="hljs-keyword">for</span>  {
        time.Sleep(time.Second)
        fmt.Println(<span class="hljs-string">&quot;pid:&quot;</span>, os.Getpid())
    }
}
</code></pre>
<p>You might find that after executing <code>godbg attach &lt;pid&gt;</code>, the program is still running. Why is this?</p>
<p>This is because Go programs are inherently multi-threaded - sysmon, garbage collection, and other features may use separate threads. When we attach, we&apos;re only attaching to one thread of the process corresponding to the pid. Other threads remain untraced and can execute normally.</p>
<p>So which thread does ptrace attach to when we specify a pid? <strong>Isn&apos;t the thread corresponding to this pid the one executing main.main? Let me answer: Actually, not necessarily!</strong></p>
<p><strong>In Go programs, the function main.main is executed by the main goroutine, but the main goroutine has no default binding relationship with the main thread.</strong> So it&apos;s incorrect to assume that main.main must run on the thread corresponding to the pid!</p>
<blockquote>
<p>ps: The appendix &quot;Go Runtime: Go Program Startup Process&quot; analyzes the startup process of Go programs, which can help readers clear up any doubts about main.main, main goroutine, and main thread.</p>
</blockquote>
<p>In Linux, threads are implemented through Lightweight Processes (LWP). The pid parameter in ptrace is actually the process id of the LWP corresponding to the thread. Performing a ptrace attach operation on process pid only results in the thread corresponding to that process pid being traced.</p>
<p><strong>In debugging scenarios, a tracee refers to a thread, not all threads contained in a process</strong>, although sometimes we use process terminology for convenience in description.</p>
<blockquote>
<p>A multi-threaded process can be understood as a thread group containing multiple threads. Threads in the thread group are created using the clone system call with the CLONE_THREAD parameter to ensure all newly created threads have the same pid, similar to how clone+CLONE_PARENT makes all cloned child processes have the same parent process id.</p>
<p>In Go, threads are created using the clone system call with the following options:</p>
<pre><code class="lang-go">cloneFlags = _CLONE_VM | <span class="hljs-comment">/* share memory */</span>
    _CLONE_FS | <span class="hljs-comment">/* share cwd, etc */</span>
    _CLONE_FILES | <span class="hljs-comment">/* share fd table */</span>
    _CLONE_SIGHAND | <span class="hljs-comment">/* share sig handler table */</span>
    _CLONE_SYSVSEM | <span class="hljs-comment">/* share SysV semaphore undo lists (see issue #20763) */</span>
    _CLONE_THREAD <span class="hljs-comment">/* revisit - okay for now */</span>
</code></pre>
<p>For more information about clone options, you can check the man page <code>man 2 clone</code>.</p>
</blockquote>
<p>A ptrace link is established between the thread (or LWP) identified by pid and the thread (or LWP) sending the ptrace request. Their roles are tracee and tracer respectively. The tracee expects all subsequent ptrace requests to come from this tracer. For this reason, Go programs, which are naturally multi-threaded, need to ensure that the goroutine actually sending ptrace requests must execute on the same thread.</p>
<p>If there are other threads in the debugged process, they can still run. This is why some readers find that the debugged program is still continuously outputting - because the tracer hasn&apos;t set a breakpoint inside main.main, and the main goroutine executing this function might be executed by other untraced threads, so you can still see the program continuously outputting.</p>
<h4 id="issue-how-to-stop-the-thread-executing-mainmain">Issue: How to Stop the Thread Executing main.main?</h4>
<p>If you want to stop the debugged process from executing, the debugger needs to enumerate the threads contained in the process and perform ptrace attach operations on them one by one. Specifically for Linux, you can list all thread (or LWP) pids under <code>/proc/&lt;pid&gt;/task</code> and perform ptrace attach on each one.</p>
<p>We will further improve the attach command in the subsequent process to make it capable of debugging in multi-threaded environments.</p>
<h4 id="issue-how-to-determine-if-a-process-is-multi-threaded">Issue: How to Determine if a Process is Multi-threaded?</h4>
<p>How can we determine if the target process is a multi-threaded program? There are two simple methods to help determine this.</p>
<ul>
<li><p><code>top -H -p pid</code></p>
<p>The <code>-H</code> option will list the threads under process pid. The process 5293 below has 4 threads. In Linux, threads are implemented through lightweight processes, and the lightweight process with PID 5293 is the main thread.</p>
<pre><code class="lang-bash">$ top -H -p 5293
........
PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                     
 5293 root      20   0  702968   1268    968 S  0.0  0.0   0:00.04 loop                                                        
 5294 root      20   0  702968   1268    968 S  0.0  0.0   0:00.08 loop                                                        
 5295 root      20   0  702968   1268    968 S  0.0  0.0   0:00.03 loop                                                        
 5296 root      20   0  702968   1268    968 S  0.0  0.0   0:00.03 loop
</code></pre>
<p>In the top display information, column S represents the process state. Common values and their meanings are as follows:</p>
<pre><code class="lang-bash"><span class="hljs-string">&apos;D&apos;</span> = uninterruptible sleep
<span class="hljs-string">&apos;R&apos;</span> = running
<span class="hljs-string">&apos;S&apos;</span> = sleeping
<span class="hljs-string">&apos;T&apos;</span> = traced or stopped
<span class="hljs-string">&apos;Z&apos;</span> = zombie
</code></pre>
<p>You can identify which threads in a multi-threaded program are being debugged and traced by the state <strong>&apos;T&apos;</strong>.</p>
</li>
<li><p><code>ls /proc/&lt;pid&gt;/task</code></p>
<pre><code class="lang-bash">$ ls /proc/5293/task/

5293/ 5294/ 5295/ 5296/
</code></pre>
<p>In Linux, /proc is a virtual file system that contains various state information during system runtime. The following command can view the threads under process 5293. The result is the same as what top shows.</p>
</li>
</ul>
<h4 id="issue-explanation-of-syscallwait4-parameters">Issue: Explanation of syscall.Wait4 Parameters</h4>
<p>The Linux system has multiple system calls for waiting for process state changes, with subtle differences in usage and functionality. We use syscall.Wait4 here, which corresponds to the Linux system call wait4. For detailed usage instructions, you can refer to the man page.</p>
<p>The strongly relevant parts from the man page are as follows:</p>
<p>man 2 wait4</p>
<blockquote>
<p><strong>Name</strong></p>
<p><em>wait3, wait4 - wait for process to change state, BSD style</em></p>
<p><strong>SYNOPSIS</strong></p>
<p>pid_t wait3(int <em>wstatus, int options,
struct rusage </em>rusage);</p>
<p>pid_t wait4(pid_t pid, int <em>wstatus, int options,
struct rusage </em>rusage);</p>
<p><strong>Description</strong></p>
<p><strong>These functions are obsolete; use waitpid(2) or waitid(2) in new programs.</strong></p>
<p>The wait3() and wait4() system calls are similar to waitpid(2), but additionally return resource usage information about the child in the structure pointed to by rusage.</p>
<p>man 2 waitpid</p>
<p><strong>Name</strong></p>
<p>wait, waitpid, waitid - wait for process to change state</p>
<p><strong>SYNOPSIS</strong></p>
<p>pid_t wait(int *wstatus);</p>
<p>pid_t waitpid(pid_t pid, int *wstatus, int options);</p>
<p>int waitid(idtype_t idtype, id_t id, siginfo_t<em>infop, int options);
/</em> This is the glibc and POSIX interface; see
NOTES for information on the raw system call. */</p>
<p><strong>SYNOPSIS</strong></p>
<p>All of these system calls are used to wait for state changes in a child of the calling process, and obtain information about the child whose state has changed. A state change is considered to be: the child terminated;
the child was stopped by a signal; or the child was resumed by a signal. In the case of a terminated child, performing a wait allows the system to release the resources associated with the child; if a wait is not performed, then the terminated child remains in a &quot;zombie&quot; state (see NOTES below).</p>
<p>If a child has already changed state, then these calls return immediately. Otherwise, they block until either a child changes state or a signal handler interrupts the call (assuming that system calls are not automatically restarted using the SA_RESTART flag of sigaction(2)). In the remainder of this page, a child whose state has changed and which has not yet been waited upon by one of these system calls is termed waitable.</p>
<p>wait() and waitpid()
The wait() system call suspends execution of the calling process until one of its children terminates. The call wait(&amp;wstatus) is equivalent to:</p>
<p>waitpid(-1, &amp;wstatus, 0);</p>
<p>The waitpid() system call suspends execution of the calling process until a child specified by pid argument has changed state. By default, waitpid() waits only for terminated children, but this behavior is modifiable via the options argument, as described below.</p>
<p>The value of pid can be:</p>
<ul>
<li>\&lt;-1: meaning wait for any child process whose process group ID is equal to the absolute value of pid.</li>
<li>-1: meaning wait for any child process.</li>
<li>0: meaning wait for any child process whose process group ID is equal to that of the calling process.</li>
<li>&gt;0: meaning wait for the child whose process ID is equal to the value of pid.</li>
</ul>
<p>The value of options is an OR of zero or more of the following constants:</p>
<ul>
<li>WNOHANG: ... blabla</li>
<li>WUNTRACED: ... blabla</li>
<li>WCONTINUED: ... blabla</li>
</ul>
<p>(For Linux-only options, see below.)</p>
<ul>
<li>WIFSTOPPED: returns true if the child process was stopped by delivery of a signal; this is possible only if the call was done using WUNTRACED or when the child is being traced (see ptrace(2)).</li>
<li>... blabla</li>
</ul>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="1-process_start.html" class="navigation navigation-prev " aria-label="Previous page: 6.1 Process Launch">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="3-process_start_attach.html" class="navigation navigation-next " aria-label="Next page: 6.3 Launch & Attach">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"6.2 Process Attach","level":"1.6.2","depth":2,"next":{"title":"6.3 Launch & Attach","level":"1.6.3","depth":2,"path":"6-develop-inst-debugger/3-process_start_attach.md","ref":"6-develop-inst-debugger/3-process_start_attach.md","articles":[]},"previous":{"title":"6.1 Process Launch","level":"1.6.1","depth":2,"path":"6-develop-inst-debugger/1-process_start.md","ref":"6-develop-inst-debugger/1-process_start.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc"],"pluginsConfig":{"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"6-develop-inst-debugger/2-process_attach.md","mtime":"2025-06-15T08:58:08.186Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-15T13:13:32.255Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


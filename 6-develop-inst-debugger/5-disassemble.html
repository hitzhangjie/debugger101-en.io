
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>6.5 Disassembly · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="6-breakpoint.html" />
    
    
    <link rel="prev" href="4-debug-session.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../2-preface/">
            
                <a href="../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../3-terms/">
            
                <a href="../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../4-basics/">
            
                <a href="../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../4-basics/1-purposes.html">
            
                <a href="../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../4-basics/2-dependencies.html">
            
                <a href="../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../4-basics/3-countertactics.html">
            
                <a href="../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../5-debugger-skeleton/">
            
                <a href="../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="1-process_start.html">
            
                <a href="1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="2-process_attach.html">
            
                <a href="2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="3-process_start_attach.html">
            
                <a href="3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="4-debug-session.html">
            
                <a href="4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.5" data-path="5-disassemble.html">
            
                <a href="5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="6-breakpoint.html">
            
                <a href="6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="7-breakpoints.html">
            
                <a href="7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="8-clear.html">
            
                <a href="8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="9-clearall.html">
            
                <a href="9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="10-step.html">
            
                <a href="10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="11-continue.html">
            
                <a href="11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="12-pmem.html">
            
                <a href="12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="13-pregs.html">
            
                <a href="13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="14-set-mem.html">
            
                <a href="14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="15-set-regs.html">
            
                <a href="15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="20-trace_new_threads.html">
            
                <a href="20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="21-trace_old_threads.html">
            
                <a href="21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="80-aslr.html">
            
                <a href="80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="99-more.html">
            
                <a href="99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../7-headto-sym-debugger/">
            
                <a href="../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../7-headto-sym-debugger/2-elf.html">
            
                <a href="../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../7-headto-sym-debugger/3-syms.html">
            
                <a href="../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../7-headto-sym-debugger/5-loading.html">
            
                <a href="../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../8-dwarf/">
            
                <a href="../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../8-dwarf/1-history.html">
            
                <a href="../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../8-dwarf/2-overview.html">
            
                <a href="../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../8-dwarf/3-dwarfdata.html">
            
                <a href="../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../8-dwarf/4-die/">
            
                <a href="../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../8-dwarf/4-die/4-encoding.html">
            
                <a href="../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../8-dwarf/5-other/">
            
                <a href="../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../8-dwarf/6-practices.html">
            
                <a href="../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../8-dwarf/7-summary.html">
            
                <a href="../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../9-develop-sym-debugger/">
            
                <a href="../9-develop-sym-debugger/">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../9-develop-sym-debugger/1-架构设计/">
            
                <a href="../9-develop-sym-debugger/1-架构设计/">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                <a href="../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../9-develop-sym-debugger/2-核心调试逻辑/">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../9-develop-sym-debugger/3-高级功能扩展/">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../10-extras/">
            
                <a href="../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../10-extras/1-development-of-debugger.html">
            
                <a href="../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../10-extras/2-development-of-logging.html">
            
                <a href="../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../10-extras/3-development-of-metrics.html">
            
                <a href="../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../10-extras/4-development-of-tracing.html">
            
                <a href="../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../10-extras/5-development-of-bisect.html">
            
                <a href="../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../10-extras/6-development-of-ebpf.html">
            
                <a href="../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../10-extras/7-development-of-replay.html">
            
                <a href="../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../11-thanks/">
            
                <a href="../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../12-appendix/">
            
                <a href="../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../12-appendix/1-go-programme-start.html">
            
                <a href="../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../12-appendix/3-git-bisect.html">
            
                <a href="../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../12-appendix/80-go-tool-compile.html">
            
                <a href="../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../12-appendix/81-go-tool-asm.html">
            
                <a href="../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../12-appendix/82-go-tool-link.html">
            
                <a href="../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >6.5 Disassembly</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="disassembly">Disassembly</h2>
<h3 id="implementation-goal-implementing-disassembly">Implementation Goal: Implementing Disassembly</h3>
<p>Disassembly is an essential part of instruction-level debugging. While symbol-level debugging needs to display source code information, instruction-level debugging needs to display assembly instructions.</p>
<p>Assembly instructions are closely related to hardware. In fact, assembly instructions are just mnemonics. The opcode and operands of an assembly instruction are encoded according to specified encoding methods to obtain machine instructions. Different instructions may have the same or different number of bytes for their opcodes, and the same applies to operands.</p>
<p>Factors such as different hardware platforms, instruction set architectures, numerous assembly instructions, and fixed-length or variable-length instruction encoding make disassembly quite challenging. It&apos;s not an easy task to implement disassembly single-handedly.</p>
<p>Fortunately, there&apos;s already a disassembly framework <a href="http://www.capstone-engine.org/" target="_blank">Capstone</a> specifically designed to solve this problem. For Go language, we can consider using the Go version <a href="https://github.com/bnagy/gapstone" target="_blank">Gapstone</a>. Alternatively, we can use the official Go disassembly tool class <a href="https://golang.org/x/arch/x86/x86asm" target="_blank">arch/x86/x86asm</a>. Note that the popular Go debugger dlv also uses x86asm for disassembly operations.</p>
<p>For simplicity, we will use arch/x86/x86asm to complete the disassembly task. Of course, using Capstone or Gapstone is also possible. If readers are interested, they can experiment with these alternatives.</p>
<h3 id="code-implementation">Code Implementation</h3>
<p>To implement disassembly operations, we mainly need to master these operations:</p>
<ul>
<li>How to read complete instruction data from a specified process;</li>
<li>How to perform disassembly operations on a complete program;</li>
<li>How to perform disassembly operations on breakpoint instructions.</li>
</ul>
<h4 id="finding-the-executable-program-by-pid">Finding the Executable Program by PID</h4>
<p>Many operations of tracer controlling tracee depend on the tracee&apos;s PID. If we want to read the complete instruction data of the executable program corresponding to the PID, we must first find the corresponding executable program path through the PID. How do we do this?</p>
<blockquote>
<p>Reading the memory data of the process instance corresponding to the PID directly is useless because the instruction data inside may be incomplete. Process instruction data is loaded on demand. For details, you can learn about Linux PageFault related content.</p>
</blockquote>
<p>Under Linux systems, the virtual file system path <code>/proc/&lt;pid&gt;/exe</code> is a symbolic link that points to the absolute path of the executable program corresponding to process <code>pid</code>. In Go programs, we can read this symbolic link information to get the program path.</p>
<p>For example:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-comment">// GetExecutable gets the executable program path by PID</span>
<span class="hljs-keyword">func</span> GetExecutable(pid <span class="hljs-keyword">int</span>) (<span class="hljs-keyword">string</span>, error) {
    exeLink := fmt.Sprintf(<span class="hljs-string">&quot;/proc/%d/exe&quot;</span>, pid)
    exePath, err := os.Readlink(exeLink)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, fmt.Errorf(<span class="hljs-string">&quot;find executable by pid err: %w&quot;</span>, err)
    }
    <span class="hljs-keyword">return</span> exePath, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 id="implementing-disassembly-of-complete-program">Implementing Disassembly of Complete Program</h4>
<p>After finding the executable program file path by PID, we can try to read the file content to prepare for disassembly. However, it&apos;s important to note that Linux binary executable program files are organized according to the <code>ELF (Executable and Linkable Format)</code> format, with a structure roughly as shown below. To read and parse ELF file data, we can use the standard library <code>debug/elf</code>.</p>
<p><img src="assets/elf_layout.png" alt="elf"></p>
<p>We can see that an ELF file contains ELF Header, Program Header Table, Section Header Table, and a series of Sections. Program Header Table and Section Header Table reference these Sections.</p>
<p>Program Header Table and Section Header Table are specifically designed to construct two different views:</p>
<ul>
<li>Program Header Table constructs the segments view, describing how the loader maps referenced sections to memory space through mmap when loading the program;</li>
<li>Section Header Table constructs the sections view, describing the sequential position of sections in the binary program and guiding the linker on how to perform linking;</li>
</ul>
<p>These two views don&apos;t interfere with each other and are used to guide the design and implementation of loader and linker respectively.</p>
<blockquote>
<p><strong>What You Need To Know About ELF for CS452</strong></p>
<p><strong>Two views of the world</strong></p>
<p>There are two views of an ELF file. 1) The <em>section view</em> sees the file as a bunch of sections, which are to be linked or loaded in some manner. 2) The <em>program view</em> sees the file as a bunch of <em>ELF segments</em> (not to be confused with Intel segments) which are to be loaded into memory in order to execute the program.</p>
<p>This split is designed to allow someone writing a linker to easily get the information they need (using the section view) and someone writing a loader (that&apos;s you) easily get the information they need without worrying about a lot of the complications of linking (using the program view).</p>
<p>Because you are writing a loader, not a linker, <strong>you can completely ignore the section view</strong>. You only care about the program view. This throws away around 80% of the ELF spec. Doesn&apos;t that make you feel good?</p>
<p>see: <a href="https://student.cs.uwaterloo.ca/~cs452/W18/elf/elf.html" target="_blank">https://student.cs.uwaterloo.ca/~cs452/W18/elf/elf.html</a></p>
</blockquote>
<p>Now, to implement disassembly, we must first parse the executable program (ELF format in Linux) according to the ELF format, then read the machine instructions from the .text segment.</p>
<p>Let&apos;s do this:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;debug/elf&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;strconv&quot;</span>

    <span class="hljs-string">&quot;golang.org/x/arch/x86/x86asm&quot;</span>
)

<span class="hljs-keyword">func</span> main() {

    <span class="hljs-comment">// go run main.go &lt;pid&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) != <span class="hljs-number">2</span> {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;invalid params&quot;</span>)
    }

    <span class="hljs-comment">// pid</span>
    pid, err := strconv.Atoi(os.Args[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }

    <span class="hljs-comment">// Find executable program path by PID</span>
    exePath, err := GetExecutable(pid)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    fmt.Println(exePath)

    <span class="hljs-comment">// Read instruction information and disassemble</span>
    elfFile, err := elf.Open(exePath)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    section := elfFile.Section(<span class="hljs-string">&quot;.text&quot;</span>)
    buf, err := section.Data()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }

    <span class="hljs-comment">// Parse machine instructions one by one, disassemble them, and print them</span>
    offset := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">// Use 64-bit mode</span>
        inst, err := x86asm.Decode(buf[offset:], <span class="hljs-number">64</span>)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
        fmt.Printf(<span class="hljs-string">&quot;%8x %s\n&quot;</span>, offset, inst.String())
        offset += inst.Len
    }
}
</code></pre>
<p>The code logic here is quite complete. It receives a PID, then gets the corresponding executable file path, and then uses the elf package provided by the standard library to read and parse the file according to the ELF file format. It reads the data from the .text section. As we all know, the data inside the .text section is the program&apos;s instructions.</p>
<p>After getting the instructions, we can use <code>golang.org/x/arch/x86/x86asm</code> to perform disassembly operations. Since instructions are variable-length encoded, after successful disassembly, the returned information includes the number of bytes of the current instruction data. We use this to adjust the offset and can continue disassembling subsequent instructions.</p>
<h4 id="disassembling-at-breakpoint-location">Disassembling at Breakpoint Location</h4>
<p>To disassemble at a breakpoint location, the primary task is to obtain the current breakpoint position.</p>
<p>Dynamic breakpoints are often implemented through instruction patching, which means saving the first byte of any complete machine instruction and then replacing it with the <code>0xCC (int 3)</code> instruction. After the processor executes 0xCC, it will stop itself, which is the effect of a breakpoint.</p>
<p>Breakpoints implemented through instruction patching must cover the first byte of the instruction, not other bytes. The reason is simple: to improve decoding efficiency and support more operation types, instructions often use variable-length encoding. If we don&apos;t write the first byte, the processor might generate errors during execution. For example, if an instruction&apos;s opcode has multiple bytes, but due to patching, it becomes an incorrect opcode, there will be exceptions during execution. Or if an instruction is only one byte long, but we insist on writing to the second byte, it won&apos;t serve as a breakpoint because when execution reaches this breakpoint, the one-byte instruction that shouldn&apos;t have been executed before will be executed.</p>
<p>We have systematically introduced the concept and application scenarios of instruction patching earlier (such as debuggers, mock testing frameworks like gomonkey, etc.). If you&apos;re not familiar with these, please refer back to the relevant chapters.</p>
<p>If our current breakpoint is at offset, and we want to perform disassembly, the steps are roughly as follows:</p>
<pre><code class="lang-bash">Before breakpoint is added:
offset:  0x0 0x1 0x2 0x3 0x4

After breakpoint is added:
offset: 0xcc 0x1 0x2 0x3 0x4   | orig: &lt;offset,0x0&gt;
</code></pre>
<ul>
<li>First, we need to know that after 0xCC is executed, execution will pause, meaning PC=offset+1 at this point</li>
<li>Second, we need to know that the instruction at PC-1 is not a complete instruction, as its first byte has been patched and needs to be restored</li>
<li>Finally, we need to know that PC is a special register value pointing to the position of the instruction to be executed. Currently PC=offset+1, which is the position of the next byte after the original instruction&apos;s starting byte. We need to start reading the complete instruction from the memory location PC-1, then disassemble it</li>
</ul>
<p>This is roughly what&apos;s needed to perform disassembly at a breakpoint location. If the location is not a breakpoint, we don&apos;t need to execute <code>pc=pc-1</code>.</p>
<h4 id="put-it-together">Put It Together</h4>
<p>After the above discussion, the disassemble command disassCmd is implemented as follows:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> debug

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;syscall&quot;</span>

    <span class="hljs-string">&quot;github.com/spf13/cobra&quot;</span>
    <span class="hljs-string">&quot;golang.org/x/arch/x86/x86asm&quot;</span>
)

<span class="hljs-keyword">var</span> disassCmd = &amp;cobra.Command{
    Use:   <span class="hljs-string">&quot;disass &lt;locspec&gt;&quot;</span>,
    Short: <span class="hljs-string">&quot;Disassemble machine instructions&quot;</span>,
    Annotations: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>{
        cmdGroupKey: cmdGroupSource,
    },
    RunE: <span class="hljs-keyword">func</span>(cmd *cobra.Command, args []<span class="hljs-keyword">string</span>) error {

        <span class="hljs-comment">// Read PC value</span>
        regs := syscall.PtraceRegs{}
        err := syscall.PtraceGetRegs(TraceePID, &amp;regs)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> err
        }

        buf := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">1</span>)
        n, err := syscall.PtracePeekText(TraceePID, <span class="hljs-keyword">uintptr</span>(regs.PC()<span class="hljs-number">-1</span>), buf)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> || n != <span class="hljs-number">1</span> {
            <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;peek text error: %v, bytes: %d&quot;</span>, err, n)
        }
        fmt.Printf(<span class="hljs-string">&quot;read %d bytes, value of %x\n&quot;</span>, n, buf[<span class="hljs-number">0</span>])
        <span class="hljs-comment">// If the byte before PC is 0xCC, PC needs to be decremented by 1 to read complete instruction data</span>
        <span class="hljs-keyword">if</span> buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0xCC</span> {
            regs.SetPC(regs.PC() - <span class="hljs-number">1</span>)
        }

        <span class="hljs-comment">// Look up, if a breakpoint was set before, restore it</span>
        dat := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">1024</span>)
        n, err = syscall.PtracePeekText(TraceePID, <span class="hljs-keyword">uintptr</span>(regs.PC()), dat)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;peek text error: %v, bytes: %d&quot;</span>, err, n)
        }
        fmt.Printf(<span class="hljs-string">&quot;size of text: %d\n&quot;</span>, n)

        <span class="hljs-comment">// TODO After implementing breakpoint functionality, note that if dat[0] is 0xCC,</span>
        <span class="hljs-comment">// we need to restore the instruction data, otherwise the disassembly will be incorrect.</span>

        <span class="hljs-comment">// Disassemble the instruction data here</span>
        offset := <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> offset &lt; n {
            <span class="hljs-comment">// Use 64-bit mode</span>
            inst, err := x86asm.Decode(dat[offset:], <span class="hljs-number">64</span>)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;x86asm decode error: %v&quot;</span>, err)
            }
            fmt.Printf(<span class="hljs-string">&quot;%8x %s\n&quot;</span>, offset, inst.String())
            offset += inst.Len
        }
    },
}

<span class="hljs-keyword">func</span> init() {
    debugRootCmd.AddCommand(disassCmd)
}

<span class="hljs-comment">// GetExecutable gets the executable program path by PID</span>
<span class="hljs-keyword">func</span> GetExecutable(pid <span class="hljs-keyword">int</span>) (<span class="hljs-keyword">string</span>, error) {
    exeLink := fmt.Sprintf(<span class="hljs-string">&quot;/proc/%d/exe&quot;</span>, pid)
    exePath, err := os.Readlink(exeLink)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, fmt.Errorf(<span class="hljs-string">&quot;find executable by pid err: %w&quot;</span>, err)
    }
    <span class="hljs-keyword">return</span> exePath, <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 id="code-testing">Code Testing</h3>
<p>Let&apos;s write a simple Go program, let it run, check its PID as 2507, then execute <code>godbg attach 2507</code> to start debugging the target process.</p>
<pre><code class="lang-bash">$ godbg attach 2507
process 2507 attached succ
process 2507 stopped: <span class="hljs-literal">true</span>

godbg&gt; disass
<span class="hljs-built_in">read</span> 1 bytes, value of 89
size of text: 1024
       0 MOV [RSP+Reg(0)+0x20], EAX
       4 RET
       5 INT 0x3
      ..........
      1e INT 0x3
      1f INT 0x3
      20 MOV EDI, [RSP+Reg(0)+0x8]
      24 MOV RSI, 0x2
      2b MOV RDX, 0x1
      32 MOV EAX, 0x48
      37 SYSCALL
      39 RET
      ..........
     100 CMP [RAX+0x8], RCX
     104 JE .+60
     106 XOR ECX, ECX
     108 TEST CL, CL
     10a JNE .+16
     10c XOR EAX, EAX
     10e MOV [RSP+Reg(0)+0x40], AL
     112 MOV RBP, [RSP+Reg(0)+0x20]
     117 ADD RSP, 0x28
     11b RET
     11c LEA RCX, [RDX+0x18]
     120 MOV [RSP+Reg(0)], RCX
     124 ADD RAX, 0x18
      ..........
     3fd INT 0x3
     3fe INT 0x3
     3ff INT 0x3
     Error: x86asm decode error: truncated instruction
</code></pre>
<p>We also notice that the last line has an error message, indicating &quot;truncated instruction&quot;, because we fixed the buffer size to 1024 bytes, and there might be a last instruction that wasn&apos;t fully read, so the decode failed.</p>
<p>This failure is expected and harmless. We don&apos;t display so many assembly instructions in the debugging session. We only display a few instructions around the breakpoint. For the decode-failed buffer tail few instructions, we simply ignore them.</p>
<p>Now we have implemented the disassembly function. Next, we will use instruction patching to implement dynamic breakpoint addition and removal.</p>
<blockquote>
<p>ps: In our example program <code>`golang-debugger-lessons/5_disassemble</code>, we provided a standalone program that can disassemble all instructions in the program, including handling possible errors such as unrecognized instructions and out-of-bounds issues.</p>
</blockquote>
<h3 id="more-related-content">More Related Content</h3>
<p>Assembly instructions have three common styles: go, intel, gnu. The gnu style is also known as at&amp;t style.</p>
<p>To facilitate different developers to read the corresponding disassembled instructions smoothly, we added the option <code>disass -s &lt;syntax&gt;</code> to the disass command to specify the assembly instruction style. If you prefer to read at&amp;t format assembly instructions, you can use <code>disass -s gnu</code> to view the corresponding style assembly instructions.</p>
<p>The function <code>instSyntax(inst x86asm.Inst, syntax string) (string, error)</code> implements support for converting different assembly styles:</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> instSyntax(inst x86asm.Inst, syntax <span class="hljs-keyword">string</span>) (<span class="hljs-keyword">string</span>, error) {
    asm := <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">switch</span> syntax {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;go&quot;</span>:
        asm = x86asm.GoSyntax(inst, <span class="hljs-keyword">uint64</span>(inst.PCRel), <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;gnu&quot;</span>:
        asm = x86asm.GNUSyntax(inst, <span class="hljs-keyword">uint64</span>(inst.PCRel), <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;intel&quot;</span>:
        asm = x86asm.IntelSyntax(inst, <span class="hljs-keyword">uint64</span>(inst.PCRel), <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, fmt.Errorf(<span class="hljs-string">&quot;invalid asm syntax error&quot;</span>)
    }
    <span class="hljs-keyword">return</span> asm, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>We also added the option <code>disass -n &lt;num&gt;</code> to specify the number of instructions to decode in one disassembly operation. Because in the debugging session, we are more concerned with the current pending instruction, so there&apos;s no need to disassemble thousands of instructions at once.</p>
<p>You can view the complete disassembly implementation in the project <code>hitzhangjie/godbg</code> source file <code>godbg/cmd/debug/disass.go</code>.</p>
<h3 id="reference">Reference</h3>
<ol>
<li>What You Need To Know About ELF, <a href="https://student.cs.uwaterloo.ca/~cs452/W18/elf/elf.html" target="_blank">https://student.cs.uwaterloo.ca/~cs452/W18/elf/elf.html</a></li>
<li>dissecting go binaries, <a href="https://www.grant.pizza/blog/dissecting-go-binaries/" target="_blank">https://www.grant.pizza/blog/dissecting-go-binaries/</a></li>
<li>how many x86-64 instructions are there anyway, <a href="https://stefanheule.com/blog/how-many-x86-64-instructions-are-there-anyway/" target="_blank">https://stefanheule.com/blog/how-many-x86-64-instructions-are-there-anyway/</a></li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="4-debug-session.html" class="navigation navigation-prev " aria-label="Previous page: 6.4 Debug Session">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="6-breakpoint.html" class="navigation navigation-next " aria-label="Next page: 6.6 Adding Breakpoints">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"6.5 Disassembly","level":"1.6.5","depth":2,"next":{"title":"6.6 Adding Breakpoints","level":"1.6.6","depth":2,"path":"6-develop-inst-debugger/6-breakpoint.md","ref":"6-develop-inst-debugger/6-breakpoint.md","articles":[]},"previous":{"title":"6.4 Debug Session","level":"1.6.4","depth":2,"path":"6-develop-inst-debugger/4-debug-session.md","ref":"6-develop-inst-debugger/4-debug-session.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc","github"],"pluginsConfig":{"github":{"url":"https://github.com/hitzhangjie/golang-debugger-book-en"},"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"6-develop-inst-debugger/5-disassemble.md","mtime":"2025-06-17T03:44:29.812Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-17T03:53:23.064Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


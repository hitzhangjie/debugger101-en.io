
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>7.6.2 debug/gosym · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="3-dwarf.html" />
    
    
    <link rel="prev" href="1-elf.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../2-preface/">
            
                <a href="../../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../3-terms/">
            
                <a href="../../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../4-basics/">
            
                <a href="../../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../4-basics/1-purposes.html">
            
                <a href="../../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../4-basics/2-dependencies.html">
            
                <a href="../../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../4-basics/3-countertactics.html">
            
                <a href="../../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../5-debugger-skeleton/">
            
                <a href="../../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../6-develop-inst-debugger/">
            
                <a href="../../6-develop-inst-debugger/">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../6-develop-inst-debugger/1-process_start.html">
            
                <a href="../../6-develop-inst-debugger/1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../6-develop-inst-debugger/2-process_attach.html">
            
                <a href="../../6-develop-inst-debugger/2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                <a href="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../6-develop-inst-debugger/4-debug-session.html">
            
                <a href="../../6-develop-inst-debugger/4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../6-develop-inst-debugger/5-disassemble.html">
            
                <a href="../../6-develop-inst-debugger/5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../6-develop-inst-debugger/6-breakpoint.html">
            
                <a href="../../6-develop-inst-debugger/6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../6-develop-inst-debugger/7-breakpoints.html">
            
                <a href="../../6-develop-inst-debugger/7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../6-develop-inst-debugger/8-clear.html">
            
                <a href="../../6-develop-inst-debugger/8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../6-develop-inst-debugger/9-clearall.html">
            
                <a href="../../6-develop-inst-debugger/9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../6-develop-inst-debugger/10-step.html">
            
                <a href="../../6-develop-inst-debugger/10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../6-develop-inst-debugger/11-continue.html">
            
                <a href="../../6-develop-inst-debugger/11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../6-develop-inst-debugger/12-pmem.html">
            
                <a href="../../6-develop-inst-debugger/12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../6-develop-inst-debugger/13-pregs.html">
            
                <a href="../../6-develop-inst-debugger/13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../6-develop-inst-debugger/14-set-mem.html">
            
                <a href="../../6-develop-inst-debugger/14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../../6-develop-inst-debugger/15-set-regs.html">
            
                <a href="../../6-develop-inst-debugger/15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                <a href="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                <a href="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../../6-develop-inst-debugger/80-aslr.html">
            
                <a href="../../6-develop-inst-debugger/80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../../6-develop-inst-debugger/99-more.html">
            
                <a href="../../6-develop-inst-debugger/99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../">
            
                <a href="../">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../1-how-go-build-works.html">
            
                <a href="../1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../2-elf.html">
            
                <a href="../2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../3-syms.html">
            
                <a href="../3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../4-syms-resolve-reloc.html">
            
                <a href="../4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../5-loading.html">
            
                <a href="../5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="./">
            
                <a href="./">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="1-elf.html">
            
                <a href="1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.6.2" data-path="2-gosym.html">
            
                <a href="2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="3-dwarf.html">
            
                <a href="3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../7-headto-dwarf/">
            
                <a href="../7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../8-dwarf/">
            
                <a href="../../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../8-dwarf/1-history.html">
            
                <a href="../../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../8-dwarf/2-overview.html">
            
                <a href="../../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../8-dwarf/3-dwarfdata.html">
            
                <a href="../../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../8-dwarf/4-die/">
            
                <a href="../../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../../8-dwarf/4-die/4-encoding.html">
            
                <a href="../../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../8-dwarf/5-other/">
            
                <a href="../../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../8-dwarf/6-practices.html">
            
                <a href="../../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../../8-dwarf/7-summary.html">
            
                <a href="../../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../9-develop-sym-debugger/">
            
                <a href="../../9-develop-sym-debugger/">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../9-develop-sym-debugger/1-架构设计/">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="../../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="../../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                <a href="../../9-develop-sym-debugger/1-架构设计/6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../../9-develop-sym-debugger/2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../../9-develop-sym-debugger/3-高级功能扩展/">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../../9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../10-extras/">
            
                <a href="../../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../10-extras/1-development-of-debugger.html">
            
                <a href="../../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../../10-extras/2-development-of-logging.html">
            
                <a href="../../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../../10-extras/3-development-of-metrics.html">
            
                <a href="../../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../../10-extras/4-development-of-tracing.html">
            
                <a href="../../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../../10-extras/5-development-of-bisect.html">
            
                <a href="../../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../../10-extras/6-development-of-ebpf.html">
            
                <a href="../../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../../10-extras/7-development-of-replay.html">
            
                <a href="../../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../11-thanks/">
            
                <a href="../../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../12-appendix/">
            
                <a href="../../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../../12-appendix/1-go-programme-start.html">
            
                <a href="../../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../../12-appendix/3-git-bisect.html">
            
                <a href="../../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../../12-appendix/80-go-tool-compile.html">
            
                <a href="../../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../../12-appendix/81-go-tool-asm.html">
            
                <a href="../../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../../12-appendix/82-go-tool-link.html">
            
                <a href="../../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >7.6.2 debug/gosym</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="using-pkg-debuggosym">Using pkg debug/gosym</h2>
<h3 id="data-types-and-relationships">Data Types and Relationships</h3>
<p>The standard library provides the <code>debug/gosym</code> package to read special section data generated by the Go toolchain, such as .gosymtab and .gopclntab. It provides Go runtime with an efficient and fast method to calculate call stacks, which is very helpful when Go programs encounter panics and need to print stack information.</p>
<p>The important data structures in package debug/gosym are shown in the following diagram:</p>
<p><img src="assets/1c07e57ff316dda1.png" alt="gopkg debug/gosym"></p>
<p>Regarding the symbol information design of Go&apos;s custom .gosymtab and .gopclntab, you can refer to <a href="https://docs.google.com/document/d/1lyPIbmsYbXnpNj57a261hgOYVpNRcgydurVQIyZOz_o/pub" target="_blank">Go 1.2 Runtime Symbol Information</a>. Overall, the most important is the &quot;<strong>Table</strong>&quot; data structure, which has several very useful exported methods that we can use to <strong>quickly convert between instruction addresses and source file locations</strong>. By querying this table based on the Caller PC values during runtime stack traceback, we can implement a way to obtain the current call stack. This is also the main purpose of .gosymtab and .gopclntab.</p>
<h3 id="go-custom-sections">Go Custom Sections</h3>
<p>In ELF files, symbol table information is typically stored in the <code>.symtab</code> section. Go programs are special - before Go 1.2, they had a special .gosymtab that stored symbol table structure information similar to Plan9 style. However, after Go 1.3, .gosymtab no longer contains any symbol information.</p>
<p>Additionally, ELF files store debugging information like line numbers and call stack information. If using DWARF debug information format, these are typically stored in .[z]debug_line and .[z]debug_frame. Go programs are special in that the Go compilation toolchain generates a section called <code>.gopclntab</code> to store line number table information for Go programs, enabling reliable call stack tracking during runtime.</p>
<p>So why doesn&apos;t Go use .[z]debug_line and .[z]debug_frame sections? Why add separate .gosymtab and .gopclntab sections? What are the differences between these sections?</p>
<ul>
<li>We know that sections starting with .[z]debug_ contain debugging information for use by debuggers, while .gosymtab and .gopclntab are for use by the Go runtime.</li>
<li><p>When a Go program executes, its runtime loads .gosymtab and .gopclntab data into process memory to perform stack tracebacks, such as in runtime.Callers. However, .symtab and .[z]debug_* sections are not loaded into memory - they are read and loaded by external debuggers like GDB and Delve.</p>
<pre><code class="lang-bash">$ readelf <span class="hljs-_">-l</span> &lt;prog&gt;

Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  PHDR           ...
  NOTE           ...
  LOAD           ...// 02 .note.go.builid
  LOAD           ...// 03 .rodata ... .gosymtab .gopclntab
  LOAD           ...// 04 .go.buildinfo ...
  GNU_STACK      ...
  LOOS+5041580   ...

 Section to Segment mapping:
  Segment Sections...
   00   
   01     .note.go.buildid 
   02     .text .note.go.buildid 
   03     .rodata .typelink .itablink .gosymtab .gopclntab 
   04     .go.buildinfo .noptrdata .data .bss .noptrbss 
   05   
   06
</code></pre>
<p>When we run the command <code>readelf -l &lt;prog&gt;</code> on a built Go program, we can see that segments 02, 03, and 04 are of type LOAD, meaning they are to be loaded into memory. These segments&apos; corresponding sections include .gosymtab and .gopclntab but not .[z]debug_* related sections.</p>
<p>This follows both common programming language and toolchain conventions, and also enables more efficient conversion between instruction addresses and source code lines, which we&apos;ll discuss later.</p>
</li>
</ul>
<p>In fact, Go&apos;s early core developers came from Bell Labs, many with Plan9 experience. They had already experimented with something similar to pclntab during Plan9 development, as can be seen in Plan9&apos;s man pages.</p>
<p><strong>Plan9&apos;s man a.out</strong></p>
<pre><code class="lang-bash">NAME
    a.out - object file format

 SYNOPSIS
    <span class="hljs-comment">#include &lt;a.out.h&gt;</span>

DESCRIPTION
    An executable Plan 9 binary file has up to six sections: a
    header, the program text, the data, a symbol table, a PC/SP
    offset table (MC68020 only), and finally a PC/line number
    table.  The header, given by a structure <span class="hljs-keyword">in</span> &lt;a.out.h&gt;, con-
    tains 4-byte integers <span class="hljs-keyword">in</span> big-endian order:

   ....

   A similar table, occupying pcsz-bytes, is the next section
   <span class="hljs-keyword">in</span> an executable; it is present <span class="hljs-keyword">for</span> all architectures.  The
   same algorithm may be run using this table to recover the
   absolute <span class="hljs-built_in">source</span> line number from a given program location.
   The absolute line number (starting from zero) counts the
   newlines <span class="hljs-keyword">in</span> the C-preprocessed <span class="hljs-built_in">source</span> seen by the compiler.
   Three symbol types <span class="hljs-keyword">in</span> the main symbol table facilitate con-
   version of the absolute number to <span class="hljs-built_in">source</span> file and line num-
   ber:
</code></pre>
<p>Many of Go&apos;s core developers were themselves Plan9 developers, so it&apos;s not surprising that Go borrowed from Plan9&apos;s experience. Early pclntab storage structure was very similar to Plan9&apos;s pclntab, but now they are quite different. You can refer to the Go 1.2 pclntab design proposal: <a href="https://docs.google.com/document/d/1lyPIbmsYbXnpNj57a261hgOYVpNRcgydurVQIyZOz_o/pub" target="_blank">Go 1.2 Runtime Symbol Information</a>.</p>
<blockquote>
<p>Note: Additionally, parts of the program involving cgo cannot be tracked through .gosymtab and .gopclntab.</p>
</blockquote>
<p>Through package <code>debug/gosym</code>, we can build the pcln table. Using its methods PcToLine, LineToPc, etc., we can quickly query the relationship between instruction addresses and source file locations, and further analyze call stacks. For example, when a program panics, we want to print the call stack to locate the error.</p>
<p><strong>Support for call stack information is the main problem that .gosymtab and .gopclntab solve</strong>. After Go 1.3, call stack data should be fully supported by .gopclntab, so .gosymtab became empty. This is quite different from the design purpose of .[z]debug_line and .[z]debug_frame needed by debuggers. .[z]debug_frame can not only track call stack information but also track register data changes in each stack frame, with more complex data encoding, parsing, and computation logic.</p>
<p>Can .gosymtab and .gopclntab be used for debugging? They&apos;re not completely useless, but compared to DWARF debugging information, they lack some information needed for debugging. We still need DWARF to fully solve debugging scenarios.</p>
<p>Now we should understand the purpose of package debug/gosym and its corresponding .gosymtab and .gopclntab sections, as well as their differences from .symtab and debugging-related .[z]debug_* sections.</p>
<h3 id="common-operations-and-examples">Common Operations and Examples</h3>
<p>This is our test program testdata/loop2.go. Let&apos;s first show its source file information, then execute <code>go build -gcflags=&quot;all=-N -l&quot; -o loop2 loop2.go</code> to compile it into an executable program loop2. Later we&apos;ll read loop2 and continue our experiments.</p>
<h4 id="pc-and-source-file-conversion">PC and Source File Conversion</h4>
<p><strong>testdata/loop2.go&#xFF1A;</strong></p>
<pre><code class="lang-go">     <span class="hljs-number">1</span>  <span class="hljs-keyword">package</span> main
     <span class="hljs-number">2</span>  
     <span class="hljs-number">3</span>  <span class="hljs-keyword">import</span> (
     <span class="hljs-number">4</span>      <span class="hljs-string">&quot;fmt&quot;</span>
     <span class="hljs-number">5</span>      <span class="hljs-string">&quot;os&quot;</span>
     <span class="hljs-number">6</span>      <span class="hljs-string">&quot;time&quot;</span>
     <span class="hljs-number">7</span>  )
     <span class="hljs-number">8</span>  
     <span class="hljs-number">9</span>  <span class="hljs-keyword">func</span> init() {
    <span class="hljs-number">10</span>      <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
    <span class="hljs-number">11</span>          <span class="hljs-keyword">for</span> {
    <span class="hljs-number">12</span>              fmt.Println(<span class="hljs-string">&quot;main.func1 pid:&quot;</span>, os.Getpid())
    <span class="hljs-number">13</span>              time.Sleep(time.Second)
    <span class="hljs-number">14</span>          }
    <span class="hljs-number">15</span>      }()
    <span class="hljs-number">16</span>  }
    <span class="hljs-number">17</span>  <span class="hljs-keyword">func</span> main() {
    <span class="hljs-number">18</span>      <span class="hljs-keyword">for</span> {
    <span class="hljs-number">19</span>          fmt.Println(<span class="hljs-string">&quot;main.main pid:&quot;</span>, os.Getpid())
    <span class="hljs-number">20</span>          time.Sleep(time.Second * <span class="hljs-number">3</span>)
    <span class="hljs-number">21</span>      }
    <span class="hljs-number">22</span>  }
</code></pre>
<p>Below we&apos;ll write a test program using <code>debug/gosym</code> to implement conversion between virtual memory address pc and source file locations and functions.</p>
<p><strong>main.go&#xFF1A;</strong></p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;debug/elf&quot;</span>
    <span class="hljs-string">&quot;debug/gosym&quot;</span>
)

<span class="hljs-keyword">func</span> main() {
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) != <span class="hljs-number">2</span> {
        fmt.Fprintln(os.Stderr, <span class="hljs-string">&quot;usage: go run main.go &lt;prog&gt;&quot;</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }
    prog := os.Args[<span class="hljs-number">1</span>]

    <span class="hljs-comment">// open elf</span>
    file, err := elf.Open(prog)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }

    gosymtab, _ := file.Section(<span class="hljs-string">&quot;.gosymtab&quot;</span>).Data()
    gopclntab, _ := file.Section(<span class="hljs-string">&quot;.gopclntab&quot;</span>).Data()

    pclntab := gosym.NewLineTable(gopclntab, file.Section(<span class="hljs-string">&quot;.text&quot;</span>).Addr)
    table, _ := gosym.NewTable(gosymtab, pclntab)

    <span class="hljs-comment">// table.LineToPC(line, num), here `line` must be absolute path</span>
    pc, fn, err := table.LineToPC(<span class="hljs-string">&quot;/root/debugger101/testdata/loop2.go&quot;</span>, <span class="hljs-number">3</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(err)
    } <span class="hljs-keyword">else</span> {
        fmt.Printf(<span class="hljs-string">&quot;pc =&gt; %#x\tfn =&gt; %s\n&quot;</span>, pc, fn.Name)
    }

    pc, fn, _ = table.LineToPC(<span class="hljs-string">&quot;/path-to/testdata/loop2.go&quot;</span>, <span class="hljs-number">9</span>)
    fmt.Printf(<span class="hljs-string">&quot;pc =&gt; %#x\tfn =&gt; %s\n&quot;</span>, pc, fn.Name)

    pc, fn, _ = table.LineToPC(<span class="hljs-string">&quot;/path-to/testdata/loop2.go&quot;</span>, <span class="hljs-number">11</span>)
    fmt.Printf(<span class="hljs-string">&quot;pc =&gt; %#x\tfn =&gt; %s\n&quot;</span>, pc, fn.Name)

    pc, fn, _ = table.LineToPC(<span class="hljs-string">&quot;/path-to/testdata/loop2.go&quot;</span>, <span class="hljs-number">17</span>)
    fmt.Printf(<span class="hljs-string">&quot;pc =&gt; %#x\tfn =&gt; %s\n&quot;</span>, pc, fn.Name)

    <span class="hljs-comment">// here 0x4b86cf is hardcoded, it&apos;s the address of loop2.go:9</span>
    f, l, fn := table.PCToLine(<span class="hljs-number">0x4b86cf</span>)
    fmt.Printf(<span class="hljs-string">&quot;pc =&gt; %#x\tfn =&gt; %s\tpos =&gt; %s:%d\n&quot;</span>, <span class="hljs-number">0x4b86cf</span>, fn.Name, f, l)
}
</code></pre>
<p>Run the test with <code>go run main.go ../testdata/loop2</code>. Note that in the above program, we used absolute paths when specifying source files. We&apos;ll get the following output:</p>
<pre><code class="lang-bash">$ go run main.go ../testdata/loop2
no code at /root/debugger101/testdata/loop2.go:3
pc =&gt; 0x4b86cf  fn =&gt; main.init.0.func1
pc =&gt; 0x4b8791  fn =&gt; main.init.0.func1
pc =&gt; 0x4b85b1  fn =&gt; main.main
pc =&gt; 0x4b86cf  fn =&gt; main.init.0.func1 pos =&gt; /root/debugger101/testdata/loop2.go:9
</code></pre>
<p>In the above test program, we initially specified a source file location at loop2.go:3. Looking at the source code, this location contains import declarations without any functions, so no corresponding instruction was found, resulting in the error message &quot;no code at ....loop2.go:3&quot;. The remaining test cases specified valid source code locations and output the corresponding instruction addresses.</p>
<p>Then we used the pc value 0x4b86cf from the first test case loop2.go:9 as the parameter for table.PCToLine(...) to test conversion from pc to source file location, and the program correctly output the source file location.</p>
<h4 id="runtime-stack-trace">Runtime Stack Trace</h4>
<p>Go programs can propagate errors not only through error returns but also through panic. Since the panic propagation path might be quite long, it continues until it&apos;s either recovered by the current goroutine or causes the process to crash.</p>
<p>When a panic occurs, if we actively recover it, we also want to print the call stack to track the source of the problem. If it&apos;s not recovered and causes the process to crash, the runtime will also print the call stack information for each goroutine. Both methods aim to help us easily locate the source of the panic.</p>
<p>Here&apos;s an example demonstrating how to recover from a panic and print call stack information:</p>
<p><strong>main.go</strong></p>
<pre><code class="lang-go"><span class="hljs-number">1</span>  <span class="hljs-keyword">package</span> main
<span class="hljs-number">2</span>  
<span class="hljs-number">3</span>  <span class="hljs-keyword">import</span> (
<span class="hljs-number">4</span>      <span class="hljs-string">&quot;runtime/debug&quot;</span>
<span class="hljs-number">5</span>  )
<span class="hljs-number">6</span>  
<span class="hljs-number">7</span>  <span class="hljs-keyword">func</span> main() {
<span class="hljs-number">8</span>      <span class="hljs-keyword">defer</span> <span class="hljs-keyword">func</span>() {
<span class="hljs-number">9</span>          <span class="hljs-keyword">if</span> e := <span class="hljs-built_in">recover</span>(); e != <span class="hljs-literal">nil</span> {
<span class="hljs-number">10</span>              debug.PrintStack()
<span class="hljs-number">11</span>          }
<span class="hljs-number">12</span>      }()
<span class="hljs-number">13</span>      f1()
<span class="hljs-number">14</span>  }
<span class="hljs-number">15</span>  
<span class="hljs-number">16</span>  <span class="hljs-keyword">func</span> f1() {
<span class="hljs-number">17</span>      f2()
<span class="hljs-number">18</span>  }
<span class="hljs-number">19</span>  
<span class="hljs-number">20</span>  <span class="hljs-keyword">func</span> f2() {
<span class="hljs-number">21</span>      <span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;let&apos;s panic&quot;</span>)
<span class="hljs-number">22</span>  }
</code></pre>
<p>Run <code>go run main.go</code> to test:</p>
<pre><code class="lang-bash">$ go run main.go

goroutine 1 [running]:
runtime/debug.Stack(0xc00001408b, 0x8, 0xc000096df0)
    /usr/<span class="hljs-built_in">local</span>/go/src/runtime/debug/stack.go:24 +0x9f
runtime/debug.PrintStack()
    /usr/<span class="hljs-built_in">local</span>/go/src/runtime/debug/stack.go:16 +0x25
main.main.func1()
    /Users/zhangjie/main.go:10 +0x45
panic(0x1084480, 0x10aff40)
    /usr/<span class="hljs-built_in">local</span>/go/src/runtime/panic.go:969 +0x175
main.f2(...)
    /Users/zhangjie/main.go:21
main.f1(...)
</code></pre>
<p>How to read the above call stack information:</p>
<ul>
<li>First, looking from top to bottom, runtime/debug.Stack-&gt;runtime/debug.PrintStack-&gt;main.main.func1, this is where the panic was recovered;</li>
<li>Continuing down, we can see where the panic was generated, panic-&gt;main.f2, notice that this function called the panic method on line 21, we&apos;ve found where the panic occurred;</li>
<li>The rest of the call stack doesn&apos;t need to be examined;</li>
</ul>
<p>We&apos;ve mentioned several times that <strong>Go runtime call stack information is built based on .gopclntab</strong>, but how?</p>
<h4 id="how-stack-trace-is-implemented">How Stack Trace is Implemented</h4>
<h5 id="common-methods-for-implementing-stack-trace">Common Methods for Implementing Stack Trace</h5>
<p>How is stack unwinding implemented? Let&apos;s first discuss the general approach:</p>
<ul>
<li>First, get the current program&apos;s pc information. Once pc is determined, we can determine the stack frame corresponding to the current function f;</li>
<li>Then get the current program&apos;s bp information (called fp in Go), which allows us to get the return address;</li>
<li>The return address is usually in the stack frame of the caller&apos;s function. Use this return address as the new pc;</li>
<li>Repeat the previous steps until the stack trace depth requirement is met;</li>
</ul>
<h5 id="go-runtime-uses-gopclntab-to-implement-stack-trace">Go Runtime Uses .gopclntab to Implement Stack Trace</h5>
<p>To understand this, we should first understand the design of .gopclntab. This content can be referenced in <a href="https://docs.google.com/document/d/1lyPIbmsYbXnpNj57a261hgOYVpNRcgydurVQIyZOz_o/pub" target="_blank">Go 1.2 Runtime Symbol Information</a>. Then we can look at the implementation, specifically the structure of gosym.Table and related types.</p>
<p>At the beginning of this article, we&apos;ve already shown the design of package debug/gosym. From this, we can see that the Table structure contains many Syms, Funcs, Files, and Objs. Further combining with its exposed methods, it&apos;s not difficult to see that we can easily convert between pc, file, lineno, and func.</p>
<p>Consider what a call stack is - it&apos;s a series of caller-callee relationships in method calls. This Table doesn&apos;t contain that, it&apos;s just used for auxiliary queries.</p>
<ul>
<li>To get the call stack, first you need to be able to get the current pc value of the goroutine, which Go runtime can definitely get. With pc, we can find the current function name through gosym.Table;</li>
<li>Then we need to know the return address of the current function call, which requires getting bp (called fp in Go) through Go runtime, and using it to find the location storing the return address;</li>
<li>In most cases, the return address returns to the function call in the caller (unless tail recursion optimization doesn&apos;t return, but Go compiler doesn&apos;t support tail recursion optimization, so we can ignore this). Use this return address as pc, find the corresponding function definition in gosym.Table, thus determining a caller;</li>
<li>Repeat the above process until the stack trace depth requirement is met.</li>
</ul>
<p>Go standard library <code>runtime/debug.PrintStack()</code> is implemented this way, but it considers more comprehensively, such as needing STW when printing all goroutines&apos; call stacks, call stack information might exceed goroutine stack limit, so it switches to systemstack first to generate call stack information, considers impact on gc, etc.</p>
<h5 id="debugger-uses-gopclntab--fde-to-implement-stack-trace">Debugger Uses .gopclntab + FDE to Implement Stack Trace</h5>
<p>Based on the previous analysis of gosym.Table, we can easily understand that if we only use .gopclntab to implement stack unwinding, it&apos;s impossible - we at least need pc and bp information. Moreover, in the debugger, it&apos;s difficult to control goroutines as flexibly as Go runtime, such as getting various context information of goroutines.</p>
<p><strong>So how should the debugger do it?</strong></p>
<p><strong>Researching delve source code reveals that in <a href="https://sourcegraph.com/github.com/go-delve/delve@913153e7ffb62512ccdf850bc37bf3abd3aecc2b/-/blob/pkg/proc/stack.go?subtree=true#L115" target="_blank">go-delve/delve@913153e7</a> and earlier versions, it was implemented using gosym.Table combined with DWARF FDE</strong>:</p>
<ul>
<li>dlv first uses DWARF .debug_frame section to build FDE list;</li>
<li>dlv gets the tracee&apos;s pc value, then traverses the FDE list to find the FDE whose address range covers pc, this FDE is the stack frame of the function corresponding to pc;</li>
<li>Then to find the caller, dlv gets the bp value, calculates the return address location, reads the return address from that location, then traverses the FDE list to find the FDE whose address range covers this return address, this FDE corresponds to the caller;</li>
<li>Repeat the above process until the stack trace depth requirement is met;</li>
</ul>
<p><strong>To find caller-callee relationships, dlv processes according to the above process. As for the callee&apos;s current pc and the pc at the caller&apos;s call to the current function, the conversion between these virtual memory addresses and function names, source file location information is still implemented through gosym.Table.</strong></p>
<p><strong>Actually, go-delve/delve&apos;s implementation took a bit of a &quot;shortcut&quot; here. Originally, it could have used .[z]debug_line to implement pc and file:lineno conversion, and could have used .[z]debug_frame to determine the call stack.</strong></p>
<p>It needs to be clear that <strong>.gopclntab only records pc and source file location mapping information for pure Go programs, it doesn&apos;t include parts of cgo programs, because C compilers don&apos;t understand these things, so it has certain limitations.</strong> However, generating .[z]debug_line and .[z]debug_frame information is supported by common compilers and can better solve these limitation problems.</p>
<p>In <a href="https://sourcegraph.com/github.com/go-delve/delve@6d405179/-/blob/pkg/proc/stack.go?subtree=true#L113" target="_blank">go-delve/delve@6d405179</a>, project core developer aarzilli solved this problem and specifically emphasized in the commit record the issue of using .[z]debug_line to replace .gosymtab and .gopclntab:</p>
<pre><code class="lang-bash">commit 6d40517944d40113469b385784f47efa4a25080d
Author: aarzilli &lt;alessandro.arzilli@gmail.com&gt;
Date:   Fri Sep 1 15:30:45 2017 +0200

    proc: replace all uses of gosymtab/gopclntab with uses of debug_line

    gosymtab and gopclntab only contain informations about go code, linked
    C code isn<span class="hljs-string">&apos;t there, we should use debug_line instead to also cover C.

    Updates #935
</span></code></pre>
<p>Ok, everyone should understand the implementation principle now. We will practice this in the next chapter during debugger development.</p>
<h3 id="section-summary">Section Summary</h3>
<p>This section introduced the design of the standard library debug/gosym package and demonstrated how to convert between instruction addresses and source code locations. It also introduced how the standard library debug.PrintStack() implements runtime call stack tracing based on .gosymtab and .gopclntab. It also introduced how the famous delve debugger initially used .gosymtab and .gopclntab + DWARF FDE to implement stack tracing, and how it later migrated to DWARF .[z]debug_line and .[z]debug_frame to more comprehensively support debugging for cgo compatibility.</p>
<p>Everyone should have some understanding of this content now. Next, we will start learning about the debugging information standard DWARF.</p>
<h3 id="references">References</h3>
<ol>
<li>How to Fool Analysis Tools, <a href="https://tuanlinh.gitbook.io/ctf/golang-function-name-obfuscation-how-to-fool-analysis-tools" target="_blank">https://tuanlinh.gitbook.io/ctf/golang-function-name-obfuscation-how-to-fool-analysis-tools</a></li>
<li>Go 1.2 Runtime Symbol Information, Russ Cox, <a href="https://docs.google.com/document/d/1lyPIbmsYbXnpNj57a261hgOYVpNRcgydurVQIyZOz_o/pub" target="_blank">https://docs.google.com/document/d/1lyPIbmsYbXnpNj57a261hgOYVpNRcgydurVQIyZOz_o/pub</a></li>
<li>Some notes on the structure of Go Binaries, <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/GoBinaryStructureNotes" target="_blank">https://utcc.utoronto.ca/~cks/space/blog/programming/GoBinaryStructureNotes</a></li>
<li>Buiding a better Go Linker, Austin Clements, <a href="https://docs.google.com/document/d/1D13QhciikbdLtaI67U6Ble5d_1nsI4befEd6_k1z91U/view" target="_blank">https://docs.google.com/document/d/1D13QhciikbdLtaI67U6Ble5d_1nsI4befEd6_k1z91U/view</a></li>
<li>Time for Some Function Recovery, <a href="https://www.mdeditor.tw/pl/2DRS/zh-hk" target="_blank">https://www.mdeditor.tw/pl/2DRS/zh-hk</a></li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="1-elf.html" class="navigation navigation-prev " aria-label="Previous page: 7.6.1 debug/elf">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="3-dwarf.html" class="navigation navigation-next " aria-label="Next page: 7.6.3 debug/dwarf">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"7.6.2 debug/gosym","level":"1.7.6.2","depth":3,"next":{"title":"7.6.3 debug/dwarf","level":"1.7.6.3","depth":3,"path":"7-headto-sym-debugger/6-gopkg-debug/3-dwarf.md","ref":"7-headto-sym-debugger/6-gopkg-debug/3-dwarf.md","articles":[]},"previous":{"title":"7.6.1 debug/elf","level":"1.7.6.1","depth":3,"path":"7-headto-sym-debugger/6-gopkg-debug/1-elf.md","ref":"7-headto-sym-debugger/6-gopkg-debug/1-elf.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc","github"],"pluginsConfig":{"github":{"url":"https://github.com/hitzhangjie/golang-debugger-book"},"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"7-headto-sym-debugger/6-gopkg-debug/2-gosym.md","mtime":"2025-06-17T03:44:29.818Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-17T03:48:05.806Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


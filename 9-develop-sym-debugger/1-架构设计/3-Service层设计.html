
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>9.1.3 Service Layer Design · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="4-后端符号层设计.html" />
    
    
    <link rel="prev" href="2-前端UI层设计.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../2-preface/">
            
                <a href="../../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../3-terms/">
            
                <a href="../../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../4-basics/">
            
                <a href="../../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../4-basics/1-purposes.html">
            
                <a href="../../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../4-basics/2-dependencies.html">
            
                <a href="../../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../4-basics/3-countertactics.html">
            
                <a href="../../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../5-debugger-skeleton/">
            
                <a href="../../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../6-develop-inst-debugger/">
            
                <a href="../../6-develop-inst-debugger/">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../6-develop-inst-debugger/1-process_start.html">
            
                <a href="../../6-develop-inst-debugger/1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../6-develop-inst-debugger/2-process_attach.html">
            
                <a href="../../6-develop-inst-debugger/2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                <a href="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../6-develop-inst-debugger/4-debug-session.html">
            
                <a href="../../6-develop-inst-debugger/4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../6-develop-inst-debugger/5-disassemble.html">
            
                <a href="../../6-develop-inst-debugger/5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../6-develop-inst-debugger/6-breakpoint.html">
            
                <a href="../../6-develop-inst-debugger/6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../6-develop-inst-debugger/7-breakpoints.html">
            
                <a href="../../6-develop-inst-debugger/7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../6-develop-inst-debugger/8-clear.html">
            
                <a href="../../6-develop-inst-debugger/8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../6-develop-inst-debugger/9-clearall.html">
            
                <a href="../../6-develop-inst-debugger/9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../6-develop-inst-debugger/10-step.html">
            
                <a href="../../6-develop-inst-debugger/10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../6-develop-inst-debugger/11-continue.html">
            
                <a href="../../6-develop-inst-debugger/11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../6-develop-inst-debugger/12-pmem.html">
            
                <a href="../../6-develop-inst-debugger/12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../6-develop-inst-debugger/13-pregs.html">
            
                <a href="../../6-develop-inst-debugger/13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../6-develop-inst-debugger/14-set-mem.html">
            
                <a href="../../6-develop-inst-debugger/14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../../6-develop-inst-debugger/15-set-regs.html">
            
                <a href="../../6-develop-inst-debugger/15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                <a href="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                <a href="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../../6-develop-inst-debugger/80-aslr.html">
            
                <a href="../../6-develop-inst-debugger/80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../../6-develop-inst-debugger/99-more.html">
            
                <a href="../../6-develop-inst-debugger/99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../7-headto-sym-debugger/">
            
                <a href="../../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../7-headto-sym-debugger/2-elf.html">
            
                <a href="../../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../7-headto-sym-debugger/3-syms.html">
            
                <a href="../../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../7-headto-sym-debugger/5-loading.html">
            
                <a href="../../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../8-dwarf/">
            
                <a href="../../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../8-dwarf/1-history.html">
            
                <a href="../../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../8-dwarf/2-overview.html">
            
                <a href="../../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../8-dwarf/3-dwarfdata.html">
            
                <a href="../../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../8-dwarf/4-die/">
            
                <a href="../../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../../8-dwarf/4-die/4-encoding.html">
            
                <a href="../../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../8-dwarf/5-other/">
            
                <a href="../../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../8-dwarf/6-practices.html">
            
                <a href="../../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../../8-dwarf/7-summary.html">
            
                <a href="../../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../">
            
                <a href="../">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="./">
            
                <a href="./">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="1-现代调试器架构.html">
            
                <a href="1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="2-前端UI层设计.html">
            
                <a href="2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.1.3" data-path="3-Service层设计.html">
            
                <a href="3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="4-后端符号层设计.html">
            
                <a href="4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="5-后端目标层设计.html">
            
                <a href="5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="6-日志系统设计.html">
            
                <a href="6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../2-核心调试逻辑/">
            
                <a href="../2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../2-核心调试逻辑/00-cmds.html">
            
                <a href="../2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../2-核心调试逻辑/01-debug-session.html">
            
                <a href="../2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../2-核心调试逻辑/21-disassemble.html">
            
                <a href="../2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../2-核心调试逻辑/24-clear.html">
            
                <a href="../2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../2-核心调试逻辑/25-clearall.html">
            
                <a href="../2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../2-核心调试逻辑/26-step.html">
            
                <a href="../2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../2-核心调试逻辑/27-continue.html">
            
                <a href="../2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../2-核心调试逻辑/28-pmem.html">
            
                <a href="../2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../2-核心调试逻辑/29-regs.html">
            
                <a href="../2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../2-核心调试逻辑/30-call-frame.html">
            
                <a href="../2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../2-核心调试逻辑/31-vars.html">
            
                <a href="../2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../2-核心调试逻辑/32-funcs.html">
            
                <a href="../2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../2-核心调试逻辑/33-goroutines.html">
            
                <a href="../2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../3-高级功能扩展/">
            
                <a href="../3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../10-extras/">
            
                <a href="../../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../10-extras/1-development-of-debugger.html">
            
                <a href="../../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../../10-extras/2-development-of-logging.html">
            
                <a href="../../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../../10-extras/3-development-of-metrics.html">
            
                <a href="../../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../../10-extras/4-development-of-tracing.html">
            
                <a href="../../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../../10-extras/5-development-of-bisect.html">
            
                <a href="../../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../../10-extras/6-development-of-ebpf.html">
            
                <a href="../../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../../10-extras/7-development-of-replay.html">
            
                <a href="../../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../11-thanks/">
            
                <a href="../../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../12-appendix/">
            
                <a href="../../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../../12-appendix/1-go-programme-start.html">
            
                <a href="../../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../../12-appendix/3-git-bisect.html">
            
                <a href="../../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../../12-appendix/80-go-tool-compile.html">
            
                <a href="../../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../../12-appendix/81-go-tool-asm.html">
            
                <a href="../../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../../12-appendix/82-go-tool-link.html">
            
                <a href="../../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >9.1.3 Service Layer Design</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="service-layer-design">Service Layer Design</h2>
<p><img alt="arch" src="assets/debugger-arch.png" width="700px"></p>
<p>In the frontend-backend separation architecture of the debugger, the frontend and backend need to communicate through the service layer. Although there are two types of debugging: local debugging and remote debugging, from an architectural design perspective, the backend always hopes to handle requests and responses in the form of API calls.</p>
<p>In remote debugging scenarios, the frontend and backend interact using a C/S protocol request method, and the backend naturally provides services in the form of API calls; for local debugging scenarios, to achieve architectural elegance and unification, the in-process logic is split into two parts: one part is the frontend logic, and the other is the backend logic. They communicate via net.Pipe using a protocol.</p>
<ul>
<li>Remote debugging is accomplished through real C/S network communication to send, process, and respond to debugging requests. To simplify packet receiving, unpacking, encoding/decoding, and serialization, we can directly use the JSON-RPC implementation provided by the Go standard library to complete the network communication between the debugger frontend and backend.</li>
<li>Local debugging is implemented by creating a <code>preConnectedListener</code> based on net.Pipe, which implements the net.Listener interface, so that the connection between the frontend and backend can be established through a unified Accept operation.</li>
</ul>
<p>In this way, the entire service layer&apos;s communication interface can be unified using the network layer&apos;s communication interface to establish connections, and then unified through API calls to send, process, and respond to requests, making the overall code logic very elegant. The following will provide a detailed introduction.</p>
<h3 id="remote-debugging-json-rpc-over-network">Remote Debugging: JSON-RPC over network</h3>
<p>As mentioned in the overview design, in remote debugging scenarios, the frontend and backend of the debugger need to communicate over the network. We use JSON-RPC to implement communication between the frontend and backend. The service layer design for remote debugging is as follows.</p>
<p align="center">
<img alt="service-jsonrpc" src="assets/service-jsonrpc.png">
</p>

<p>RPC is a common communication pattern in client/server architecture design. Its philosophy is to allow the client to request the server&apos;s interface handler functions as if calling local methods, while the underlying details such as service discovery, rate limiting, circuit breaking, serialization, encoding/decoding, and network communication are all handled in the stub code and lower-level frameworks.</p>
<p>We hope to enable the debugger frontend and backend to communicate via RPC, which is valuable for future protocol extensions and simplifying coding complexity. However, we do not want to introduce heavy frameworks like GRPC. What should we do? The Go standard library provides good support for http and JSON-RPC, so we can implement JSON-RPC communication based on the standard library. Of course, if the client and server run on the same host, UnixConn-based communication can also be considered.</p>
<blockquote>
<p>In the demo implementation of the debugger that accompanies this book, network communication and RPC are the foundation for implementing the frontend-backend separation architecture, but they are not the most difficult part of implementing a Go symbol-level debugger.</p>
<p>The author assumes that readers are already familiar with RPC-related knowledge, so this book will not provide a lengthy introduction to these topics. If you are interested, you can search for relevant materials online.</p>
</blockquote>
<h3 id="local-debugging-json-rpc-over-netpipe">Local Debugging: JSON-RPC over net.Pipe</h3>
<p>How should the frontend and backend of the debugger communicate during local debugging? We are familiar with many inter-process communication methods, such as pipe, fifo, shm, etc. In Go programs, communication between goroutines widely adopts the idea of Communicating Sequential Processes (CSP), i.e., communication via channels.</p>
<p>The Go standard library encapsulates net.pipe based on channels. net.pipe internally contains two channels, one for read operations (readonly) and one for write operations (writeonly):</p>
<ul>
<li>rdRx, a read-only channel, used to read data sent from the other end of the pipe;</li>
<li>rdTx, a write-only channel, used to send data to the other end of the pipe;</li>
</ul>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> pipe <span class="hljs-keyword">struct</span> {
    wrMu sync.Mutex <span class="hljs-comment">// Serialize Write operations</span>

    <span class="hljs-comment">// Used by local Read to interact with remote Write.</span>
    <span class="hljs-comment">// Successful receive on rdRx is always followed by send on rdTx.</span>
    rdRx &lt;-<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">byte</span>
    rdTx <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>

    <span class="hljs-comment">// Used by local Write to interact with remote Read.</span>
    <span class="hljs-comment">// Successful send on wrTx is always followed by receive on wrRx.</span>
    wrTx <span class="hljs-keyword">chan</span>&lt;- []<span class="hljs-keyword">byte</span>
    wrRx &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>

    once       sync.Once <span class="hljs-comment">// Protects closing localDone</span>
    localDone  <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}
    remoteDone &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}

    readDeadline  pipeDeadline
    writeDeadline pipeDeadline
}
</code></pre>
<p>The function <code>net.Pipe() (Conn, Conn)</code> prepares such a full-duplex pipe for us and returns two net.Conn instances, which are actually net.pipe. We can then use the Read and Write functions of net.Conn to implement full-duplex communication within the same process as if performing network operations.</p>
<pre><code class="lang-go"><span class="hljs-comment">// Pipe creates a synchronous, in-memory, full duplex</span>
<span class="hljs-comment">// network connection; both ends implement the Conn interface.</span>
<span class="hljs-comment">// Reads on one end are matched with writes on the other,</span>
<span class="hljs-comment">// copying data directly between the two; there is no internal</span>
<span class="hljs-comment">// buffering.</span>
<span class="hljs-keyword">func</span> Pipe() (Conn, Conn) {
    cb1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">byte</span>)
    cb2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">byte</span>)
    cn1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    cn2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    done1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})
    done2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})

    p1 := &amp;pipe{
        rdRx: cb1, rdTx: cn1,
        wrTx: cb2, wrRx: cn2,
        localDone: done1, remoteDone: done2,
        readDeadline:  makePipeDeadline(),
        writeDeadline: makePipeDeadline(),
    }
    p2 := &amp;pipe{
        rdRx: cb2, rdTx: cn2,
        wrTx: cb1, wrRx: cn1,
        localDone: done2, remoteDone: done1,
        readDeadline:  makePipeDeadline(),
        writeDeadline: makePipeDeadline(),
    }
    <span class="hljs-keyword">return</span> p1, p2
}
</code></pre>
<p>So, from the design diagram, communication via net.Pipe is not very different from communication via JSON-RPC. The main difference is that it does not go through the network or the HTTP protocol. This unification of communication operations on net.Conn makes the implementation of frontend-backend communication in the debugger clearer and simpler.</p>
<p align="center">
<img alt="service-pipelistener" src="assets/service-pipelistener.png">
</p>

<p>Next, we need to consider the following issues. Although net.Pipe() returns net.Conn for full-duplex communication:</p>
<ul>
<li><p>The server usually creates a net.Listener and then Accepts client connection requests to create net.Conn;</p>
<p>We can create a new type preconnectedListener that implements the net.Listener interface and internally holds one of the net.Conn returned by <code>net.Pipe() (Conn, Conn)</code>. Each time Accept is called, it directly returns the stored net.Conn.</p>
</li>
<li><p>The client usually creates net.Conn via net.Dial;</p>
<p>The other Conn returned by <code>net.Pipe() (Conn, Conn)</code> serves as the net.Conn for the client&apos;s net.Dial, so the client does not need to use net.Dial to create a connection.</p>
</li>
</ul>
<p>Thus, for local debugging, instead of using <code>net.Listen(network, address)</code>, we use <code>net.ListenerPipe()</code> to return preconnectedListener as net.Listener.</p>
<h3 id="what-rpcs-need-to-be-supported">What RPCs Need to Be Supported</h3>
<p>In the frontend UI layer design, we listed some debugging commands, including subcommands for starting debugging such as <code>attach exec debug trace ...</code>, as well as interactive commands in the debugging session such as <code>breakpoint continue step print ...</code>. When these debugging commands are executed, the debugger frontend will call one or more corresponding API interfaces of the debugger backend to request the backend to complete the response processing.</p>
<p>The following Client interface definition reflects some methods that the debugger needs to expose for client calls. Each Client interface method is a method call convention, with corresponding backend implementations and frontend stub code calls. When the debugger frontend receives and executes a debugging command, it calls one or more client methods, combines some frontend calculations, conversions, and displays, and finally implements the debugging command.</p>
<pre><code class="lang-go"><span class="hljs-comment">// Client represents a client of a debugger service. All client methods are synchronous.</span>
<span class="hljs-keyword">type</span> Client <span class="hljs-keyword">interface</span> {
    <span class="hljs-comment">// ProcessPid returns the pid of the process we are debugging.</span>
    ProcessPid() <span class="hljs-keyword">int</span>

    <span class="hljs-comment">// BuildID returns the BuildID of the process&apos; executable we are debugging.</span>
    BuildID() <span class="hljs-keyword">string</span>

    <span class="hljs-comment">// Detach detaches the debugger, optionally killing the process.</span>
    Detach(killProcess <span class="hljs-keyword">bool</span>) error

    <span class="hljs-comment">// Restart restarts program. Set true if you want to rebuild the process we are debugging.</span>
    Restart(rebuild <span class="hljs-keyword">bool</span>) ([]api.DiscardedBreakpoint, error)
    <span class="hljs-comment">// RestartFrom restarts program from the specified position.</span>
    RestartFrom(rerecord <span class="hljs-keyword">bool</span>, pos <span class="hljs-keyword">string</span>, resetArgs <span class="hljs-keyword">bool</span>, newArgs []<span class="hljs-keyword">string</span>, newRedirects [<span class="hljs-number">3</span>]<span class="hljs-keyword">string</span>, rebuild <span class="hljs-keyword">bool</span>) ([]api.DiscardedBreakpoint, error)

    <span class="hljs-comment">// GetState returns the current debugger state.</span>
    GetState() (*api.DebuggerState, error)
    <span class="hljs-comment">// GetStateNonBlocking returns the current debugger state, returning immediately if the target is already running.</span>
    GetStateNonBlocking() (*api.DebuggerState, error)

    <span class="hljs-comment">// Continue resumes process execution.</span>
    Continue() &lt;-<span class="hljs-keyword">chan</span> *api.DebuggerState
    <span class="hljs-comment">// Rewind resumes process execution backwards.</span>
    Rewind() &lt;-<span class="hljs-keyword">chan</span> *api.DebuggerState
    <span class="hljs-comment">// DirectionCongruentContinue resumes process execution, if a reverse next, step or stepout operation is in progress it will resume execution backward.</span>
    DirectionCongruentContinue() &lt;-<span class="hljs-keyword">chan</span> *api.DebuggerState
    <span class="hljs-comment">// Next continues to the next source line, not entering function calls.</span>
    Next() (*api.DebuggerState, error)
    <span class="hljs-comment">// ReverseNext continues backward to the previous line of source code, not entering function calls.</span>
    ReverseNext() (*api.DebuggerState, error)
    <span class="hljs-comment">// Step continues to the next source line, entering function calls.</span>
    Step() (*api.DebuggerState, error)
    <span class="hljs-comment">// ReverseStep continues backward to the previous line of source code, entering function calls.</span>
    ReverseStep() (*api.DebuggerState, error)
    <span class="hljs-comment">// StepOut continues to the return address of the current function.</span>
    StepOut() (*api.DebuggerState, error)
    <span class="hljs-comment">// ReverseStepOut continues backward to the caller of the current function.</span>
    ReverseStepOut() (*api.DebuggerState, error)
    <span class="hljs-comment">// Call resumes process execution while making a function call.</span>
    Call(goroutineID <span class="hljs-keyword">int64</span>, expr <span class="hljs-keyword">string</span>, unsafe <span class="hljs-keyword">bool</span>) (*api.DebuggerState, error)

    <span class="hljs-comment">// StepInstruction will step a single cpu instruction.</span>
    StepInstruction(skipCalls <span class="hljs-keyword">bool</span>) (*api.DebuggerState, error)
    <span class="hljs-comment">// ReverseStepInstruction will reverse step a single cpu instruction.</span>
    ReverseStepInstruction(skipCalls <span class="hljs-keyword">bool</span>) (*api.DebuggerState, error)
    <span class="hljs-comment">// SwitchThread switches the current thread context.</span>
    SwitchThread(threadID <span class="hljs-keyword">int</span>) (*api.DebuggerState, error)
    <span class="hljs-comment">// SwitchGoroutine switches the current goroutine (and the current thread as well)</span>
    SwitchGoroutine(goroutineID <span class="hljs-keyword">int64</span>) (*api.DebuggerState, error)
    <span class="hljs-comment">// Halt suspends the process.</span>
    Halt() (*api.DebuggerState, error)

    <span class="hljs-comment">// GetBreakpoint gets a breakpoint by ID.</span>
    GetBreakpoint(id <span class="hljs-keyword">int</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// GetBreakpointByName gets a breakpoint by name.</span>
    GetBreakpointByName(name <span class="hljs-keyword">string</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// CreateBreakpoint creates a new breakpoint.</span>
    CreateBreakpoint(*api.Breakpoint) (*api.Breakpoint, error)
    <span class="hljs-comment">// CreateBreakpointWithExpr creates a new breakpoint and sets an expression to restore it after it is disabled.</span>
    CreateBreakpointWithExpr(*api.Breakpoint, <span class="hljs-keyword">string</span>, [][<span class="hljs-number">2</span>]<span class="hljs-keyword">string</span>, <span class="hljs-keyword">bool</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// CreateWatchpoint creates a new watchpoint.</span>
    CreateWatchpoint(api.EvalScope, <span class="hljs-keyword">string</span>, api.WatchType) (*api.Breakpoint, error)
    <span class="hljs-comment">// ListBreakpoints gets all breakpoints.</span>
    ListBreakpoints(<span class="hljs-keyword">bool</span>) ([]*api.Breakpoint, error)
    <span class="hljs-comment">// ClearBreakpoint deletes a breakpoint by ID.</span>
    ClearBreakpoint(id <span class="hljs-keyword">int</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// ClearBreakpointByName deletes a breakpoint by name</span>
    ClearBreakpointByName(name <span class="hljs-keyword">string</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// ToggleBreakpoint toggles on or off a breakpoint by ID.</span>
    ToggleBreakpoint(id <span class="hljs-keyword">int</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// ToggleBreakpointByName toggles on or off a breakpoint by name.</span>
    ToggleBreakpointByName(name <span class="hljs-keyword">string</span>) (*api.Breakpoint, error)
    <span class="hljs-comment">// AmendBreakpoint allows user to update an existing breakpoint for example to change the information</span>
    <span class="hljs-comment">// retrieved when the breakpoint is hit or to change, add or remove the break condition</span>
    AmendBreakpoint(*api.Breakpoint) error
    <span class="hljs-comment">// CancelNext cancels a Next or Step call that was interrupted by a manual stop or by another breakpoint</span>
    CancelNext() error

    <span class="hljs-comment">// ListThreads lists all threads.</span>
    ListThreads() ([]*api.Thread, error)
    <span class="hljs-comment">// GetThread gets a thread by its ID.</span>
    GetThread(id <span class="hljs-keyword">int</span>) (*api.Thread, error)

    <span class="hljs-comment">// ListPackageVariables lists all package variables in the context of the current thread.</span>
    ListPackageVariables(filter <span class="hljs-keyword">string</span>, cfg api.LoadConfig) ([]api.Variable, error)
    <span class="hljs-comment">// EvalVariable returns a variable in the context of the current thread.</span>
    EvalVariable(scope api.EvalScope, symbol <span class="hljs-keyword">string</span>, cfg api.LoadConfig) (*api.Variable, error)

    <span class="hljs-comment">// SetVariable sets the value of a variable</span>
    SetVariable(scope api.EvalScope, symbol, value <span class="hljs-keyword">string</span>) error

    <span class="hljs-comment">// ListSources lists all source files in the process matching filter.</span>
    ListSources(filter <span class="hljs-keyword">string</span>) ([]<span class="hljs-keyword">string</span>, error)
    <span class="hljs-comment">// ListFunctions lists all functions in the process matching filter.</span>
    ListFunctions(filter <span class="hljs-keyword">string</span>, tracefollow <span class="hljs-keyword">int</span>) ([]<span class="hljs-keyword">string</span>, error)
    <span class="hljs-comment">// ListTypes lists all types in the process matching filter.</span>
    ListTypes(filter <span class="hljs-keyword">string</span>) ([]<span class="hljs-keyword">string</span>, error)
    <span class="hljs-comment">// ListPackagesBuildInfo lists all packages in the process matching filter.</span>
    ListPackagesBuildInfo(filter <span class="hljs-keyword">string</span>, includeFiles <span class="hljs-keyword">bool</span>) ([]api.PackageBuildInfo, error)
    <span class="hljs-comment">// ListLocalVariables lists all local variables in scope.</span>
    ListLocalVariables(scope api.EvalScope, cfg api.LoadConfig) ([]api.Variable, error)
    <span class="hljs-comment">// ListFunctionArgs lists all arguments to the current function.</span>
    ListFunctionArgs(scope api.EvalScope, cfg api.LoadConfig) ([]api.Variable, error)
    <span class="hljs-comment">// ListThreadRegisters lists registers and their values, for the given thread.</span>
    ListThreadRegisters(threadID <span class="hljs-keyword">int</span>, includeFp <span class="hljs-keyword">bool</span>) (api.Registers, error)
    <span class="hljs-comment">// ListScopeRegisters lists registers and their values, for the given scope.</span>
    ListScopeRegisters(scope api.EvalScope, includeFp <span class="hljs-keyword">bool</span>) (api.Registers, error)

    <span class="hljs-comment">// ListGoroutines lists all goroutines.</span>
    ListGoroutines(start, count <span class="hljs-keyword">int</span>) ([]*api.Goroutine, <span class="hljs-keyword">int</span>, error)
    <span class="hljs-comment">// ListGoroutinesWithFilter lists goroutines matching the filters</span>
    ListGoroutinesWithFilter(start, count <span class="hljs-keyword">int</span>, filters []api.ListGoroutinesFilter, group *api.GoroutineGroupingOptions, scope *api.EvalScope) ([]*api.Goroutine, []api.GoroutineGroup, <span class="hljs-keyword">int</span>, <span class="hljs-keyword">bool</span>, error)

    <span class="hljs-comment">// Stacktrace returns stacktrace</span>
    Stacktrace(goroutineID <span class="hljs-keyword">int64</span>, depth <span class="hljs-keyword">int</span>, opts api.StacktraceOptions, cfg *api.LoadConfig) ([]api.Stackframe, error)

    <span class="hljs-comment">// Ancestors returns ancestor stacktraces</span>
    Ancestors(goroutineID <span class="hljs-keyword">int64</span>, numAncestors <span class="hljs-keyword">int</span>, depth <span class="hljs-keyword">int</span>) ([]api.Ancestor, error)

    <span class="hljs-comment">// AttachedToExistingProcess returns whether we attached to a running process or not</span>
    AttachedToExistingProcess() <span class="hljs-keyword">bool</span>

    <span class="hljs-comment">// FindLocation returns concrete location information described by a location expression</span>
    <span class="hljs-comment">// loc ::= &lt;filename&gt;:&lt;line&gt; | &lt;function&gt;[:&lt;line&gt;] | /&lt;regex&gt;/ | (+|-)&lt;offset&gt; | &lt;line&gt; | *&lt;address&gt;</span>
    <span class="hljs-comment">// * &lt;filename&gt; can be the full path of a file or just a suffix</span>
    <span class="hljs-comment">// * &lt;function&gt; ::= &lt;package&gt;.&lt;receiver type&gt;.&lt;name&gt; | &lt;package&gt;.(*&lt;receiver type&gt;).&lt;name&gt; | &lt;receiver type&gt;.&lt;name&gt; | &lt;package&gt;.&lt;name&gt; | (*&lt;receiver type&gt;).&lt;name&gt; | &lt;name&gt;</span>
    <span class="hljs-comment">// * &lt;function&gt; must be unambiguous</span>
    <span class="hljs-comment">// * /&lt;regex&gt;/ will return a location for each function matched by regex</span>
    <span class="hljs-comment">// * +&lt;offset&gt; returns a location for the line that is &lt;offset&gt; lines after the current line</span>
    <span class="hljs-comment">// * -&lt;offset&gt; returns a location for the line that is &lt;offset&gt; lines before the current line</span>
    <span class="hljs-comment">// * &lt;line&gt; returns a location for a line in the current file</span>
    <span class="hljs-comment">// * *&lt;address&gt; returns the location corresponding to the specified address</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> this function does not actually set breakpoints.</span>
    <span class="hljs-comment">// If findInstruction is true FindLocation will only return locations that correspond to instructions.</span>
    FindLocation(scope api.EvalScope, loc <span class="hljs-keyword">string</span>, findInstruction <span class="hljs-keyword">bool</span>, substitutePathRules [][<span class="hljs-number">2</span>]<span class="hljs-keyword">string</span>) ([]api.Location, <span class="hljs-keyword">string</span>, error)

    <span class="hljs-comment">// DisassembleRange disassemble code between startPC and endPC</span>
    DisassembleRange(scope api.EvalScope, startPC, endPC <span class="hljs-keyword">uint64</span>, flavour api.AssemblyFlavour) (api.AsmInstructions, error)
    <span class="hljs-comment">// DisassemblePC disassemble code of the function containing PC</span>
    DisassemblePC(scope api.EvalScope, pc <span class="hljs-keyword">uint64</span>, flavour api.AssemblyFlavour) (api.AsmInstructions, error)

    <span class="hljs-comment">// Recorded returns true if the target is a recording.</span>
    Recorded() <span class="hljs-keyword">bool</span>
    <span class="hljs-comment">// TraceDirectory returns the path to the trace directory for a recording.</span>
    TraceDirectory() (<span class="hljs-keyword">string</span>, error)
    <span class="hljs-comment">// Checkpoint sets a checkpoint at the current position.</span>
    Checkpoint(where <span class="hljs-keyword">string</span>) (checkpointID <span class="hljs-keyword">int</span>, err error)
    <span class="hljs-comment">// ListCheckpoints gets all checkpoints.</span>
    ListCheckpoints() ([]api.Checkpoint, error)
    <span class="hljs-comment">// ClearCheckpoint removes a checkpoint</span>
    ClearCheckpoint(id <span class="hljs-keyword">int</span>) error

    <span class="hljs-comment">// SetReturnValuesLoadConfig sets the load configuration for return values.</span>
    SetReturnValuesLoadConfig(*api.LoadConfig)

    <span class="hljs-comment">// IsMulticlient returns true if the headless instance is multiclient.</span>
    IsMulticlient() <span class="hljs-keyword">bool</span>

    <span class="hljs-comment">// ListDynamicLibraries returns a list of loaded dynamic libraries.</span>
    ListDynamicLibraries() ([]api.Image, error)

    <span class="hljs-comment">// ExamineMemory returns the raw memory stored at the given address.</span>
    <span class="hljs-comment">// The amount of data to be read is specified by length which must be less than or equal to 1000.</span>
    <span class="hljs-comment">// This function will return an error if it reads less than `length` bytes.</span>
    ExamineMemory(address <span class="hljs-keyword">uint64</span>, length <span class="hljs-keyword">int</span>) ([]<span class="hljs-keyword">byte</span>, <span class="hljs-keyword">bool</span>, error)

    <span class="hljs-comment">// StopRecording stops a recording if one is in progress.</span>
    StopRecording() error

    <span class="hljs-comment">// CoreDumpStart starts creating a core dump to the specified file</span>
    CoreDumpStart(dest <span class="hljs-keyword">string</span>) (api.DumpState, error)
    <span class="hljs-comment">// CoreDumpWait waits for the core dump to finish, or for the specified amount of milliseconds</span>
    CoreDumpWait(msec <span class="hljs-keyword">int</span>) api.DumpState
    <span class="hljs-comment">// CoreDumpCancel cancels a core dump in progress</span>
    CoreDumpCancel() error

    <span class="hljs-comment">// ListTargets returns the list of connected targets</span>
    ListTargets() ([]api.Target, error)
    <span class="hljs-comment">// FollowExec enables or disables the follow exec mode. In follow exec mode</span>
    <span class="hljs-comment">// Delve will automatically debug child processes launched by the target</span>
    <span class="hljs-comment">// process</span>
    FollowExec(<span class="hljs-keyword">bool</span>, <span class="hljs-keyword">string</span>) error
    FollowExecEnabled() <span class="hljs-keyword">bool</span>

    <span class="hljs-comment">// Disconnect closes the connection to the server without sending a Detach request first.</span>
    <span class="hljs-comment">// If cont is true a continue command will be sent instead.</span>
    Disconnect(cont <span class="hljs-keyword">bool</span>) error

    <span class="hljs-comment">// SetDebugInfoDirectories sets directories used to search for debug symbols</span>
    SetDebugInfoDirectories([]<span class="hljs-keyword">string</span>) error

    <span class="hljs-comment">// GetDebugInfoDirectories returns the list of directories used to search for debug symbols</span>
    GetDebugInfoDirectories() ([]<span class="hljs-keyword">string</span>, error)

    <span class="hljs-comment">// GuessSubstitutePath tries to guess a substitute-path configuration for the client</span>
    GuessSubstitutePath() ([][<span class="hljs-number">2</span>]<span class="hljs-keyword">string</span>, error)

    <span class="hljs-comment">// CallAPI allows calling an arbitrary rpc method (used by starlark bindings)</span>
    CallAPI(method <span class="hljs-keyword">string</span>, args, reply <span class="hljs-keyword">interface</span>{}) error
}
</code></pre>
<p>Now you may be surprised: why are so many interfaces needed? If we were making a toy, it would be relatively simple; if we were making a tool of usable quality, it would not be so simple. All the above interfaces have already been implemented in <code>go-delve/delve</code>. In our demo debugger, due to space limitations, we will only discuss the implementation of the most core interfaces. Readers can implement the others themselves or refer to delve&apos;s implementation.</p>
<h3 id="section-summary">Section Summary</h3>
<p>This section introduced the design of the Service layer in the frontend-backend separation architecture of the debugger, including detailed design descriptions for both remote and local debugging, and finally provided the list of RPC interfaces we need to support. In other words, our next task is to implement these RPC interface lists on the frontend and backend.</p>
<blockquote>
<p>ps: In addition to interacting with the debugger by entering debugging commands in the frontend, more user-friendly methods are also needed. For example, you may want to save the current debugging session and continue debugging from here later, or share a complete debugging process with others to help locate problems. go-delve/delve allows users to do this by writing starlark scripts. Within the debugger session, you can automatically execute debugging operations in the script via <code>source /path-to/your.star</code>, which is very convenient. The starlark script can execute some functions pre-supported by dlv, such as <code>dlv_command(&quot;debugging command in the session&quot;)</code> to execute debugging commands, which will eventually be converted into API calls to invoke the implementation logic in the debugger backend. As a supplement to the debugger interaction logic, we briefly mention it here and will introduce it in detail later.</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2-前端UI层设计.html" class="navigation navigation-prev " aria-label="Previous page: 9.1.2 Frontend UI Layer Design">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="4-后端符号层设计.html" class="navigation navigation-next " aria-label="Next page: 9.1.4 Backend Symbol Layer Design">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"9.1.3 Service Layer Design","level":"1.9.1.3","depth":3,"next":{"title":"9.1.4 Backend Symbol Layer Design","level":"1.9.1.4","depth":3,"path":"9-develop-sym-debugger/1-架构设计/4-后端符号层设计.md","ref":"9-develop-sym-debugger/1-架构设计/4-后端符号层设计.md","articles":[]},"previous":{"title":"9.1.2 Frontend UI Layer Design","level":"1.9.1.2","depth":3,"path":"9-develop-sym-debugger/1-架构设计/2-前端UI层设计.md","ref":"9-develop-sym-debugger/1-架构设计/2-前端UI层设计.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc"],"pluginsConfig":{"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"9-develop-sym-debugger/1-架构设计/3-Service层设计.md","mtime":"2025-06-15T11:48:37.354Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-15T13:13:32.255Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


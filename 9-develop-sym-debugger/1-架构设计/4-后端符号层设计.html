
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>9.1.4 Backend Symbol Layer Design · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="5-后端目标层设计.html" />
    
    
    <link rel="prev" href="3-Service层设计.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../2-preface/">
            
                <a href="../../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../3-terms/">
            
                <a href="../../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../4-basics/">
            
                <a href="../../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../4-basics/1-purposes.html">
            
                <a href="../../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../4-basics/2-dependencies.html">
            
                <a href="../../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../4-basics/3-countertactics.html">
            
                <a href="../../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../5-debugger-skeleton/">
            
                <a href="../../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../6-develop-inst-debugger/">
            
                <a href="../../6-develop-inst-debugger/">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../6-develop-inst-debugger/1-process_start.html">
            
                <a href="../../6-develop-inst-debugger/1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../6-develop-inst-debugger/2-process_attach.html">
            
                <a href="../../6-develop-inst-debugger/2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                <a href="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../6-develop-inst-debugger/4-debug-session.html">
            
                <a href="../../6-develop-inst-debugger/4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../6-develop-inst-debugger/5-disassemble.html">
            
                <a href="../../6-develop-inst-debugger/5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../6-develop-inst-debugger/6-breakpoint.html">
            
                <a href="../../6-develop-inst-debugger/6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../6-develop-inst-debugger/7-breakpoints.html">
            
                <a href="../../6-develop-inst-debugger/7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../6-develop-inst-debugger/8-clear.html">
            
                <a href="../../6-develop-inst-debugger/8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../6-develop-inst-debugger/9-clearall.html">
            
                <a href="../../6-develop-inst-debugger/9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../6-develop-inst-debugger/10-step.html">
            
                <a href="../../6-develop-inst-debugger/10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../6-develop-inst-debugger/11-continue.html">
            
                <a href="../../6-develop-inst-debugger/11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../6-develop-inst-debugger/12-pmem.html">
            
                <a href="../../6-develop-inst-debugger/12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../6-develop-inst-debugger/13-pregs.html">
            
                <a href="../../6-develop-inst-debugger/13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../6-develop-inst-debugger/14-set-mem.html">
            
                <a href="../../6-develop-inst-debugger/14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../../6-develop-inst-debugger/15-set-regs.html">
            
                <a href="../../6-develop-inst-debugger/15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                <a href="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                <a href="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../../6-develop-inst-debugger/80-aslr.html">
            
                <a href="../../6-develop-inst-debugger/80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../../6-develop-inst-debugger/99-more.html">
            
                <a href="../../6-develop-inst-debugger/99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../7-headto-sym-debugger/">
            
                <a href="../../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../7-headto-sym-debugger/2-elf.html">
            
                <a href="../../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../7-headto-sym-debugger/3-syms.html">
            
                <a href="../../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../7-headto-sym-debugger/5-loading.html">
            
                <a href="../../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../8-dwarf/">
            
                <a href="../../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../8-dwarf/1-history.html">
            
                <a href="../../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../8-dwarf/2-overview.html">
            
                <a href="../../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../8-dwarf/3-dwarfdata.html">
            
                <a href="../../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../8-dwarf/4-die/">
            
                <a href="../../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../../8-dwarf/4-die/4-encoding.html">
            
                <a href="../../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../8-dwarf/5-other/">
            
                <a href="../../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../8-dwarf/6-practices.html">
            
                <a href="../../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../../8-dwarf/7-summary.html">
            
                <a href="../../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../">
            
                <a href="../">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="./">
            
                <a href="./">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="1-现代调试器架构.html">
            
                <a href="1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="2-前端UI层设计.html">
            
                <a href="2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="3-Service层设计.html">
            
                <a href="3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.1.4" data-path="4-后端符号层设计.html">
            
                <a href="4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="5-后端目标层设计.html">
            
                <a href="5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="6-日志系统设计.html">
            
                <a href="6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../2-核心调试逻辑/">
            
                <a href="../2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../2-核心调试逻辑/00-cmds.html">
            
                <a href="../2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../2-核心调试逻辑/01-debug-session.html">
            
                <a href="../2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../2-核心调试逻辑/21-disassemble.html">
            
                <a href="../2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../2-核心调试逻辑/24-clear.html">
            
                <a href="../2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../2-核心调试逻辑/25-clearall.html">
            
                <a href="../2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../2-核心调试逻辑/26-step.html">
            
                <a href="../2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../2-核心调试逻辑/27-continue.html">
            
                <a href="../2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../2-核心调试逻辑/28-pmem.html">
            
                <a href="../2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../2-核心调试逻辑/29-regs.html">
            
                <a href="../2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../2-核心调试逻辑/30-call-frame.html">
            
                <a href="../2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../2-核心调试逻辑/31-vars.html">
            
                <a href="../2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../2-核心调试逻辑/32-funcs.html">
            
                <a href="../2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../2-核心调试逻辑/33-goroutines.html">
            
                <a href="../2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../3-高级功能扩展/">
            
                <a href="../3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../10-extras/">
            
                <a href="../../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../10-extras/1-development-of-debugger.html">
            
                <a href="../../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../../10-extras/2-development-of-logging.html">
            
                <a href="../../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../../10-extras/3-development-of-metrics.html">
            
                <a href="../../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../../10-extras/4-development-of-tracing.html">
            
                <a href="../../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../../10-extras/5-development-of-bisect.html">
            
                <a href="../../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../../10-extras/6-development-of-ebpf.html">
            
                <a href="../../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../../10-extras/7-development-of-replay.html">
            
                <a href="../../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../11-thanks/">
            
                <a href="../../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../12-appendix/">
            
                <a href="../../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../../12-appendix/1-go-programme-start.html">
            
                <a href="../../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../../12-appendix/3-git-bisect.html">
            
                <a href="../../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../../12-appendix/80-go-tool-compile.html">
            
                <a href="../../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../../12-appendix/81-go-tool-asm.html">
            
                <a href="../../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../../12-appendix/82-go-tool-link.html">
            
                <a href="../../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >9.1.4 Backend Symbol Layer Design</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="backend-symbol-layer-design">Backend Symbol Layer Design</h2>
<p><img alt="arch" src="assets/debugger-arch.png" width="700px"></p>
<p>In this section, we introduce the design of the symbol layer in the debugger backend. The symbol layer here refers to the conversion between instruction addresses and source-level views using DWARF debugging information, such as mapping instruction addresses to source locations, call stacks, or mapping data addresses to data types. In Chapter 8, we introduced the DWARF debugging information standard and provided some examples of obtaining variables, types, line tables, etc., through DWARF. You should now have some understanding of what DWARF is and how to use it.</p>
<p>Due to the complexity of the debugging information standard and the compiler toolchain&apos;s generation of debugging information, even after so many years, the DWARF standard, Go, and delve are still evolving and optimizing. Starting from Go 1.25, DWARFv5 debugging information is generated by default, and the DWARFv6 draft has also been completed. This is a never-ending, continuously evolving process. However, when the author wrote this book, there were many changes from Go 1.13 to Go 1.24, and the Go toolchain&apos;s DWARF information generation and parsing also changed... We will not chase the latest Go 1.25 here; instead, we will introduce according to Go 1.24 and DWARFv4.</p>
<blockquote>
<p>The compiler and linker in Go 1.25 now generate debug information using DWARF version 5; the newer DWARF version reduces the space required for debugging information in Go binaries.</p>
</blockquote>
<h3 id="dwarfv4-sections">DWARFv4 sections</h3>
<p>DWARFv4, the corresponding debug sections in ELF files and their contents are as follows:</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>.debug_abbrev</td>
<td>Stores abbreviation information used in .debug_info</td>
</tr>
<tr>
<td>.debug_arranges</td>
<td>Stores an accelerated lookup table for querying compilation unit info by memory address</td>
</tr>
<tr>
<td>.debug_frame</td>
<td>Stores call stack frame information</td>
</tr>
<tr>
<td>.debug_info</td>
<td>Stores core DWARF data, including DIEs describing variables, code, etc.</td>
</tr>
<tr>
<td>.debug_line</td>
<td>Stores the line number table program (instructions executed by the line table state machine to build the complete line table)</td>
</tr>
<tr>
<td>.debug_loc</td>
<td>Stores location description information</td>
</tr>
<tr>
<td>.debug_macinfo</td>
<td>Stores macro-related description information</td>
</tr>
<tr>
<td>.debug_pubnames</td>
<td>Stores an accelerated lookup table for querying global objects and functions by name</td>
</tr>
<tr>
<td>.debug_pubtypes</td>
<td>Stores an accelerated lookup table for querying global types by name</td>
</tr>
<tr>
<td>.debug_ranges</td>
<td>Stores address ranges referenced by DIEs</td>
</tr>
<tr>
<td>.debug_str</td>
<td>Stores the string table referenced in .debug_info, also referenced by offset</td>
</tr>
<tr>
<td>.debug_types</td>
<td>Stores DIEs describing data types</td>
</tr>
</tbody>
</table>
<p>The reference relationships between these debug sections are shown in the figure below (see DWARFv4 Appendix B for details).</p>
<p><img alt="dwarfv4-sections" src="../../8-dwarf/5-other/assets/dwarfv4-sections.jpg" width="480px"></p>
<p>To better understand this part, you can use the small tool <a href="https://github.com/aarzilli/diexplorer" target="_blank">aarzilli/diexplorer</a> by aarzilli or my <a href="https://github.com/hitzhangjie/dwarfviewer" target="_blank">hitzhangjie/dwarfviewer</a> to browse the debugging information in the debug sections, which is very helpful for deepening your understanding.</p>
<h3 id="dwarfv4-readwrite-and-query">DWARFv4 Read/Write and Query</h3>
<p>To better implement reading and writing of DWARFv4 data and facilitate queries and conversions of different forms of DWARF data, the following packages are designed.</p>
<table>
<thead>
<tr>
<th>package</th>
<th>Purpose and Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>dwarfbuilder</td>
<td>Implements a Builder that can easily generate DWARF debugging information corresponding to different code structures. For example, New() returns a Builder and initially sets the header fields of the DWARF information, then the returned builder can add compilation units, data types, variables, functions, etc. This Builder greatly facilitates the rapid generation of corresponding debugging information for source code. However, this package is not very useful for implementing a debugger, but it is very helpful for verifying how the Go compiler toolchain generates debugging information. Once you understand how the Go compiler toolchain generates DWARF debugging information, you can further understand how to parse and apply the corresponding debugging information. The purpose of this package is more for learning and verifying the generation and application of DWARF debugging information.</td>
</tr>
<tr>
<td>frame</td>
<td>The information in .[z]debug_frame can help build the CFI (Canonical Frame Information). Given any instruction address, we can use the CFI to calculate the current call stack. Each compilation unit in DWARF information may compress multiple Go source files, and each compilation unit starts with a CIE (Common Information Entry), followed by a series of FDEs (Frame Description Entry). Here, the types CommonInformationEntry and FrameDescriptionEntry are defined to represent CIE and FDE, respectively. FDE references CIE, CIE contains the initial instruction sequence, and FDE contains its own instruction sequence. Combining CIE and FDE can build a complete CFI table. To facilitate determining whether an instruction address is within the range of an FDE, the type FrameDescriptionEntry defines the method Cover, and also provides Begin and End to give the range of the FDE. In addition, it defines the method EstablishFrame, which uses a state machine to execute the instruction sequences in CIE and FDE to build all or part of the CFI table as needed, making it easy to calculate the CFA (Canonical Frame Address), which can be further used to calculate the return address of the called function. With this return address (an instruction address), we can calculate the corresponding source code location (such as file name, line number, function name). By iterating this process, we can calculate the complete call stack. <strong>Note: The begin and end in FDE describe the address range of the instruction sequence during the creation, existence, and destruction of the stack frame. See the DWARF v4 standard for details.</strong> The type FrameDescriptionEntries is also defined, which is actually a slice of FDEs with some helper functions, such as FDEForPC for querying the FDE containing a given instruction address. Each function has an FDE, and the instruction range of each function is arranged in order. There is no case where the instruction range of one function&apos;s FDE includes that of another function&apos;s FDE.</td>
</tr>
<tr>
<td>godwarf</td>
<td>This package provides some basic functions. addr.go provides the ability to parse .[z]debug_addr added in DWARF v5. sections.go provides functions to read debugging information from different file formats, such as GetDebugSectionElf, which can read the specified debugging section data from a given ELF file and automatically decompress the data if it is compressed. tree.go provides the ability to read the Tree composed of DIEs. If a compilation unit is not continuous, there will be multiple address ranges in Tree.Ranges. When determining whether the address range of a compilation unit contains a specified instruction address, you need to traverse Tree.Ranges for checking. The Tree.ContainsPC method simplifies this operation. The Tree.Type method also supports reading the type information corresponding to the current TreeNode. type.go defines some types corresponding to Go data types, including basic types like BasicType and composite types like CharType, UcharType, IntType, StructType, SliceType, StringType, etc. These types are all stored as DIEs in .[z]debug_info. tree.go provides a very important function ReadType, which can read the type information defined at a specified offset from DWARF data and establish the correspondence with Go data types through reflect.Kind, making it easy to create variables and assign values using Go&apos;s reflect package.</td>
</tr>
<tr>
<td>line</td>
<td>A very important aspect of symbol-level debugging is the ability to convert between instruction addresses and source file:line numbers. For example, when adding a breakpoint to a statement, it needs to be converted into an instruction patch for the instruction address, or when stopping at a breakpoint, the current source code location should be displayed. The line table is used to implement this conversion. The line table is encoded as a bytecode instruction stream and stored in .[z]debug_line. Each compilation unit has a line table, and the line table data of different compilation units will eventually be merged by the linker. Each line table has a fixed structure for parsing, such as the header field, followed by specific data. line_parser.go provides the ParseAll method to parse the line tables of all compilation units in .[z]debug_line. The type DebugLines represents all line tables, and each compilation unit&apos;s line table corresponds to the type DebugLineInfo. An important field in DebugLineInfo is the instruction sequence, which is executed by a line table state machine defined in state_machine.go. After execution, the complete line table can be built. With the complete line table, we can look up the corresponding source line by PC.</td>
</tr>
<tr>
<td>loclist</td>
<td>The location of an object in memory can be described by a location expression or a location list. If the location of an object may change during its lifetime, a location list is needed. Also, if an object&apos;s storage in memory is not a contiguous segment but consists of multiple non-adjacent segments, a location list is also needed. In DWARF v2~v4, location list information is stored in .[z]debug_loc, and in DWARF v5, it is stored in .[z]debug_loclist. The loclist package supports both the old (DWARF v2~v4) and new (DWARF v5) versions of location lists. The package defines Dwarf2Reader and Dwarf5Reader for reading location lists from the raw data of the old and new versions, respectively.</td>
</tr>
<tr>
<td>op</td>
<td>In op.go, when discussing address expression operations in DWARF, it was mentioned that address operations are performed by executing a stack-based program instruction list. The program instructions are all 1-byte opcodes, defined in this package, and their operands are on the stack. Each opcode has a corresponding function stackfn, which operates on the stack data, takes operands, and pushes the result back onto the stack. The final top element of the stack is the result. opcodes.go defines a series of opcodes, opcode-to-name mappings, and the number of operands for each opcode. registers.go defines the list of registers concerned by DWARF as DwarfRegisters and provides some traversal methods, such as returning the register information for a specified number, or returning the current PC/SP/BP register values.</td>
</tr>
<tr>
<td>reader</td>
<td>This package defines the type Reader, which embeds the Go standard library&apos;s dwarf.Reader to read DIE information from .[z]debug_info. Each DIE in DWARF is organized as a tree, and each DIE corresponds to a dwarf.Entry, which includes the previously mentioned Tag and []Field (Field records Attr information), as well as the DIE&apos;s Offset and whether it contains child DIEs. The Reader here also defines some other functions such as Seek, SeekToEntry, AddrFor, SeekToType, NextType, SeekToTypeNamed, FindEntryNamed, InstructionsForEntryNamed, InstructionsForEntry, NextMemberVariable, NextPackageVariable, NextCompileUnit. The package also defines the type Variable, which embeds the tree godwarf.Tree describing a variable&apos;s DIE. It also provides the function Variables to extract the list of variables contained in a specified DIE tree.</td>
</tr>
<tr>
<td>regnum</td>
<td>Defines the mapping between register numbers and register names, and provides functions for fast bidirectional lookup.</td>
</tr>
<tr>
<td>leb128</td>
<td>Implements several utility functions: reading an int64 from a sleb128-encoded reader; reading a uint64 from a uleb128-encoded reader; writing an int64 to a writer in sleb128 encoding; writing a uint64 to a writer in uleb128 encoding.</td>
</tr>
<tr>
<td>dwarf</td>
<td>Implements several utility functions: reading basic information (length, dwarf64, dwarf version, byte order) from DWARF data, reading the list of compilation units and their version information, reading a DWARF string from a buffer, reading Uint16, Uint32, Uint64 from a buffer in the specified byte order, encoding a Uint32, Uint64 in the specified byte order and writing it to a buffer.</td>
</tr>
</tbody>
</table>
<p>Handwriting a complete DWARF parsing library requires proficiency in the DWARF debugging information standard and understanding the various adjustments made by the Go compiler toolchain in the evolution from DWARF v4 to DWARF v5. The workload is quite large. To avoid making the learning process too tedious, we will not handwrite a new DWARF support library, but instead reuse the implementation in go-delve/delve.</p>
<p>OK, let&apos;s take a look at how these packages are organized internally.</p>
<h4 id="dwarfbuilder">dwarfbuilder</h4>
<p>The dwarfbuilder package is mainly used to generate DWARF debugging information. When do we need to generate DWARF debugging information? We want to allow a running Go program to generate a core file. We usually get a core file when a Go program crashes (set the environment variable GOTRACEBACK=crash at startup), but it is also possible to dynamically generate a core file during program execution.</p>
<p>The core file is also in ELF format under Linux, and we need to write some DWARF information for debugging. dwarfbuilder is used to generate this DWARF data (mainly the data in .[z]debug_info).</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/dwarfbuilder.png" alt="pkg dwarfbuilder"></p>
<h4 id="frame">frame</h4>
<p>The data in .[z]debug_frame can be used to build the call stack information table, which can be used during program execution to build the call stack and allow us to select stack frames forward and backward and view variable information in the stack frame. Of course, you can also use bt to print the current call stack information.</p>
<p>The information in .[z]debug_frame mainly consists of a series of CIEs (one per compilation unit) and a series of FDEs (many FDEs in each compilation unit). After parsing this data, you get a FrameDescriptionEntries, which encapsulates several commonly used methods, such as FDEForPC, which returns the corresponding stack frame when a specific instruction address is specified.</p>
<p>When a PC value is specified, executing its EstablishFrame will execute the instructions in the call stack information table, and after completion, a FrameContext is built, which records the CFA, Regs, and RetAddrReg at that time. With this data, you can calculate the return address of the current function and further calculate the stack frame of the calling function... Repeating this process allows you to calculate the call stack.</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/frame.png" alt="pkg frame"></p>
<h4 id="line">line</h4>
<p>.[z]debug_line records the mapping between instruction addresses and source file line numbers. The data in this table helps us complete the conversion between source code addresses and instruction addresses.</p>
<p>The design of this package is roughly as follows: <code>line.Parse(*DebugLineInfo, *bytes.Buffer)</code>, where the data in .[z]debug_info is the second parameter. After parsing, the data in *DebugLineInfo will be filled in.</p>
<p>During parsing, a formReader is used to read and parse data from *bytes.Buffer, and a StateMachine is used to execute the bytecode instructions in the table to rebuild the table.</p>
<p>Finally, we can use the exported methods in DebugLineInfo to perform some common operations, such as PCToLine to convert a PC address to a source file address, and LineToPC to convert a source file address to an instruction address PC.</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/line.png" alt="pkg line"></p>
<h4 id="loclist">loclist</h4>
<p>.[z]debug_loc and .[z]debug_loclist store some address-related information. The former is defined in DWARF standard v2, and the latter is defined in DWARF standard v5. The latter is more space-saving and efficient than the former.</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/loclist.png" alt="pkg loclist"></p>
<p>This part of the data describes the address of an object. When describing the address of an object, if its address may change during its entire lifetime, it needs to be described by loclists. When does this happen?</p>
<p>The change of location here does not mean that the object will migrate (like GC), but that as the program executes instruction by instruction, the PC value is constantly changing. In order to quickly calculate the object&apos;s address, a new loc entry may be generated in loclists. By looking up the corresponding entry, the address can be quickly calculated.</p>
<p>For example, consider the following program:</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay</span><span class="hljs-params">(<span class="hljs-keyword">int</span> num)</span>
</span>{
   <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> i;
   <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;num; i++);
}
</code></pre>
<p>Compiling with <code>gcc -g -O1 -o delay.o delay.c</code> generates a delay.o file. Disassembly:</p>
<pre><code class="lang-asm">00000000 &lt;delay&gt;:
   0:   e24dd008    sub sp, sp, #8
   4:   e3a03000    mov r3, #0
   8:   e58d3004    str r3, [sp, #4]
   c:   e59d3004    ldr r3, [sp, #4]
  10:   e1500003    cmp r0, r3
  14:   da000005    ble 30 &lt;delay+0x30&gt;
  18:   e59d3004    ldr r3, [sp, #4]
  1c:   e2833001    add r3, r3, #1
  20:   e58d3004    str r3, [sp, #4]
  24:   e59d3004    ldr r3, [sp, #4]
  28:   e1530000    cmp r3, r0
  2c:   bafffff9    blt 18 &lt;delay+0x18&gt;
  30:   e28dd008    add sp, sp, #8
  34:   e12fff1e    bx  lr
</code></pre>
<p>We can see the instruction address range. Now let&apos;s look at the corresponding DWARF data:</p>
<pre><code class="lang-bash">&lt;1&gt;&lt;25&gt;: Abbrev Number: 2 (DW_TAG_subprogram)
   &lt;26&gt;   DW_AT_external    : 1
   &lt;27&gt;   DW_AT_name        : (indirect string, offset: 0x19): delay
   &lt;2b&gt;   DW_AT_decl_file   : 1
   &lt;2c&gt;   DW_AT_decl_line   : 1
   &lt;2d&gt;   DW_AT_prototyped  : 1
   &lt;2e&gt;   DW_AT_low_pc      : 0x0
   &lt;32&gt;   DW_AT_high_pc     : 0x38
   &lt;36&gt;   DW_AT_frame_base  : 0x0      (location list)
   &lt;3a&gt;   DW_AT_sibling     : &lt;0x59&gt;
...
&lt;2&gt;&lt;4b&gt;: Abbrev Number: 4 (DW_TAG_variable)
   &lt;4c&gt;   DW_AT_name        : i
   &lt;4e&gt;   DW_AT_decl_file   : 1
   &lt;4f&gt;   DW_AT_decl_line   : 3
   &lt;50&gt;   DW_AT_<span class="hljs-built_in">type</span>        : &lt;0x60&gt;
   &lt;54&gt;   DW_AT_location    : 0x20     (location list)
</code></pre>
<p>We see the definition of variable i. From its DW_AT_location attribute, we see that its location is described in the location list, so let&apos;s also output its .debug_loc:</p>
<pre><code class="lang-bash">Offset   Begin    End      Expression
00000000 00000000 00000004 (DW_OP_breg13 (r13): 0)
00000000 00000004 00000038 (DW_OP_breg13 (r13): 8)
00000000 &lt;End of list&gt;
00000020 0000000c 00000020 (DW_OP_fbreg: -12)
00000020 00000024 00000028 (DW_OP_reg3 (r3))
00000020 00000028 00000038 (DW_OP_fbreg: -12)
00000020 &lt;End of list&gt;
</code></pre>
<p>We can see that when the instruction address is from 4 to 38, the calculation expression for its location is r13+8; when the address is c to 20, the address is fbreg-12; when the address is 24 to 28, the address is r3; when the address is 28 to 38, the address is fbreg-12. It can be seen that the change of location here means that as the instruction address PC value changes, the calculation expression for its location changes. The reason for the change is that during the execution of instructions, some registers are used and can no longer be calculated using the previous expression, so a new loclists entry is generated in .debug_loc or .debug_loclists.</p>
<blockquote>
<p>This demo is taken from a Stack Overflow Q&amp;A: <a href="https://stackoverflow.com/q/47359841" target="_blank">https://stackoverflow.com/q/47359841</a>.</p>
</blockquote>
<h4 id="godwarf">godwarf</h4>
<p>In .[z]debug_info, a DIE Tree is used to describe the defined types, variables, functions, compilation units, etc. DIEs use Tag and Attr to describe specific objects, and these DIEs can form a Tree.</p>
<p>the godwarf package provides exported functions to simplify the loading and parsing logic of the DIE Tree.</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/godwarf.png" alt="pkg godwarf"></p>
<h4 id="op">op</h4>
<p>the most important exported function in the op package is <code>op.ExecuteStackProgram(...)</code>, which executes a DWARF location expression and returns the calculated address value (int64 type), or returns a []Piece, each Piece describing a location, which may be in memory (address is Piece.Val), in a register (number in Piece.Val), or an immediate value (Piece.Val or Piece.Bytes).</p>
<p>op.DwarfRegisters and op.DwarfRegister are two important types that define the registers needed by the stack program. The related functions and methods are relatively simple.</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/op.png" alt="op"></p>
<h4 id="reader">reader</h4>
<p>Here, a more convenient reader for reading and parsing .debug_info in DWARF is defined, based on the Go standard library&apos;s dwarf.Reader. This reader can easily seek, read variables, types, functions, compilation units, and other program elements.</p>
<p><img src="assets/4-&#x540E;&#x7AEF;&#x7B26;&#x53F7;&#x5C42;&#x8BBE;&#x8BA1;/reader.png" alt="reader"></p>
<h4 id="regnum">regnum</h4>
<p>Defines some register numbers and their corresponding register names,</p>
<pre><code class="lang-go"><span class="hljs-comment">// List of registers under amd64 architecture</span>
<span class="hljs-keyword">const</span> (
    AMD64_Rax     = <span class="hljs-number">0</span>
    AMD64_Rdx     = <span class="hljs-number">1</span>
    AMD64_Rcx     = <span class="hljs-number">2</span>
    AMD64_Rbx     = <span class="hljs-number">3</span>
    AMD64_Rsi     = <span class="hljs-number">4</span>
    AMD64_Rdi     = <span class="hljs-number">5</span>
    ...
)

<span class="hljs-comment">// Mapping from register number to register name</span>
<span class="hljs-keyword">var</span> amd64DwarfToName = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">uint64</span>]<span class="hljs-keyword">string</span>{
    AMD64_Rax:        <span class="hljs-string">&quot;Rax&quot;</span>,
    AMD64_Rdx:        <span class="hljs-string">&quot;Rdx&quot;</span>,
    AMD64_Rcx:        <span class="hljs-string">&quot;Rcx&quot;</span>,
    AMD64_Rbx:        <span class="hljs-string">&quot;Rbx&quot;</span>,
    ...
}

<span class="hljs-keyword">var</span> AMD64NameToDwarf = <span class="hljs-keyword">func</span>() <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span> {
    r := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">for</span> regNum, regName := <span class="hljs-keyword">range</span> amd64DwarfToName {
        r[strings.ToLower(regName)] = <span class="hljs-keyword">int</span>(regNum)
    }
    r[<span class="hljs-string">&quot;eflags&quot;</span>] = <span class="hljs-number">49</span>
    r[<span class="hljs-string">&quot;st0&quot;</span>] = <span class="hljs-number">33</span>
    r[<span class="hljs-string">&quot;st1&quot;</span>] = <span class="hljs-number">34</span>
    r[<span class="hljs-string">&quot;st2&quot;</span>] = <span class="hljs-number">35</span>
    r[<span class="hljs-string">&quot;st3&quot;</span>] = <span class="hljs-number">36</span>
    r[<span class="hljs-string">&quot;st4&quot;</span>] = <span class="hljs-number">37</span>
    r[<span class="hljs-string">&quot;st5&quot;</span>] = <span class="hljs-number">38</span>
    r[<span class="hljs-string">&quot;st6&quot;</span>] = <span class="hljs-number">39</span>
    r[<span class="hljs-string">&quot;st7&quot;</span>] = <span class="hljs-number">40</span>
    <span class="hljs-keyword">return</span> r
}()

<span class="hljs-comment">// Return the maximum register number</span>
<span class="hljs-keyword">func</span> AMD64MaxRegNum() <span class="hljs-keyword">uint64</span> { ... }

<span class="hljs-comment">// Return the register name corresponding to the register number</span>
<span class="hljs-keyword">func</span> AMD64ToName(num <span class="hljs-keyword">uint64</span>) <span class="hljs-keyword">string</span> { ... }
</code></pre>
<h4 id="leb128">leb128</h4>
<p>Defines some commonly used utility functions for reading and writing leb128:</p>
<pre><code class="lang-go"><span class="hljs-comment">// Reader is a io.ByteReader with a Len method. This interface is</span>
<span class="hljs-comment">// satisfied by both bytes.Buffer and bytes.Reader.</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> {
    io.ByteReader
    io.Reader
    Len() <span class="hljs-keyword">int</span>
}

<span class="hljs-comment">// DecodeUnsigned decodes an unsigned Little Endian Base 128</span>
<span class="hljs-comment">// represented number.</span>
<span class="hljs-keyword">func</span> DecodeUnsigned(buf Reader) (<span class="hljs-keyword">uint64</span>, <span class="hljs-keyword">uint32</span>) {...}

<span class="hljs-comment">// DecodeSigned decodes a signed Little Endian Base 128</span>
<span class="hljs-comment">// represented number.</span>
<span class="hljs-keyword">func</span> DecodeSigned(buf Reader) (<span class="hljs-keyword">int64</span>, <span class="hljs-keyword">uint32</span>) { ... }

<span class="hljs-comment">// EncodeUnsigned encodes x to the unsigned Little Endian Base 128 format.</span>
<span class="hljs-keyword">func</span> EncodeUnsigned(out io.ByteWriter, x <span class="hljs-keyword">uint64</span>) { ... }

<span class="hljs-comment">// EncodeSigned encodes x to the signed Little Endian Base 128 format.</span>
<span class="hljs-keyword">func</span> EncodeSigned(out io.ByteWriter, x <span class="hljs-keyword">int64</span>) { ... }
</code></pre>
<h4 id="dwarf">dwarf</h4>
<p>Defines some commonly used utility functions for reading and writing strings, uints, etc.:</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> (
    _DW_UT_compile = <span class="hljs-number">0x1</span> + <span class="hljs-literal">iota</span>
    _DW_UT_type
    _DW_UT_partial
    _DW_UT_skeleton
    _DW_UT_split_compile
    _DW_UT_split_type
)

<span class="hljs-comment">// ReadString reads a null-terminated string from data.</span>
<span class="hljs-keyword">func</span> ReadString(data *bytes.Buffer) (<span class="hljs-keyword">string</span>, error) { ... }

<span class="hljs-comment">// ReadUintRaw reads an integer of ptrSize bytes, with the specified byte order, from reader.</span>
<span class="hljs-keyword">func</span> ReadUintRaw(reader io.Reader, order binary.ByteOrder, ptrSize <span class="hljs-keyword">int</span>) (<span class="hljs-keyword">uint64</span>, error) { ... }

<span class="hljs-comment">// WriteUint writes an integer of ptrSize bytes to writer, in the specified byte order.</span>
<span class="hljs-keyword">func</span> WriteUint(writer io.Writer, order binary.ByteOrder, ptrSize <span class="hljs-keyword">int</span>, data <span class="hljs-keyword">uint64</span>) error { ... }

<span class="hljs-comment">// ReadDwarfLengthVersion reads a DWARF length field followed by a version field</span>
<span class="hljs-keyword">func</span> ReadDwarfLengthVersion(data []<span class="hljs-keyword">byte</span>) (length <span class="hljs-keyword">uint64</span>, dwarf64 <span class="hljs-keyword">bool</span>, version <span class="hljs-keyword">uint8</span>, byteOrder binary.ByteOrder) { ... }

<span class="hljs-comment">// ReadUnitVersions reads the DWARF version of each unit in a debug_info section and returns them as a map.</span>
<span class="hljs-keyword">func</span> ReadUnitVersions(data []<span class="hljs-keyword">byte</span>) <span class="hljs-keyword">map</span>[dwarf.Offset]<span class="hljs-keyword">uint8</span> { ... }
</code></pre>
<h3 id="section-summary">Section Summary</h3>
<p>This section introduced the debug sections of symbol layer debugging information and their relationships, as well as the design of some Go packages used for reading and writing these DWARF data. We did not design this from scratch, nor do we need to implement it from scratch in the future. We just need to read, understand, and reuse the implementation that has been accumulated in go-delve/delve over the years.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="3-Service层设计.html" class="navigation navigation-prev " aria-label="Previous page: 9.1.3 Service Layer Design">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="5-后端目标层设计.html" class="navigation navigation-next " aria-label="Next page: 9.1.5 Backend Target Layer Design">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"9.1.4 Backend Symbol Layer Design","level":"1.9.1.4","depth":3,"next":{"title":"9.1.5 Backend Target Layer Design","level":"1.9.1.5","depth":3,"path":"9-develop-sym-debugger/1-架构设计/5-后端目标层设计.md","ref":"9-develop-sym-debugger/1-架构设计/5-后端目标层设计.md","articles":[]},"previous":{"title":"9.1.3 Service Layer Design","level":"1.9.1.3","depth":3,"path":"9-develop-sym-debugger/1-架构设计/3-Service层设计.md","ref":"9-develop-sym-debugger/1-架构设计/3-Service层设计.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc","github"],"pluginsConfig":{"github":{"url":"https://github.com/hitzhangjie/golang-debugger-book-en"},"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"9-develop-sym-debugger/1-架构设计/4-后端符号层设计.md","mtime":"2025-06-17T03:44:29.886Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-17T03:53:23.064Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


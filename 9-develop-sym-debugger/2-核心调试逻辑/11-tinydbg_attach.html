
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>9.2.11 tinydbg attach · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="12-tinydbg_attach_waitfor.html" />
    
    
    <link rel="prev" href="01-debug-session.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../2-preface/">
            
                <a href="../../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../3-terms/">
            
                <a href="../../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../4-basics/">
            
                <a href="../../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../4-basics/1-purposes.html">
            
                <a href="../../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../4-basics/2-dependencies.html">
            
                <a href="../../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../4-basics/3-countertactics.html">
            
                <a href="../../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../5-debugger-skeleton/">
            
                <a href="../../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../6-develop-inst-debugger/">
            
                <a href="../../6-develop-inst-debugger/">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../6-develop-inst-debugger/1-process_start.html">
            
                <a href="../../6-develop-inst-debugger/1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../6-develop-inst-debugger/2-process_attach.html">
            
                <a href="../../6-develop-inst-debugger/2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                <a href="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../6-develop-inst-debugger/4-debug-session.html">
            
                <a href="../../6-develop-inst-debugger/4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../6-develop-inst-debugger/5-disassemble.html">
            
                <a href="../../6-develop-inst-debugger/5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../6-develop-inst-debugger/6-breakpoint.html">
            
                <a href="../../6-develop-inst-debugger/6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../6-develop-inst-debugger/7-breakpoints.html">
            
                <a href="../../6-develop-inst-debugger/7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../6-develop-inst-debugger/8-clear.html">
            
                <a href="../../6-develop-inst-debugger/8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../6-develop-inst-debugger/9-clearall.html">
            
                <a href="../../6-develop-inst-debugger/9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../6-develop-inst-debugger/10-step.html">
            
                <a href="../../6-develop-inst-debugger/10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../6-develop-inst-debugger/11-continue.html">
            
                <a href="../../6-develop-inst-debugger/11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../6-develop-inst-debugger/12-pmem.html">
            
                <a href="../../6-develop-inst-debugger/12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../6-develop-inst-debugger/13-pregs.html">
            
                <a href="../../6-develop-inst-debugger/13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../6-develop-inst-debugger/14-set-mem.html">
            
                <a href="../../6-develop-inst-debugger/14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../../6-develop-inst-debugger/15-set-regs.html">
            
                <a href="../../6-develop-inst-debugger/15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                <a href="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                <a href="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../../6-develop-inst-debugger/80-aslr.html">
            
                <a href="../../6-develop-inst-debugger/80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../../6-develop-inst-debugger/99-more.html">
            
                <a href="../../6-develop-inst-debugger/99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../7-headto-sym-debugger/">
            
                <a href="../../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../7-headto-sym-debugger/2-elf.html">
            
                <a href="../../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../7-headto-sym-debugger/3-syms.html">
            
                <a href="../../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../7-headto-sym-debugger/5-loading.html">
            
                <a href="../../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../8-dwarf/">
            
                <a href="../../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../8-dwarf/1-history.html">
            
                <a href="../../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../8-dwarf/2-overview.html">
            
                <a href="../../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../8-dwarf/3-dwarfdata.html">
            
                <a href="../../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../8-dwarf/4-die/">
            
                <a href="../../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../../8-dwarf/4-die/4-encoding.html">
            
                <a href="../../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../8-dwarf/5-other/">
            
                <a href="../../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../8-dwarf/6-practices.html">
            
                <a href="../../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../../8-dwarf/7-summary.html">
            
                <a href="../../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../">
            
                <a href="../">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../1-架构设计/">
            
                <a href="../1-架构设计/">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../1-架构设计/1-现代调试器架构.html">
            
                <a href="../1-架构设计/1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../1-架构设计/2-前端UI层设计.html">
            
                <a href="../1-架构设计/2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../1-架构设计/3-Service层设计.html">
            
                <a href="../1-架构设计/3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../1-架构设计/4-后端符号层设计.html">
            
                <a href="../1-架构设计/4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="../1-架构设计/5-后端目标层设计.html">
            
                <a href="../1-架构设计/5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="../1-架构设计/6-日志系统设计.html">
            
                <a href="../1-架构设计/6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="./">
            
                <a href="./">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="00-cmds.html">
            
                <a href="00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="01-debug-session.html">
            
                <a href="01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.2.3" data-path="11-tinydbg_attach.html">
            
                <a href="11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="12-tinydbg_attach_waitfor.html">
            
                <a href="12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="13-tinydbg_exec.html">
            
                <a href="13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="14-tinydbg_debug.html">
            
                <a href="14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="15-tinydbg_core1.html">
            
                <a href="15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="15-tinydbg_core2.html">
            
                <a href="15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="16-tinydbg_connect.html">
            
                <a href="16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="17-tinydbg_trace.html">
            
                <a href="17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="21-disassemble.html">
            
                <a href="21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="22-breakpoint.html">
            
                <a href="22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="23-breakpoints.html">
            
                <a href="23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="24-clear.html">
            
                <a href="24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="25-clearall.html">
            
                <a href="25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="26-step.html">
            
                <a href="26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="27-continue.html">
            
                <a href="27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="28-pmem.html">
            
                <a href="28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="29-regs.html">
            
                <a href="29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="30-call-frame.html">
            
                <a href="30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="31-vars.html">
            
                <a href="31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="32-how_listfunctions_work.html">
            
                <a href="32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="32-funcs.html">
            
                <a href="32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="33-goroutines.html">
            
                <a href="33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="34-multi-threads.html">
            
                <a href="34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../3-高级功能扩展/">
            
                <a href="../3-高级功能扩展/">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../3-高级功能扩展/100-howto_integrate_starlark.html">
            
                <a href="../3-高级功能扩展/100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                <a href="../3-高级功能扩展/101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../3-高级功能扩展/102-howto_syntax_highlight.html">
            
                <a href="../3-高级功能扩展/102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../3-高级功能扩展/103-howto_paging_output.html">
            
                <a href="../3-高级功能扩展/103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                <a href="../3-高级功能扩展/104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="../3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                <a href="../3-高级功能扩展/105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="../3-高级功能扩展/106-howto_redirect_target_io.html">
            
                <a href="../3-高级功能扩展/106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="../3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                <a href="../3-高级功能扩展/107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="../3-高级功能扩展/108-howto_accept_multiclient.html">
            
                <a href="../3-高级功能扩展/108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="../3-高级功能扩展/109-howto_transcript_debugging.html">
            
                <a href="../3-高级功能扩展/109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../10-extras/">
            
                <a href="../../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../10-extras/1-development-of-debugger.html">
            
                <a href="../../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../../10-extras/2-development-of-logging.html">
            
                <a href="../../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../../10-extras/3-development-of-metrics.html">
            
                <a href="../../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../../10-extras/4-development-of-tracing.html">
            
                <a href="../../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../../10-extras/5-development-of-bisect.html">
            
                <a href="../../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../../10-extras/6-development-of-ebpf.html">
            
                <a href="../../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../../10-extras/7-development-of-replay.html">
            
                <a href="../../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../11-thanks/">
            
                <a href="../../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../12-appendix/">
            
                <a href="../../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../../12-appendix/1-go-programme-start.html">
            
                <a href="../../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../../12-appendix/3-git-bisect.html">
            
                <a href="../../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../../12-appendix/80-go-tool-compile.html">
            
                <a href="../../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../../12-appendix/81-go-tool-asm.html">
            
                <a href="../../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../../12-appendix/82-go-tool-link.html">
            
                <a href="../../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >9.2.11 tinydbg attach</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="attach">Attach</h2>
<h3 id="implementation-goal-tinydbg-attach-pid">Implementation Goal: <code>tinydbg attach &lt;pid&gt;</code></h3>
<p>This section introduces the attach command for starting debugging: <code>tinydbg attach &lt;pid&gt; [executable] [flags]</code>. The attach operation will attach to the target process and make it stop.</p>
<p>Compared to the instruction-level debugger godbg attach, the symbol-level debugger tinydbg attach adds more options to support more user-friendly debugging.</p>
<pre><code class="lang-bash">$ tinydbg <span class="hljs-built_in">help</span> attach
Attach to an already running process and begin debugging it.

This <span class="hljs-built_in">command</span> will cause Delve to take control of an already running process, and
begin a new debug session.  When exiting the debug session you will have the
option to <span class="hljs-built_in">let</span> the process <span class="hljs-built_in">continue</span> or <span class="hljs-built_in">kill</span> it.

Usage:
  tinydbg attach pid [executable] [flags]

Flags:
      --continue                 Continue the debugged process on start.
  -h, --help                     <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> attach
      --waitfor string           Wait <span class="hljs-keyword">for</span> a process with a name beginning with this prefix
      --waitfor-duration <span class="hljs-built_in">float</span>   Total time to <span class="hljs-built_in">wait</span> <span class="hljs-keyword">for</span> a process
      --waitfor-interval <span class="hljs-built_in">float</span>   Interval between checks of the process list, <span class="hljs-keyword">in</span> millisecond (default 1)

Global Flags:
      --accept-multiclient               Allows a headless server to accept multiple client connections via JSON-RPC.
      --allow-non-terminal-interactive   Allows interactive sessions of Delve that don<span class="hljs-string">&apos;t have a terminal as stdin, stdout and stderr
      --headless                         Run debug server only, in headless mode. Server will accept JSON-RPC client connections.
      --init string                      Init file, executed by the terminal client.
  -l, --listen string                    Debugging server listen address. Prefix with &apos;</span>unix:<span class="hljs-string">&apos; to use a unix domain socket. (default &quot;127.0.0.1:0&quot;)
      --log                              Enable debugging server logging.
      --log-dest string                  Writes logs to the specified file or file descriptor (see &apos;</span>dlv <span class="hljs-built_in">help</span> <span class="hljs-built_in">log</span><span class="hljs-string">&apos;).
      --log-output string                Comma separated list of components that should produce debug output (see &apos;</span>dlv <span class="hljs-built_in">help</span> <span class="hljs-built_in">log</span><span class="hljs-string">&apos;)
</span></code></pre>
<p>Let&apos;s explain the attach command options above:</p>
<ol>
<li>tinydbg attach pid - This is straightforward, attaching to a running process with id==pid;</li>
<li>--waitfor, --waitfor-duration, --waitfor-interval - Wait for a process with name prefix xxx to start and then attach, see <a href="1-tinydbg_attach_waitfor.md">waitfor design</a>.</li>
<li>--accept-multiclient - This allows the same debugger backend to serve multiple debugger clients, enabling simultaneous or sequential debugging, see <a href="../3-&#x9AD8;&#x7EA7;&#x529F;&#x80FD;&#x6269;&#x5C55;/108-howto_accept_multiclient.html">multiclient design</a>.</li>
<li>--allow-non-terminal-interactive - If you want to perform non-terminal-based debugging in CI/CD or automated debugging workflows;</li>
<li>--headless - Start a debugger backend and run it in server mode;</li>
<li>--listen - Start a debugger backend in server mode and specify the server&apos;s listening address;</li>
<li>--log, --log-output, --log-dest - Whether to enable server logging, which levels of logging to enable, and where to output logs, see <a href="../1-&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/6-&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;">logging system design</a>.</li>
</ol>
<p>OK, let&apos;s look at the detailed design and implementation of Attach.</p>
<h3 id="basic-knowledge">Basic Knowledge</h3>
<p>In Chapter 6 on instruction-level debugger development, we combined Linux kernel source code to very&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4ECB;&#x7ECD;&#x4E86;syscall.PtraceAttach(...)&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;. If you&apos;ve forgotten these details, you can go back and review the relevant content. Here we&apos;ll summarize the key processing logic through a sequence diagram.</p>
<p>FIXME: This diagram has issues, refer to Chapter 6&apos;s start+attach &quot;put it together&quot; section for summary.</p>
<p align="center">
<img alt="tinydbg attach" src="assets/how_attach_works.png">
</p>

<p>General processing flow:</p>
<ul>
<li>User inputs <code>attach &lt;pid&gt;</code> command in the frontend.</li>
<li>Frontend sends attach request to backend via json-rpc (remote) or net.Pipe (local).</li>
<li>Backend parses request and calls system API (like ptrace or equivalent mechanism) to attach to target process.</li>
<li>Backend initializes debugging context (like symbol table, breakpoints, thread information, etc.).</li>
<li>Returns attach result, frontend enters debugging session.</li>
</ul>
<h3 id="code-implementation">Code Implementation</h3>
<p>As the first debugging command implementation we&apos;re introducing, we need to explain the complete interaction flow between the debugger frontend and backend in detail here. For subsequent debugging commands, we won&apos;t repeat this detailed explanation. So please be patient, readers.</p>
<h4 id="executing-tinydbg-attach-pid-in-shell">Executing <code>tinydbg attach &lt;pid&gt;</code> in Shell</h4>
<p>First, when the user executes the command <code>tinydbg attach &lt;pid&gt;</code>, the tinydbg main program is a command-line program based on spf13/cobra:</p>
<p>file: path-to/tinydbg/main.go</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  ...

    <span class="hljs-string">&quot;github.com/hitzhangjie/tinydbg/cmds&quot;</span>
    <span class="hljs-string">&quot;github.com/hitzhangjie/tinydbg/pkg/logflags&quot;</span>
    <span class="hljs-string">&quot;github.com/hitzhangjie/tinydbg/pkg/version&quot;</span>
)

<span class="hljs-comment">// Build is the git sha of this binaries build.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// note: we can pass -ldflags &quot;-X main.Build=v0.0.1&quot; to set the build version when building.</span>
<span class="hljs-keyword">var</span> Build <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;v0.0.1&quot;</span>

<span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// current demo only supports linux/amd64</span>
    <span class="hljs-keyword">if</span> runtime.GOOS != <span class="hljs-string">&quot;linux&quot;</span> || runtime.GOARCH != <span class="hljs-string">&quot;amd64&quot;</span> {
        fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;WARNING: tinydbg only supports linux/amd64&quot;</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-comment">// this build version will be dumped when generating the core file</span>
    <span class="hljs-keyword">if</span> Build != <span class="hljs-string">&quot;&quot;</span> {
        version.DelveVersion.Build = Build
    }

    <span class="hljs-comment">// if cgo used, pass &quot;-O0 -g&quot; to disable optimization and enable debugging symbols</span>
    <span class="hljs-keyword">const</span> cgoCflagsEnv = <span class="hljs-string">&quot;CGO_CFLAGS&quot;</span>
    <span class="hljs-keyword">if</span> os.Getenv(cgoCflagsEnv) == <span class="hljs-string">&quot;&quot;</span> {
        os.Setenv(cgoCflagsEnv, <span class="hljs-string">&quot;-O0 -g&quot;</span>)
    } <span class="hljs-keyword">else</span> {
        logflags.WriteCgoFlagsWarning()
    }

    cmds.New().Execute()
}
</code></pre>
<p>Since it&apos;s a command-line program managed by spf13/cobra, its subcommand registration logic is similar, it should have a corresponding attach subcmd.</p>
<p>see: path-to/tinydbg/cmds/cmd_root.go</p>
<pre><code class="lang-go"><span class="hljs-comment">// New returns an initialized command tree.</span>
<span class="hljs-keyword">func</span> New() *cobra.Command {
    <span class="hljs-comment">// Config setup and load.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Delay reporting errors about configuration loading delayed until after the</span>
    <span class="hljs-comment">// server is started so that the &quot;server listening at&quot; message is always</span>
    <span class="hljs-comment">// the first thing emitted. Also, logflags hasn&apos;t been set up yet at this point.</span>
    conf, loadConfErr = config.LoadConfig()
    buildFlagsDefault := <span class="hljs-string">&quot;&quot;</span>

    <span class="hljs-comment">// Main dlv root command.</span>
    rootCommand = &amp;cobra.Command{
        Use:   <span class="hljs-string">&quot;tinydbg&quot;</span>,
        Short: <span class="hljs-string">&quot;tinydbg is a lightweight debugger trimmed from Delve (Dlv) for the Go programming language.&quot;</span>,
        Long:  longDesc,
    }
  ...
  rootCommand.AddCommand(attachCommand)
    rootCommand.AddCommand(connectCommand)
  ...
}
</code></pre>
<p>We can see the registration of attachCommand here. When executing <code>tinydbg attach</code>, it actually executes the attachCommand.Run method.</p>
<p>see: path-to/tinydbg/cmds/cmd_attach.go</p>
<pre><code class="lang-go"><span class="hljs-comment">// &apos;attach&apos; subcommand.</span>
<span class="hljs-keyword">var</span> attachCommand = &amp;cobra.Command{
    Use:   <span class="hljs-string">&quot;attach pid [executable]&quot;</span>,
    Short: <span class="hljs-string">&quot;Attach to running process and begin debugging.&quot;</span>,
    Long: <span class="hljs-string">`Attach to an already running process and begin debugging it.

This command will cause Delve to take control of an already running process, and
begin a new debug session.  When exiting the debug session you will have the
option to let the process continue or kill it.
`</span>,
    PersistentPreRunE: <span class="hljs-keyword">func</span>(cmd *cobra.Command, args []<span class="hljs-keyword">string</span>) error {
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) == <span class="hljs-number">0</span> &amp;&amp; attachWaitFor == <span class="hljs-string">&quot;&quot;</span> {
            <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;you must provide a PID&quot;</span>)
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    },
    Run: attachCmd,
    ValidArgsFunction: <span class="hljs-keyword">func</span>(cmd *cobra.Command, args []<span class="hljs-keyword">string</span>, toComplete <span class="hljs-keyword">string</span>) ([]<span class="hljs-keyword">string</span>, cobra.ShellCompDirective) {
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) != <span class="hljs-number">1</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, cobra.ShellCompDirectiveNoFileComp
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, cobra.ShellCompDirectiveDefault
    },
}

...

<span class="hljs-keyword">func</span> attachCmd(_ *cobra.Command, args []<span class="hljs-keyword">string</span>) {
    <span class="hljs-keyword">var</span> pid <span class="hljs-keyword">int</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) &gt; <span class="hljs-number">0</span> {
        <span class="hljs-keyword">var</span> err error
        pid, err = strconv.Atoi(args[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;Invalid pid: %s\n&quot;</span>, args[<span class="hljs-number">0</span>])
            os.Exit(<span class="hljs-number">1</span>)
        }
        args = args[<span class="hljs-number">1</span>:]
    }
    os.Exit(execute(pid, args, conf, <span class="hljs-string">&quot;&quot;</span>, debugger.ExecutingOther, args, buildFlags))
}
</code></pre>
<p>Here <code>attachCommand.Run()</code> -&gt; <code>attachCmd(...)</code> -&gt; <code>execute(pid, args, conf, ....)</code>, the RPC client for frontend-backend communication is initialized in execute and completes the call to the server.</p>
<p>ps: In section 9.1 Service Layer Design, we mentioned that for local debugging, we actually simulate real network connection communication through preConnectedListener+net.Pipe. Essentially, it still follows the C/S architecture for requests and processing.</p>
<h4 id="frontend-and-backend-responsibilities-in-attach-operation">Frontend and Backend Responsibilities in Attach Operation</h4>
<p>When executing to the execute method, the different responsibilities of frontend and backend in the separated architecture begin to show. For local debugging mode, the execute method includes both frontend JSON-RPC client initialization and debugging session logic, as well as backend network IO and debugger core functionality initialization. In remote debugging mode, the execute method mainly handles backend network IO and debugger core functionality initialization, while frontend initialization needs to be done through the connect operation to initialize the JSON-RPC client and debugging session.</p>
<p>We&apos;ve already introduced the initialization and working process of the debugging session in the previous section. In this section, we only need to focus on the debugger backend&apos;s core functionality initialization involved in the attach operation, based on the already introduced debugging session.</p>
<p>Actually, if it&apos;s remote debugging mode, the attach operation is mainly a backend operation, with little frontend involvement. The attach operation doesn&apos;t need the frontend to send a JSON-RPC request - it just needs the backend to do network IO initialization and debugger initialization, then let the debugger attach to the target process and that&apos;s it. If it&apos;s local debugging mode, after the debugger backend completes the above initialization, the debugger frontend establishes a debugging session and it&apos;s ready to go, with subsequent communication with the backend through net.Pipe.</p>
<p>see: path-to/tinydbg/cmds/cmd_root.go</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> execute(attachPid <span class="hljs-keyword">int</span>, processArgs []<span class="hljs-keyword">string</span>, conf *config.Config, coreFile <span class="hljs-keyword">string</span>, kind debugger.ExecuteKind, dlvArgs []<span class="hljs-keyword">string</span>, buildFlags <span class="hljs-keyword">string</span>) <span class="hljs-keyword">int</span> {
      ...

    <span class="hljs-keyword">var</span> listener net.Listener
    <span class="hljs-keyword">var</span> clientConn net.Conn
    <span class="hljs-keyword">if</span> headless {
        listener, err = netListen(addr)               <span class="hljs-comment">// remote debug mode via TCP network</span>
    } <span class="hljs-keyword">else</span> {
        listener, clientConn = service.ListenerPipe() <span class="hljs-comment">// local debug mode via net.Pipe</span>
    }

    ...

    <span class="hljs-comment">// debugger backend: create and start a debugger server</span>
    server := rpccommon.NewServer(&amp;service.Config{
        Listener:       listener,
        ProcessArgs:    processArgs,
        AcceptMulti:    acceptMulti,
        DisconnectChan: disconnectChan,
        Debugger: debugger.Config{
            AttachPid:             attachPid,
            &#x3002;&#x3002;&#x3002;
        },
    })

    <span class="hljs-keyword">if</span> err := server.Run(); err != <span class="hljs-literal">nil</span> {
        &#x3002;&#x3002;&#x3002;
    }
      ...

    <span class="hljs-comment">// debugger frontend: connect to debugger server and init debug session</span>
    <span class="hljs-keyword">return</span> connect(listener.Addr().String(), clientConn, conf)
}
</code></pre>
<h4 id="debugger-backend-initialization-and-request-acceptance">Debugger Backend Initialization and Request Acceptance</h4>
<p>The debugger backend starts, with two ways of network initialization:</p>
<ol>
<li>One is through --headless mode startup, net.Listen creates a TCPListener or UnixListener, then waits for incoming connection requests;</li>
<li>One is local mode startup, through preConnectedListener+net.Pipe, to simulate network listening and connection operations;</li>
</ol>
<p>see: path-to/tinydbg/cmds/cmd_root.go</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> execute(attachPid <span class="hljs-keyword">int</span>, processArgs []<span class="hljs-keyword">string</span>, conf *config.Config, coreFile <span class="hljs-keyword">string</span>, kind debugger.ExecuteKind, dlvArgs []<span class="hljs-keyword">string</span>, buildFlags <span class="hljs-keyword">string</span>) <span class="hljs-keyword">int</span> {
      ...
    <span class="hljs-keyword">var</span> listener net.Listener
    <span class="hljs-keyword">if</span> headless {
        listener, err = netListen(addr)               <span class="hljs-comment">// remote debug mode via TCP network</span>
    } <span class="hljs-keyword">else</span> {
        listener, clientConn = service.ListenerPipe() <span class="hljs-comment">// local debug mode via net.Pipe</span>
    }
      ...

    <span class="hljs-comment">// debugger backend: create and start a debugger server</span>
    server := rpccommon.NewServer(&amp;service.Config{
        Listener:       listener,
        ProcessArgs:    processArgs,
        AcceptMulti:    acceptMulti,
        DisconnectChan: disconnectChan,
        Debugger: debugger.Config{
            AttachPid:             attachPid,
            ...
        },
    })

    <span class="hljs-comment">// debugger backend: run the server</span>
    <span class="hljs-keyword">if</span> err := server.Run(); err != <span class="hljs-literal">nil</span> {
        ...
    }

    ...
}
</code></pre>
<p>After <code>server.Run()</code> starts executing, it creates a ptracer and attaches to the target process, then starts accepting incoming connection requests and processing RPC requests.</p>
<pre><code class="lang-go"><span class="hljs-comment">// Run starts a debugger and exposes it with an JSON-RPC server. The debugger</span>
<span class="hljs-comment">// itself can be stopped with the `detach` API.</span>
<span class="hljs-keyword">func</span> (s *ServerImpl) Run() error {
    <span class="hljs-keyword">var</span> err error

    <span class="hljs-comment">// Create and start the debugger</span>
    config := s.config.Debugger
    <span class="hljs-keyword">if</span> s.debugger, err = debugger.New(&amp;config, s.config.ProcessArgs); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }

    s.s2 = rpc2.NewServer(s.config, s.debugger)
    s.methodMap = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*methodType)

    <span class="hljs-comment">// register RPC methods and relevant handlers</span>
    registerMethods(s.s2, s.methodMap)

    <span class="hljs-comment">// accept incoming connections and serves the RPC requests</span>
    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">defer</span> s.listener.Close()
        <span class="hljs-keyword">for</span> {
            c, err := s.listener.Accept()
      ...
            <span class="hljs-keyword">go</span> s.serveConnection(c)
            <span class="hljs-keyword">if</span> !s.config.AcceptMulti {
                <span class="hljs-keyword">break</span>
            }
        }
    }()
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<p>So, when is the attach operation executed? Shouldn&apos;t the debugger frontend send an attach request to the debugger backend? Theoretically it could be done this way, but actually there&apos;s no need for another round of RPC. Consider:</p>
<ol>
<li>If it&apos;s remote debugging, when starting the server with --headless, I definitely know which tracee to attach to, so why would the client need to explicitly send an RPC request;</li>
<li>If it&apos;s local debugging, the pid parameter has already been passed to the process through command line options, so in local debugging we can directly reference this option value, no need to go through RPC again;</li>
</ol>
<p>Indeed, so there actually isn&apos;t this active Attach RPC. If you don&apos;t believe it, you can look at the rpc2.Client interface definition.</p>
<p>see: path-to/tinydbg/service/rpc2c/client.go</p>
<h4 id="debugger-backend-attaching-to-process">Debugger Backend Attaching to Process</h4>
<p>OK, following the previous content, besides network (listener, accept, serve) related initialization, the debugger backend also involves creating a real debugger tracer to control the target process tracee. Actually, the attach operation is completed at this time.</p>
<p>see: path-to/tinydbg/service/debugger/debugger.go</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> debugger

<span class="hljs-comment">// New creates a new Debugger. ProcessArgs specify the commandline arguments for the</span>
<span class="hljs-comment">// new process.</span>
<span class="hljs-keyword">func</span> New(config *Config, processArgs []<span class="hljs-keyword">string</span>) (*Debugger, error) {
  ...
    d := &amp;Debugger{
        config:      config,
        processArgs: processArgs,
        log:         logger,
    }

    <span class="hljs-comment">// Create the process by either attaching or launching.</span>
    <span class="hljs-keyword">switch</span> {
    <span class="hljs-keyword">case</span> d.config.AttachPid &gt; <span class="hljs-number">0</span> || d.config.AttachWaitFor != <span class="hljs-string">&quot;&quot;</span>:
        d.log.Infof(<span class="hljs-string">&quot;attaching to pid %d&quot;</span>, d.config.AttachPid)

        path := <span class="hljs-string">&quot;&quot;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(d.processArgs) &gt; <span class="hljs-number">0</span> {
            path = d.processArgs[<span class="hljs-number">0</span>]
        }

        <span class="hljs-keyword">var</span> waitFor *proc.WaitFor
        <span class="hljs-keyword">if</span> d.config.AttachWaitFor != <span class="hljs-string">&quot;&quot;</span> {
            waitFor = &amp;proc.WaitFor{
                Name:     d.config.AttachWaitFor,
                Interval: time.Duration(d.config.AttachWaitForInterval * <span class="hljs-keyword">float64</span>(time.Millisecond)),
                Duration: time.Duration(d.config.AttachWaitForDuration * <span class="hljs-keyword">float64</span>(time.Millisecond)),
            }
        }

    <span class="hljs-comment">// attach the target tracee</span>
        <span class="hljs-keyword">var</span> err error
        d.target, err = d.Attach(d.config.AttachPid, path, waitFor)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            err = go11DecodeErrorCheck(err)
            err = noDebugErrorWarning(err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, attachErrorMessage(d.config.AttachPid, err)
        }

    <span class="hljs-keyword">case</span> d.config.CoreFile != <span class="hljs-string">&quot;&quot;</span>:
    ...
  <span class="hljs-keyword">default</span>:
    ...
    }

    <span class="hljs-keyword">return</span> d, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Attach will attach to the process specified by &apos;pid&apos;.</span>
<span class="hljs-keyword">func</span> (d *Debugger) Attach(pid <span class="hljs-keyword">int</span>, path <span class="hljs-keyword">string</span>, waitFor *proc.WaitFor) (*proc.TargetGroup, error) {
    <span class="hljs-keyword">return</span> native.Attach(pid, waitFor)
}
</code></pre>
<p>Our debugger backend only has a native implementation, we removed gdb, lldb, mozilla rr. You should understand that if you want to extend it, you should make changes here.</p>
<pre><code class="lang-go"><span class="hljs-comment">// Attach to an existing process with the given PID. Once attached, if</span>
<span class="hljs-comment">// the DWARF information cannot be found in the binary, Delve will look</span>
<span class="hljs-comment">// for external debug files in the directories passed in.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// note: we remove the support of reading separate dwarfdata.</span>
<span class="hljs-keyword">func</span> Attach(pid <span class="hljs-keyword">int</span>, waitFor *proc.WaitFor) (*proc.TargetGroup, error) {
  <span class="hljs-comment">// If waitfor attach is specified, need to wait for process to start and get pid</span>
    <span class="hljs-keyword">if</span> waitFor.Valid() {
        pid, err = WaitFor(waitFor)
    ...
    }

    dbp := newProcess(pid)

  <span class="hljs-comment">// Execute actual ptrace attach operation</span>
    <span class="hljs-keyword">var</span> err error
    dbp.execPtraceFunc(<span class="hljs-keyword">func</span>() { err = ptraceAttach(dbp.pid) })
  ...

  <span class="hljs-comment">// Execute wait operation to get tracee stop status</span>
    _, _, err = dbp.wait(dbp.pid, <span class="hljs-number">0</span>)
    ...

  <span class="hljs-comment">// After tracee stops, try to read tracee information and complete necessary setup</span>
    tgt, err := dbp.initialize(findExecutable(<span class="hljs-string">&quot;&quot;</span>, dbp.pid))
  ...

    <span class="hljs-comment">// ElfUpdateSharedObjects can only be done after we initialize because it</span>
    <span class="hljs-comment">// needs an initialized BinaryInfo object to work.</span>
    err = linutil.ElfUpdateSharedObjects(dbp)
    ...
    <span class="hljs-keyword">return</span> tgt, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>At this point, the debugger backend has correctly established a ptrace link relationship with the tracee. Subsequently, the frontend can send interactive debugging commands through debug.Session, which internally converts them to RPC calls debug.Session.client.Call(...).</p>
<p>Then the debugger backend continuously accepts requests through net.Conn, decodes them according to JSON-RPC, finds the corresponding server interface for processing based on the request parameters. The interface internally calls various operations in debugger native to complete actual control of the target process, and returns results level by level, finally giving them to the frontend for display.</p>
<h4 id="what-the-debugger-backend-does-after-attaching-to-process">What the Debugger Backend Does After Attaching to Process</h4>
<p>see path-to/tinydbg/pkg/proc/native/proc.go</p>
<pre><code class="lang-go"><span class="hljs-comment">// initialize will ensure that all relevant information is loaded</span>
<span class="hljs-comment">// so the process is ready to be debugged.</span>
<span class="hljs-keyword">func</span> (dbp *nativeProcess) initialize(path <span class="hljs-keyword">string</span>) (*proc.TargetGroup, error) {
    cmdline, err := dbp.initializeBasic()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    stopReason := proc.StopLaunched
    <span class="hljs-keyword">if</span> !dbp.childProcess {
        stopReason = proc.StopAttached
    }

    procgrp := &amp;processGroup{}
    grp, addTarget := proc.NewGroup(procgrp, proc.NewTargetGroupConfig{
        DisableAsyncPreempt: <span class="hljs-literal">false</span>,
        StopReason: stopReason,
        CanDump:    <span class="hljs-literal">true</span>,
    })
    procgrp.addTarget = addTarget
    tgt, err := procgrp.add(dbp, dbp.pid, dbp.memthread, path, stopReason, cmdline)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> grp, <span class="hljs-literal">nil</span>
}

<span class="hljs-keyword">func</span> (dbp *nativeProcess) initializeBasic() (<span class="hljs-keyword">string</span>, error) {
    cmdline, err := initialize(dbp)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, err
    }
    <span class="hljs-keyword">if</span> err := dbp.updateThreadList(); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, err
    }
    <span class="hljs-keyword">return</span> cmdline, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>see path-to/tinydbg/pkg/proc/native/proc_linux.go</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> initialize(dbp *nativeProcess) (<span class="hljs-keyword">string</span>, error) {
    comm, err := os.ReadFile(fmt.Sprintf(<span class="hljs-string">&quot;/proc/%d/comm&quot;</span>, dbp.pid))
    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// removes newline character</span>
        comm = bytes.TrimSuffix(comm, []<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;\n&quot;</span>))
    }

    <span class="hljs-keyword">if</span> comm == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(comm) &lt;= <span class="hljs-number">0</span> {
        stat, err := os.ReadFile(fmt.Sprintf(<span class="hljs-string">&quot;/proc/%d/stat&quot;</span>, dbp.pid))
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, fmt.Errorf(<span class="hljs-string">&quot;could not read proc stat: %v&quot;</span>, err)
        }
        expr := fmt.Sprintf(<span class="hljs-string">&quot;%d\\s*\\((.*)\\)&quot;</span>, dbp.pid)
        rexp, err := regexp.Compile(expr)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, fmt.Errorf(<span class="hljs-string">&quot;regexp compile error: %v&quot;</span>, err)
        }
        match := rexp.FindSubmatch(stat)
        <span class="hljs-keyword">if</span> match == <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, fmt.Errorf(<span class="hljs-string">&quot;no match found using regexp &apos;%s&apos; in /proc/%d/stat&quot;</span>, expr, dbp.pid)
        }
        comm = match[<span class="hljs-number">1</span>]
    }
    dbp.os.comm = strings.ReplaceAll(<span class="hljs-keyword">string</span>(comm), <span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;%%&quot;</span>)

    <span class="hljs-keyword">return</span> getCmdLine(dbp.pid), <span class="hljs-literal">nil</span>  ...
}

<span class="hljs-keyword">func</span> (dbp *nativeProcess) updateThreadList() error {
    tids, _ := filepath.Glob(fmt.Sprintf(<span class="hljs-string">&quot;/proc/%d/task/*&quot;</span>, dbp.pid))
    <span class="hljs-keyword">for</span> _, tidpath := <span class="hljs-keyword">range</span> tids {
        tidstr := filepath.Base(tidpath)
        tid, err := strconv.Atoi(tidstr)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> err
        }
        <span class="hljs-keyword">if</span> _, err := dbp.addThread(tid, tid != dbp.pid); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> err
        }
    }
    <span class="hljs-keyword">return</span> linutil.ElfUpdateSharedObjects(dbp)
}
</code></pre>
<p>It looks like after attaching to the target process, it starts reading some information about the target process, including pid, cmdline, exec, thread list, etc.</p>
<p>Note that there may already be multiple threads created in the process, or new threads may be created in the future. For more user-friendly multi-threaded debugging, these all need to be managed:</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> (
    ptraceOptionsNormal     = syscall.PTRACE_O_TRACECLONE
    ptraceOptionsFollowExec = syscall.PTRACE_O_TRACECLONE | syscall.PTRACE_O_TRACEVFORK | syscall.PTRACE_O_TRACEEXEC
)

<span class="hljs-comment">// Attach to a newly created thread, and store that thread in our list of</span>
<span class="hljs-comment">// known threads.</span>
<span class="hljs-keyword">func</span> (dbp *nativeProcess) addThread(tid <span class="hljs-keyword">int</span>, attach <span class="hljs-keyword">bool</span>) (*nativeThread, error) {
    <span class="hljs-keyword">if</span> thread, ok := dbp.threads[tid]; ok {
        <span class="hljs-keyword">return</span> thread, <span class="hljs-literal">nil</span>
    }

    ptraceOptions := ptraceOptionsNormal
    <span class="hljs-keyword">if</span> dbp.followExec {
        ptraceOptions = ptraceOptionsFollowExec
    }

    <span class="hljs-keyword">var</span> err error
    <span class="hljs-keyword">if</span> attach {
        dbp.execPtraceFunc(<span class="hljs-keyword">func</span>() { err = sys.PtraceAttach(tid) })
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &amp;&amp; err != sys.EPERM {
            <span class="hljs-comment">// Do not return err if err == EPERM,</span>
            <span class="hljs-comment">// we may already be tracing this thread due to</span>
            <span class="hljs-comment">// PTRACE_O_TRACECLONE. We will surely blow up later</span>
            <span class="hljs-comment">// if we truly don&apos;t have permissions.</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;could not attach to new thread %d %s&quot;</span>, tid, err)
        }
        pid, status, err := dbp.waitFast(tid)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        <span class="hljs-keyword">if</span> status.Exited() {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;thread already exited %d&quot;</span>, pid)
        }
    }

    dbp.execPtraceFunc(<span class="hljs-keyword">func</span>() { err = syscall.PtraceSetOptions(tid, ptraceOptions) })
    <span class="hljs-keyword">if</span> err == syscall.ESRCH {
        <span class="hljs-keyword">if</span> _, _, err = dbp.waitFast(tid); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;error while waiting after adding thread: %d %s&quot;</span>, tid, err)
        }
        dbp.execPtraceFunc(<span class="hljs-keyword">func</span>() { err = syscall.PtraceSetOptions(tid, ptraceOptions) })
        <span class="hljs-keyword">if</span> err == syscall.ESRCH {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;could not set options for new traced thread %d %s&quot;</span>, tid, err)
        }
    }

    dbp.threads[tid] = &amp;nativeThread{
        ID:  tid,
        dbp: dbp,
        os:  <span class="hljs-built_in">new</span>(osSpecificDetails),
    }
    <span class="hljs-keyword">if</span> dbp.memthread == <span class="hljs-literal">nil</span> {
        dbp.memthread = dbp.threads[tid]
    }
    <span class="hljs-keyword">for</span> _, bp := <span class="hljs-keyword">range</span> dbp.Breakpoints().M {
        <span class="hljs-keyword">if</span> bp.WatchType != <span class="hljs-number">0</span> {
            err := dbp.threads[tid].writeHardwareBreakpoint(bp.Addr, bp.WatchType, bp.HWBreakIndex)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
            }
        }
    }
    <span class="hljs-keyword">return</span> dbp.threads[tid], <span class="hljs-literal">nil</span>
}
</code></pre>
<p>This way, all current and future threads in the target process are brought under the debugger&apos;s control logic. The debugger can control them as a group, making them all execute or pause.</p>
<h4 id="accepting-incoming-connection-requests-and-processing-requests">Accepting Incoming Connection Requests and Processing Requests</h4>
<p>After the debugger backend receives an incoming connection request, it starts processing interactive debugging requests on the connection: <code>s.serveConnection(c)</code>. We&apos;ve already introduced this part in detail in the previous section on debugging sessions, so we won&apos;t repeat it here.</p>
<p>At this point, the attach operation is complete. If it&apos;s local debugging mode, you can start interactive debugging directly through the debugging session provided by the frontend; if it&apos;s remote debugging mode, you still need to establish a connection with the server through the connect operation and create a debugging session before you can start debugging.</p>
<h4 id="attach-operation-doesnt-involve-rpc">Attach Operation Doesn&apos;t Involve RPC</h4>
<p>For the attach operation, it doesn&apos;t involve JSON-RPC calls between frontend and backend, as we&apos;ve already introduced. Here we specifically mention it. When you want to look at the detailed code for the attach operation, you can search for attachCmd, but don&apos;t search for the corresponding RPC method in rpc2/client.go, because there isn&apos;t one.</p>
<h3 id="running-tests">Running Tests</h3>
<p>TODO:</p>
<ol>
<li>Single-threaded program from the start</li>
<li>Multi-threaded program from the start</li>
<li>Program that creates new threads during execution</li>
</ol>
<p>To observe if they are all attached, 1 and 2 can be verified, but 3 cannot because after attaching all existing threads are paused. But we can&apos;t verify 3 yet because we haven&apos;t implemented continue, disconnect and other operations to resume execution.</p>
<h3 id="summary">Summary</h3>
<p>This article detailed the implementation of tinydbg&apos;s attach command, mainly including the following aspects:</p>
<ol>
<li><p>Attach command option design, including basic pid attachment, waitfor process waiting, multi-client support and other advanced features;</p>
</li>
<li><p>Basic principles of attach, showing the entire process from user input command to final process attachment through a sequence diagram;</p>
</li>
<li><p>Code implementation details:</p>
<ul>
<li>How the debugger frontend parses and processes attach commands</li>
<li>How the debugger backend implements process attachment</li>
<li>How to handle multi-threading in the target process</li>
<li>How to maintain thread state and hardware breakpoints</li>
</ul>
</li>
<li><p>Test scenario design, including attach testing for single-threaded programs, multi-threaded programs, and programs that create new threads during runtime.</p>
</li>
</ol>
<p>Through this article, readers should understand how the debugger implements process attachment functionality and the various details that need to be considered in the implementation process. Subsequent chapters will continue to introduce the implementation of other debugging features based on this foundation.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="01-debug-session.html" class="navigation navigation-prev " aria-label="Previous page: 9.2.01 Opening Debug Session">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="12-tinydbg_attach_waitfor.html" class="navigation navigation-next " aria-label="Next page: 9.2.12 tinydbg attach+waitfor">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"9.2.11 tinydbg attach","level":"1.9.2.3","depth":3,"next":{"title":"9.2.12 tinydbg attach+waitfor","level":"1.9.2.4","depth":3,"path":"9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.md","ref":"9-develop-sym-debugger/2-核心调试逻辑/12-tinydbg_attach_waitfor.md","articles":[]},"previous":{"title":"9.2.01 Opening Debug Session","level":"1.9.2.2","depth":3,"path":"9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.md","ref":"9-develop-sym-debugger/2-核心调试逻辑/01-debug-session.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc"],"pluginsConfig":{"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"9-develop-sym-debugger/2-核心调试逻辑/11-tinydbg_attach.md","mtime":"2025-06-15T12:39:40.759Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-15T18:01:33.391Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


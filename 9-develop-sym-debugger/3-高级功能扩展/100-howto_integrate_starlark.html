
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>9.3.100 Integrating starlark · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-md-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="101-howto_tracing_via_ebpf.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    1 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../2-preface/">
            
                <a href="../../2-preface/">
            
                    
                    2 Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../3-terms/">
            
                <a href="../../3-terms/">
            
                    
                    3 Common Terms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../4-basics/">
            
                <a href="../../4-basics/">
            
                    
                    4 Software Debugging Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../4-basics/1-purposes.html">
            
                <a href="../../4-basics/1-purposes.html">
            
                    
                    4.1 Debugging Purposes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../4-basics/2-dependencies.html">
            
                <a href="../../4-basics/2-dependencies.html">
            
                    
                    4.2 Debugging Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../4-basics/3-countertactics.html">
            
                <a href="../../4-basics/3-countertactics.html">
            
                    
                    4.3 Anti-Debugging Techniques
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../5-debugger-skeleton/">
            
                <a href="../../5-debugger-skeleton/">
            
                    
                    5 Entering Debugger Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                <a href="../../5-debugger-skeleton/1-debugger_skeleton.html">
            
                    
                    5.1 Debugger Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../5-debugger-skeleton/2-debugger_demo.html">
            
                <a href="../../5-debugger-skeleton/2-debugger_demo.html">
            
                    
                    5.2 Debugger Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../6-develop-inst-debugger/">
            
                <a href="../../6-develop-inst-debugger/">
            
                    
                    6 Developing Go Instruction-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../6-develop-inst-debugger/1-process_start.html">
            
                <a href="../../6-develop-inst-debugger/1-process_start.html">
            
                    
                    6.1 Process Launch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../6-develop-inst-debugger/2-process_attach.html">
            
                <a href="../../6-develop-inst-debugger/2-process_attach.html">
            
                    
                    6.2 Process Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                <a href="../../6-develop-inst-debugger/3-process_start_attach.html">
            
                    
                    6.3 Launch & Attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../6-develop-inst-debugger/4-debug-session.html">
            
                <a href="../../6-develop-inst-debugger/4-debug-session.html">
            
                    
                    6.4 Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../6-develop-inst-debugger/5-disassemble.html">
            
                <a href="../../6-develop-inst-debugger/5-disassemble.html">
            
                    
                    6.5 Disassembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../6-develop-inst-debugger/6-breakpoint.html">
            
                <a href="../../6-develop-inst-debugger/6-breakpoint.html">
            
                    
                    6.6 Adding Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../6-develop-inst-debugger/7-breakpoints.html">
            
                <a href="../../6-develop-inst-debugger/7-breakpoints.html">
            
                    
                    6.7 Listing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../6-develop-inst-debugger/8-clear.html">
            
                <a href="../../6-develop-inst-debugger/8-clear.html">
            
                    
                    6.8 Removing Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../6-develop-inst-debugger/9-clearall.html">
            
                <a href="../../6-develop-inst-debugger/9-clearall.html">
            
                    
                    6.9 Clearing All Breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../6-develop-inst-debugger/10-step.html">
            
                <a href="../../6-develop-inst-debugger/10-step.html">
            
                    
                    6.10 Stepping Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../6-develop-inst-debugger/11-continue.html">
            
                <a href="../../6-develop-inst-debugger/11-continue.html">
            
                    
                    6.11 Running to Breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../6-develop-inst-debugger/12-pmem.html">
            
                <a href="../../6-develop-inst-debugger/12-pmem.html">
            
                    
                    6.12 Printing Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../6-develop-inst-debugger/13-pregs.html">
            
                <a href="../../6-develop-inst-debugger/13-pregs.html">
            
                    
                    6.13 Printing Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../6-develop-inst-debugger/14-set-mem.html">
            
                <a href="../../6-develop-inst-debugger/14-set-mem.html">
            
                    
                    6.14 Modifying Memory Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../../6-develop-inst-debugger/15-set-regs.html">
            
                <a href="../../6-develop-inst-debugger/15-set-regs.html">
            
                    
                    6.15 Modifying Register Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                <a href="../../6-develop-inst-debugger/20-trace_new_threads.html">
            
                    
                    6.20 Tracing Multi-threaded Programs 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                <a href="../../6-develop-inst-debugger/21-trace_old_threads.html">
            
                    
                    6.21 Tracing Multi-threaded Programs 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../../6-develop-inst-debugger/80-aslr.html">
            
                <a href="../../6-develop-inst-debugger/80-aslr.html">
            
                    
                    6.80 Understanding ASLR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../../6-develop-inst-debugger/99-more.html">
            
                <a href="../../6-develop-inst-debugger/99-more.html">
            
                    
                    6.99 More...
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../7-headto-sym-debugger/">
            
                <a href="../../7-headto-sym-debugger/">
            
                    
                    7 Advancing to Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                <a href="../../7-headto-sym-debugger/1-how-go-build-works.html">
            
                    
                    7.1 Go Build Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../7-headto-sym-debugger/2-elf.html">
            
                <a href="../../7-headto-sym-debugger/2-elf.html">
            
                    
                    7.2 Understanding ELF Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../7-headto-sym-debugger/3-syms.html">
            
                <a href="../../7-headto-sym-debugger/3-syms.html">
            
                    
                    7.3 Symbols & Symbol Tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                <a href="../../7-headto-sym-debugger/4-syms-resolve-reloc.html">
            
                    
                    7.4 Symbol Resolution & Relocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../7-headto-sym-debugger/5-loading.html">
            
                <a href="../../7-headto-sym-debugger/5-loading.html">
            
                    
                    7.5 Loading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/">
            
                    
                    7.6 Go Standard Library debug/*
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.6.1" data-path="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/1-elf.html">
            
                    
                    7.6.1 debug/elf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.2" data-path="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/2-gosym.html">
            
                    
                    7.6.2 debug/gosym
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6.3" data-path="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/6-gopkg-debug/3-dwarf.html">
            
                    
                    7.6.3 debug/dwarf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/">
            
                    
                    7.7 Advancing to DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/1-gopkgs-about-dwarf.html">
            
                    
                    7.7.1 Related Go Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/2-delve-into-internals.html">
            
                    
                    7.7.2 How to Crack Those Details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/3-compiler-gen-dwarfdata.html">
            
                    
                    7.7.3 Compiler Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/4-linker-gen-dwarfdata.html">
            
                    
                    7.7.4 Linker Generated DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                <a href="../../7-headto-sym-debugger/7-headto-dwarf/5-headto-dwarf.html">
            
                    
                    7.7.5 Understanding DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../8-dwarf/">
            
                <a href="../../8-dwarf/">
            
                    
                    8 Debug Information Standard: DWARF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../8-dwarf/1-history.html">
            
                <a href="../../8-dwarf/1-history.html">
            
                    
                    8.1 DWARF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../8-dwarf/2-overview.html">
            
                <a href="../../8-dwarf/2-overview.html">
            
                    
                    8.2 DWARF Content Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../8-dwarf/3-dwarfdata.html">
            
                <a href="../../8-dwarf/3-dwarfdata.html">
            
                    
                    8.3 DWARF Data Classification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../8-dwarf/4-die/">
            
                <a href="../../8-dwarf/4-die/">
            
                    
                    8.4 DIE Detailed Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../../8-dwarf/4-die/1-desc-data-type.html">
            
                <a href="../../8-dwarf/4-die/1-desc-data-type.html">
            
                    
                    8.4.1 DIE Describing Data and Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../../8-dwarf/4-die/2-desc-locations.html">
            
                <a href="../../8-dwarf/4-die/2-desc-locations.html">
            
                    
                    8.4.2 Location Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../../8-dwarf/4-die/3-desc-code.html">
            
                <a href="../../8-dwarf/4-die/3-desc-code.html">
            
                    
                    8.4.3 DIE Describing Executable Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../../8-dwarf/4-die/4-encoding.html">
            
                <a href="../../8-dwarf/4-die/4-encoding.html">
            
                    
                    8.4.4 DIE Data Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../8-dwarf/5-other/">
            
                <a href="../../8-dwarf/5-other/">
            
                    
                    8.5 Other Debug Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../../8-dwarf/5-other/1-accelerated-access.html">
            
                <a href="../../8-dwarf/5-other/1-accelerated-access.html">
            
                    
                    8.5.1 Accelerated Access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../../8-dwarf/5-other/2-lineno-table.html">
            
                <a href="../../8-dwarf/5-other/2-lineno-table.html">
            
                    
                    8.5.2 Line Number Table Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../../8-dwarf/5-other/3-callframe-info.html">
            
                <a href="../../8-dwarf/5-other/3-callframe-info.html">
            
                    
                    8.5.3 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../../8-dwarf/5-other/4-macro-info.html">
            
                <a href="../../8-dwarf/5-other/4-macro-info.html">
            
                    
                    8.5.4 Macro Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../../8-dwarf/5-other/5-varlen-data.html">
            
                <a href="../../8-dwarf/5-other/5-varlen-data.html">
            
                    
                    8.5.5 Variable Length Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.6" data-path="../../8-dwarf/5-other/6-shrink-data.html">
            
                <a href="../../8-dwarf/5-other/6-shrink-data.html">
            
                    
                    8.5.6 Compressed DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.7" data-path="../../8-dwarf/5-other/7-elf-sections.html">
            
                <a href="../../8-dwarf/5-other/7-elf-sections.html">
            
                    
                    8.5.7 ELF Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../8-dwarf/6-practices.html">
            
                <a href="../../8-dwarf/6-practices.html">
            
                    
                    8.6 DWARF Parsing and Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../../8-dwarf/7-summary.html">
            
                <a href="../../8-dwarf/7-summary.html">
            
                    
                    8.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../">
            
                <a href="../">
            
                    
                    9 Developing Go Symbol-Level Debugger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../1-架构设计/">
            
                <a href="../1-架构设计/">
            
                    
                    9.1 Architecture Design
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../1-架构设计/1-现代调试器架构.html">
            
                <a href="../1-架构设计/1-现代调试器架构.html">
            
                    
                    9.1.1 Modern Debugger Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../1-架构设计/2-前端UI层设计.html">
            
                <a href="../1-架构设计/2-前端UI层设计.html">
            
                    
                    9.1.2 Frontend UI Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../1-架构设计/3-Service层设计.html">
            
                <a href="../1-架构设计/3-Service层设计.html">
            
                    
                    9.1.3 Service Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../1-架构设计/4-后端符号层设计.html">
            
                <a href="../1-架构设计/4-后端符号层设计.html">
            
                    
                    9.1.4 Backend Symbol Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.5" data-path="../1-架构设计/5-后端目标层设计.html">
            
                <a href="../1-架构设计/5-后端目标层设计.html">
            
                    
                    9.1.5 Backend Target Layer Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.6" data-path="../1-架构设计/6-日志系统设计.html">
            
                <a href="../1-架构设计/6-日志系统设计.html">
            
                    
                    9.1.6 Logging System Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../2-核心调试逻辑/">
            
                <a href="../2-核心调试逻辑/">
            
                    
                    9.2 Core Debugging Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../2-核心调试逻辑/00-cmds.html">
            
                <a href="../2-核心调试逻辑/00-cmds.html">
            
                    
                    9.2.00 Core Debugging Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../2-核心调试逻辑/01-debug-session.html">
            
                <a href="../2-核心调试逻辑/01-debug-session.html">
            
                    
                    9.2.01 Opening Debug Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../2-核心调试逻辑/11-tinydbg_attach.html">
            
                <a href="../2-核心调试逻辑/11-tinydbg_attach.html">
            
                    
                    9.2.11 tinydbg attach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                <a href="../2-核心调试逻辑/12-tinydbg_attach_waitfor.html">
            
                    
                    9.2.12 tinydbg attach+waitfor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="../2-核心调试逻辑/13-tinydbg_exec.html">
            
                <a href="../2-核心调试逻辑/13-tinydbg_exec.html">
            
                    
                    9.2.13 tinydbg exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="../2-核心调试逻辑/14-tinydbg_debug.html">
            
                <a href="../2-核心调试逻辑/14-tinydbg_debug.html">
            
                    
                    9.2.14 tinydbg debug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="../2-核心调试逻辑/15-tinydbg_core1.html">
            
                <a href="../2-核心调试逻辑/15-tinydbg_core1.html">
            
                    
                    9.2.15 tinydbg core - part1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="../2-核心调试逻辑/15-tinydbg_core2.html">
            
                <a href="../2-核心调试逻辑/15-tinydbg_core2.html">
            
                    
                    9.2.15 tinydbg core - part2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="../2-核心调试逻辑/16-tinydbg_connect.html">
            
                <a href="../2-核心调试逻辑/16-tinydbg_connect.html">
            
                    
                    9.2.16 tinydbg connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="../2-核心调试逻辑/17-tinydbg_trace.html">
            
                <a href="../2-核心调试逻辑/17-tinydbg_trace.html">
            
                    
                    9.2.17 tinydbg trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="../2-核心调试逻辑/21-disassemble.html">
            
                <a href="../2-核心调试逻辑/21-disassemble.html">
            
                    
                    9.2.21 tinydbg> disass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.12" data-path="../2-核心调试逻辑/22-breakpoint.html">
            
                <a href="../2-核心调试逻辑/22-breakpoint.html">
            
                    
                    9.2.22 tinydbg> breakpoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.13" data-path="../2-核心调试逻辑/23-breakpoints.html">
            
                <a href="../2-核心调试逻辑/23-breakpoints.html">
            
                    
                    9.2.23 tinydbg> breakpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.14" data-path="../2-核心调试逻辑/24-clear.html">
            
                <a href="../2-核心调试逻辑/24-clear.html">
            
                    
                    9.2.24 tinydbg> clear | toggle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.15" data-path="../2-核心调试逻辑/25-clearall.html">
            
                <a href="../2-核心调试逻辑/25-clearall.html">
            
                    
                    9.2.25 tinydbg> clearall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.16" data-path="../2-核心调试逻辑/26-step.html">
            
                <a href="../2-核心调试逻辑/26-step.html">
            
                    
                    9.2.26 tinydbg> next | step | stepi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.17" data-path="../2-核心调试逻辑/27-continue.html">
            
                <a href="../2-核心调试逻辑/27-continue.html">
            
                    
                    9.2.27 Continue Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.18" data-path="../2-核心调试逻辑/28-pmem.html">
            
                <a href="../2-核心调试逻辑/28-pmem.html">
            
                    
                    9.2.28 View Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.19" data-path="../2-核心调试逻辑/29-regs.html">
            
                <a href="../2-核心调试逻辑/29-regs.html">
            
                    
                    9.2.29 View Registers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.20" data-path="../2-核心调试逻辑/30-call-frame.html">
            
                <a href="../2-核心调试逻辑/30-call-frame.html">
            
                    
                    9.2.30 Call Frame Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.21" data-path="../2-核心调试逻辑/31-vars.html">
            
                <a href="../2-核心调试逻辑/31-vars.html">
            
                    
                    9.2.31 Variables & Type System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.22" data-path="../2-核心调试逻辑/32-how_listfunctions_work.html">
            
                <a href="../2-核心调试逻辑/32-how_listfunctions_work.html">
            
                    
                    9.2.32 how ListFunctions work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.23" data-path="../2-核心调试逻辑/32-funcs.html">
            
                <a href="../2-核心调试逻辑/32-funcs.html">
            
                    
                    9.2.32 funcs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.24" data-path="../2-核心调试逻辑/33-goroutines.html">
            
                <a href="../2-核心调试逻辑/33-goroutines.html">
            
                    
                    9.2.33 Goroutines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.25" data-path="../2-核心调试逻辑/34-multi-threads.html">
            
                <a href="../2-核心调试逻辑/34-multi-threads.html">
            
                    
                    9.2.34 Tracing Multi-threaded Programs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="./">
            
                <a href="./">
            
                    
                    9.3 Advanced Feature Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.9.3.1" data-path="100-howto_integrate_starlark.html">
            
                <a href="100-howto_integrate_starlark.html">
            
                    
                    9.3.100 Integrating starlark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="101-howto_tracing_via_ebpf.html">
            
                <a href="101-howto_tracing_via_ebpf.html">
            
                    
                    9.3.101 Tracing with eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="102-howto_syntax_highlight.html">
            
                <a href="102-howto_syntax_highlight.html">
            
                    
                    9.3.102 Implementing Syntax Highlighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="103-howto_paging_output.html">
            
                <a href="103-howto_paging_output.html">
            
                    
                    9.3.103 Implementing Paged Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="104-howto_read_separate_dwarfdata.html">
            
                <a href="104-howto_read_separate_dwarfdata.html">
            
                    
                    9.3.104 Reading Separately Stored DWARF Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.6" data-path="105-howto_guess_substitutepath.html">
            
                <a href="105-howto_guess_substitutepath.html">
            
                    
                    9.3.105 Automatic Source File Path Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.7" data-path="106-howto_redirect_target_io.html">
            
                <a href="106-howto_redirect_target_io.html">
            
                    
                    9.3.106 Implementing Target Process IO Redirection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.8" data-path="107-howto_customize_tinydbg.html">
            
                <a href="107-howto_customize_tinydbg.html">
            
                    
                    9.3.107 Supporting User Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.9" data-path="108-howto_accept_multiclient.html">
            
                <a href="108-howto_accept_multiclient.html">
            
                    
                    9.3.108 Supporting Multi-client Debug Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.10" data-path="109-howto_transcript_debugging.html">
            
                <a href="109-howto_transcript_debugging.html">
            
                    
                    9.3.109 Supporting Debug Activity Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../10-extras/">
            
                <a href="../../10-extras/">
            
                    
                    10 Mainstream Debugging Technology Analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../10-extras/1-development-of-debugger.html">
            
                <a href="../../10-extras/1-development-of-debugger.html">
            
                    
                    10.1 Debugger Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../../10-extras/2-development-of-logging.html">
            
                <a href="../../10-extras/2-development-of-logging.html">
            
                    
                    10.2 Logging System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../../10-extras/3-development-of-metrics.html">
            
                <a href="../../10-extras/3-development-of-metrics.html">
            
                    
                    10.3 Metrics System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../../10-extras/4-development-of-tracing.html">
            
                <a href="../../10-extras/4-development-of-tracing.html">
            
                    
                    10.4 Tracing System Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../../10-extras/5-development-of-bisect.html">
            
                <a href="../../10-extras/5-development-of-bisect.html">
            
                    
                    10.5 Bisect Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../../10-extras/6-development-of-ebpf.html">
            
                <a href="../../10-extras/6-development-of-ebpf.html">
            
                    
                    10.6 eBPF Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../../10-extras/7-development-of-replay.html">
            
                <a href="../../10-extras/7-development-of-replay.html">
            
                    
                    10.7 Record and Replay Development History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../../10-extras/8-development-of-debug-dsys.html">
            
                <a href="../../10-extras/8-development-of-debug-dsys.html">
            
                    
                    10.8 Distributed Debugging Development History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../11-thanks/">
            
                <a href="../../11-thanks/">
            
                    
                    11 Acknowledgments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../12-appendix/">
            
                <a href="../../12-appendix/">
            
                    
                    12 Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../../12-appendix/1-go-programme-start.html">
            
                <a href="../../12-appendix/1-go-programme-start.html">
            
                    
                    12.1 Go Program Startup Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                <a href="../../12-appendix/2-auto-trace-cloned-threads.html">
            
                    
                    12.2 Automatic Thread Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../../12-appendix/3-git-bisect.html">
            
                <a href="../../12-appendix/3-git-bisect.html">
            
                    
                    12.3 git bisect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../../12-appendix/80-go-tool-compile.html">
            
                <a href="../../12-appendix/80-go-tool-compile.html">
            
                    
                    12.10 Compilation Toolchain/compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../../12-appendix/81-go-tool-asm.html">
            
                <a href="../../12-appendix/81-go-tool-asm.html">
            
                    
                    12.11 Compilation Toolchain/asm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../../12-appendix/82-go-tool-link.html">
            
                <a href="../../12-appendix/82-go-tool-link.html">
            
                    
                    12.12 Compilation Toolchain/link
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../../12-appendix/90-why-buildid-loaded.html">
            
                <a href="../../12-appendix/90-why-buildid-loaded.html">
            
                    
                    12.13 More: GNU build-id+gobuildid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                <a href="../../12-appendix/91-syntax-and-semantic-analysis.html">
            
                    
                    12.14 More: Syntax Analysis vs Semantic Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                <a href="../../12-appendix/92-why-gdb-uses-symtab.html">
            
                    
                    12.15 More: Why GDB Uses Symbol Table+DWARF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >9.3.100 Integrating starlark</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="further-reading-make-your-program-more-powerful-with-starlark">Further Reading: Make Your Program More Powerful with Starlark</h2>
<p>Starlark is a configuration language derived from Python, but simpler and safer. It was originally developed by Google for the Bazel build system. Starlark retains Python&apos;s basic syntax and data types while removing some dangerous features like circular references and infinite recursion. This makes Starlark very suitable as a configuration or scripting language to be embedded in other programs.</p>
<p>The main features of Starlark include:</p>
<ol>
<li>Easy to Learn - Uses Python-style syntax, almost no learning curve for developers familiar with Python</li>
<li>Deterministic - Same input always produces same output, no randomness or side effects</li>
<li>Sandbox Isolation - Cannot access filesystem, network or other external resources, ensuring security</li>
<li>Extensible - Easy to expose host language (like Go) functions for use in Starlark</li>
<li>Fast Execution - Excellent interpreter performance, suitable for embedded use</li>
</ol>
<p>These features make Starlark an ideal embedded configuration/scripting language. By integrating Starlark into our Go programs, we can let users extend and customize program functionality using Starlark scripts, while ensuring security and controllability.</p>
<p>For example, in the go-delve/delve debugger, Starlark is used to write automated debugging scripts. Users can use Starlark scripts to automatically execute a series of debug commands, or trigger certain debugging operations based on specific conditions. This greatly enhances the debugger&apos;s flexibility and programmability.</p>
<p>Below we&apos;ll demonstrate through a simple example how to integrate the Starlark engine into a Go program and implement mutual function calls between Go and Starlark.</p>
<h3 id="integrating-the-starlark-engine-into-go-programs">Integrating the Starlark Engine into Go Programs</h3>
<p>Let&apos;s start with a simple example that demonstrates how to integrate the Starlark engine into a Go program. This example implements a basic REPL (Read-Eval-Print Loop) environment that allows users to input Starlark code and execute it immediately:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    ...

    <span class="hljs-string">&quot;go.starlark.net/starlark&quot;</span>
    <span class="hljs-string">&quot;go.starlark.net/syntax&quot;</span>
)

<span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// Create a new Starlark thread</span>
    thread := &amp;starlark.Thread{
        Name: <span class="hljs-string">&quot;repl&quot;</span>,
        Print: <span class="hljs-keyword">func</span>(thread *starlark.Thread, msg <span class="hljs-keyword">string</span>) {
            fmt.Println(msg)
        },
    }

    <span class="hljs-comment">// Create a new global environment</span>
    globals := starlark.StringDict{}

    <span class="hljs-comment">// Create a scanner for reading input</span>
    scanner := bufio.NewScanner(os.Stdin)
    fmt.Println(<span class="hljs-string">&quot;Starlark REPL (type &apos;exit&apos; to quit)&quot;</span>)

    errExit := errors.New(<span class="hljs-string">&quot;exit&quot;</span>)

    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">// Print prompt</span>
        fmt.Print(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)

        <span class="hljs-comment">// Read input</span>
        readline := <span class="hljs-keyword">func</span>() ([]<span class="hljs-keyword">byte</span>, error) {
            <span class="hljs-keyword">if</span> !scanner.Scan() {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, io.EOF
            }
            line := strings.TrimSpace(scanner.Text())
            <span class="hljs-keyword">if</span> line == <span class="hljs-string">&quot;exit&quot;</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errExit
            }
            <span class="hljs-keyword">if</span> line == <span class="hljs-string">&quot;&quot;</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>
            }
            <span class="hljs-keyword">return</span> []<span class="hljs-keyword">byte</span>(line + <span class="hljs-string">&quot;\n&quot;</span>), <span class="hljs-literal">nil</span>
        }

        <span class="hljs-comment">// Execute the input</span>
        <span class="hljs-keyword">if</span> err := rep(readline, thread, globals); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">if</span> err == io.EOF {
                <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">if</span> err == errExit {
                os.Exit(<span class="hljs-number">0</span>)
            }
            fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;Error: %v\n&quot;</span>, err)
        }
    }
}

<span class="hljs-comment">// rep reads, evaluates, and prints one item.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// It returns an error (possibly readline.ErrInterrupt)</span>
<span class="hljs-comment">// only if readline failed. Starlark errors are printed.</span>
<span class="hljs-keyword">func</span> rep(readline <span class="hljs-keyword">func</span>() ([]<span class="hljs-keyword">byte</span>, error), thread *starlark.Thread, globals starlark.StringDict) error {
    eof := <span class="hljs-literal">false</span>

    f, err := syntax.ParseCompoundStmt(<span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, readline)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">if</span> eof {
            <span class="hljs-keyword">return</span> io.EOF
        }
        printError(err)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-keyword">if</span> expr := soleExpr(f); expr != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span> check for &apos;exit&apos;</span>
        <span class="hljs-comment">// eval</span>
        v, err := evalExprOptions(<span class="hljs-literal">nil</span>, thread, expr, globals)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            printError(err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }

        <span class="hljs-comment">// print</span>
        <span class="hljs-keyword">if</span> v != starlark.None {
            fmt.Println(v)
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// compile</span>
        prog, err := starlark.FileProgram(f, globals.Has)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            printError(err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }

        <span class="hljs-comment">// execute (but do not freeze)</span>
        res, err := prog.Init(thread, globals)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            printError(err)
        }

        <span class="hljs-comment">// The global names from the previous call become</span>
        <span class="hljs-comment">// the predeclared names of this call.</span>
        <span class="hljs-comment">// If execution failed, some globals may be undefined.</span>
        <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> res {
            globals[k] = v
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-keyword">var</span> defaultSyntaxFileOpts = &amp;syntax.FileOptions{
    Set:             <span class="hljs-literal">true</span>,
    While:           <span class="hljs-literal">true</span>,
    TopLevelControl: <span class="hljs-literal">true</span>,
    GlobalReassign:  <span class="hljs-literal">true</span>,
    Recursion:       <span class="hljs-literal">true</span>,
}

<span class="hljs-comment">// evalExprOptions is a wrapper around starlark.EvalExprOptions.</span>
<span class="hljs-comment">// If no options are provided, it uses default options.</span>
<span class="hljs-keyword">func</span> evalExprOptions(opts *syntax.FileOptions, thread *starlark.Thread, expr syntax.Expr, globals starlark.StringDict) (starlark.Value, error) {
    <span class="hljs-keyword">if</span> opts == <span class="hljs-literal">nil</span> {
        opts = defaultSyntaxFileOpts
    }
    <span class="hljs-keyword">return</span> starlark.EvalExprOptions(opts, thread, expr, globals)
}

<span class="hljs-keyword">func</span> soleExpr(f *syntax.File) syntax.Expr {
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(f.Stmts) == <span class="hljs-number">1</span> {
        <span class="hljs-keyword">if</span> stmt, ok := f.Stmts[<span class="hljs-number">0</span>].(*syntax.ExprStmt); ok {
            <span class="hljs-keyword">return</span> stmt.X
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// printError prints the error to stderr,</span>
<span class="hljs-comment">// or its backtrace if it is a Starlark evaluation error.</span>
<span class="hljs-keyword">func</span> printError(err error) {
    <span class="hljs-keyword">if</span> evalErr, ok := err.(*starlark.EvalError); ok {
        fmt.Fprintln(os.Stderr, evalErr.Backtrace())
    } <span class="hljs-keyword">else</span> {
        fmt.Fprintln(os.Stderr, err)
    }
}
</code></pre>
<h3 id="calling-go-functions-directly-from-starlark">Calling Go Functions Directly from Starlark</h3>
<p>In this example, we&apos;ll demonstrate how to call Go functions from Starlark scripts. The main approach is:</p>
<ol>
<li>Define a Go function map (GoFuncMap) to register Go functions that can be called from Starlark</li>
<li>Implement a glue function (callGoFunc) to serve as a bridge between Starlark and Go functions</li>
<li>Register the glue function in Starlark&apos;s global environment so Starlark code can use it to call Go functions</li>
</ol>
<p>Here&apos;s a simple example showing how to let Starlark call a Go addition function:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    ...

    <span class="hljs-string">&quot;go.starlark.net/starlark&quot;</span>
    <span class="hljs-string">&quot;go.starlark.net/syntax&quot;</span>
)

<span class="hljs-comment">// GoFuncMap stores registered Go functions</span>
<span class="hljs-keyword">var</span> GoFuncMap = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}{
    <span class="hljs-string">&quot;Add&quot;</span>: Add,
}

<span class="hljs-keyword">func</span> Add(a, b <span class="hljs-keyword">int</span>) <span class="hljs-keyword">int</span> {
    fmt.Println(<span class="hljs-string">&quot;Hey! I&apos;m a Go function!&quot;</span>)
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// callGoFunc is a Starlark function that calls registered Go functions</span>
<span class="hljs-keyword">func</span> callGoFunc(thread *starlark.Thread, fn *starlark.Builtin, args starlark.Tuple, kwargs []starlark.Tuple) (starlark.Value, error) {
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) &lt; <span class="hljs-number">1</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;call_gofunc requires at least one argument (function name)&quot;</span>)
    }

    funcName, ok := args[<span class="hljs-number">0</span>].(starlark.String)
    <span class="hljs-keyword">if</span> !ok {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;first argument must be a string (function name)&quot;</span>)
    }

    goFunc, ok := GoFuncMap[<span class="hljs-keyword">string</span>(funcName)]
    <span class="hljs-keyword">if</span> !ok {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;function %s not found&quot;</span>, funcName)
    }

    <span class="hljs-comment">// Convert Starlark arguments to Go values</span>
    goArgs := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>{}, <span class="hljs-built_in">len</span>(args)<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">for</span> i, arg := <span class="hljs-keyword">range</span> args[<span class="hljs-number">1</span>:] {
        <span class="hljs-keyword">switch</span> v := arg.(<span class="hljs-keyword">type</span>) {
        <span class="hljs-keyword">case</span> starlark.Int:
            <span class="hljs-keyword">if</span> v, ok := v.Int64(); ok {
                goArgs[i] = <span class="hljs-keyword">int</span>(v)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;integer too large&quot;</span>)
            }
        <span class="hljs-keyword">case</span> starlark.Float:
            goArgs[i] = <span class="hljs-keyword">float64</span>(v)
        <span class="hljs-keyword">case</span> starlark.String:
            goArgs[i] = <span class="hljs-keyword">string</span>(v)
        <span class="hljs-keyword">case</span> starlark.Bool:
            goArgs[i] = <span class="hljs-keyword">bool</span>(v)
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;unsupported argument type: %T&quot;</span>, arg)
        }
    }

    <span class="hljs-comment">// Call the Go function</span>
    <span class="hljs-keyword">switch</span> f := goFunc.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-keyword">func</span>(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>) <span class="hljs-keyword">int</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(goArgs) != <span class="hljs-number">2</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;Add function requires exactly 2 arguments&quot;</span>)
        }
        a, ok1 := goArgs[<span class="hljs-number">0</span>].(<span class="hljs-keyword">int</span>)
        b, ok2 := goArgs[<span class="hljs-number">1</span>].(<span class="hljs-keyword">int</span>)
        <span class="hljs-keyword">if</span> !ok1 || !ok2 {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;Add function requires integer arguments&quot;</span>)
        }
        result := f(a, b)
        <span class="hljs-keyword">return</span> starlark.MakeInt(result), <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;unsupported function type: %T&quot;</span>, goFunc)
    }
}

<span class="hljs-keyword">func</span> main() {
    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-comment">// Create a new Starlark thread</span>
        thread := &amp;starlark.Thread{
            Name: <span class="hljs-string">&quot;repl&quot;</span>,
            Print: <span class="hljs-keyword">func</span>(thread *starlark.Thread, msg <span class="hljs-keyword">string</span>) {
                fmt.Println(msg)
            },
        }

        <span class="hljs-comment">// Create a new global environment with call_gofunc</span>
        globals := starlark.StringDict{
            <span class="hljs-string">&quot;call_gofunc&quot;</span>: starlark.NewBuiltin(<span class="hljs-string">&quot;call_gofunc&quot;</span>, callGoFunc),
        }

        <span class="hljs-comment">// Create a scanner for reading input</span>
        scanner := bufio.NewScanner(os.Stdin)
        fmt.Println(<span class="hljs-string">&quot;Starlark REPL (type &apos;exit&apos; to quit)&quot;</span>)
        fmt.Println(<span class="hljs-string">&quot;Example1: starlark exprs and stmts&quot;</span>)
        fmt.Println(<span class="hljs-string">&quot;Example2: call_gofunc(&apos;Add&apos;, 1, 2)&quot;</span>)

        errExit := errors.New(<span class="hljs-string">&quot;exit&quot;</span>)

        <span class="hljs-keyword">for</span> {
            <span class="hljs-comment">// Print prompt</span>
            fmt.Print(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)

            <span class="hljs-comment">// Read input</span>
            readline := <span class="hljs-keyword">func</span>() ([]<span class="hljs-keyword">byte</span>, error) {
                ...
            }

            <span class="hljs-comment">// Execute the input</span>
            <span class="hljs-keyword">if</span> err := rep(readline, thread, globals); err != <span class="hljs-literal">nil</span> {
                ...
            }
        }
    }()

    <span class="hljs-keyword">select</span> {}
}
</code></pre>
<h3 id="integrating-starlark-into-the-debugger">Integrating Starlark into the Debugger</h3>
<p>go-delve/delve integrates Starlark and uses the method described in this article to support calling certain internal debugger functions, such as:</p>
<pre><code class="lang-go"><span class="hljs-comment">//go:generate go run ../../../_scripts/gen-starlark-bindings.go go ./starlark_mapping.go</span>
<span class="hljs-keyword">const</span> (
    dlvCommandBuiltinName        = <span class="hljs-string">&quot;dlv_command&quot;</span>
    readFileBuiltinName          = <span class="hljs-string">&quot;read_file&quot;</span>
    writeFileBuiltinName         = <span class="hljs-string">&quot;write_file&quot;</span>
    commandPrefix                = <span class="hljs-string">&quot;command_&quot;</span>
    dlvContextName               = <span class="hljs-string">&quot;dlv_context&quot;</span>
    curScopeBuiltinName          = <span class="hljs-string">&quot;cur_scope&quot;</span>
    defaultLoadConfigBuiltinName = <span class="hljs-string">&quot;default_load_config&quot;</span>
    helpBuiltinName              = <span class="hljs-string">&quot;help&quot;</span>
)
</code></pre>
<p>For example, let&apos;s look at the following Go program and use go-delve/delve for automated debugging:</p>
<p>file: main.go (line numbers are preserved here to correspond with the starlark script)</p>
<pre><code class="lang-go">     <span class="hljs-number">1</span> <span class="hljs-keyword">package</span> main                                                                                                        
     <span class="hljs-number">2</span> 
     <span class="hljs-number">3</span> <span class="hljs-keyword">import</span> (
     <span class="hljs-number">4</span>     <span class="hljs-string">&quot;fmt&quot;</span>
     <span class="hljs-number">5</span>     <span class="hljs-string">&quot;time&quot;</span>
     <span class="hljs-number">6</span> )
     <span class="hljs-number">7</span> 
     <span class="hljs-number">8</span> <span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
     <span class="hljs-number">9</span>     Name <span class="hljs-keyword">string</span>
    <span class="hljs-number">10</span>     Age  <span class="hljs-keyword">int</span>
    <span class="hljs-number">11</span> }
    <span class="hljs-number">12</span> 
    <span class="hljs-number">13</span> <span class="hljs-keyword">func</span> main() {
    <span class="hljs-number">14</span>     people := []Person{
    <span class="hljs-number">15</span>         {Name: <span class="hljs-string">&quot;Alice&quot;</span>, Age: <span class="hljs-number">25</span>},
    <span class="hljs-number">16</span>         {Name: <span class="hljs-string">&quot;Bob&quot;</span>, Age: <span class="hljs-number">30</span>},
    <span class="hljs-number">17</span>         {Name: <span class="hljs-string">&quot;Charlie&quot;</span>, Age: <span class="hljs-number">35</span>},
    <span class="hljs-number">18</span>     }
    <span class="hljs-number">19</span> 
    <span class="hljs-number">20</span>     <span class="hljs-keyword">for</span> i, p := <span class="hljs-keyword">range</span> people {
    <span class="hljs-number">21</span>         fmt.Printf(<span class="hljs-string">&quot;Processing person %d: %s\n&quot;</span>, i, p.Name)
    <span class="hljs-number">22</span>         time.Sleep(time.Second) <span class="hljs-comment">// &#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x5EF6;&#x8FDF;&#x4EE5;&#x4FBF;&#x4E8E;&#x8C03;&#x8BD5;</span>
    <span class="hljs-number">23</span>         processPerson(p)
    <span class="hljs-number">24</span>     }
    <span class="hljs-number">25</span> }
    <span class="hljs-number">26</span> 
    <span class="hljs-number">27</span> <span class="hljs-keyword">func</span> processPerson(p Person) {
    <span class="hljs-number">28</span>     fmt.Printf(<span class="hljs-string">&quot;Name: %s, Age: %d\n&quot;</span>, p.Name, p.Age)
    <span class="hljs-number">29</span> }
</code></pre>
<p>Starlark automated debugging script:</p>
<p>file: debug.star</p>
<pre><code class="lang-starlark"># Define a function to print current scope information
def print_scope():
    scope = cur_scope()
    print(&quot;Current scope:&quot;, scope)
    dlv_command(&quot;locals&quot;)

# Define a function to set breakpoints and execute debug commands
def debug_person():
    # Print current scope
    print_scope()

    # Print value of variable p
    dlv_command(&quot;print p&quot;)

    # Single step execution
    dlv_command(&quot;next&quot;)

    # Print scope again
    print_scope()

# Define a function to save debug information to file
def save_debug_info():
    # Get current scope
    scope = cur_scope()

    # Write debug info to file
    debug_info = &quot;Debug session at &quot; + str(time.time()) + &quot;\n&quot;
    debug_info += &quot;Current scope: &quot; + str(scope) + &quot;\n&quot;

    # Save to file
    write_file(&quot;debug_info.txt&quot;, debug_info)

# Main function
def main():
    print(&quot;Starting debug session...&quot;)

    # Set breakpoints
    dlv_command(&quot;break main.main&quot;)
    dlv_command(&quot;break main.processPerson&quot;)

    # Continue to main.main
    dlv_command(&quot;continue&quot;)

    # Continue to main.processPerson
    dlv_command(&quot;continue&quot;)

    # Execute debug operations
    debug_person()

    # Save debug information
    save_debug_info()

    print(&quot;Debug session completed.&quot;)

# Directly call main function (source command will automatically call the defined &apos;main&apos; function)
#main()
</code></pre>
<p>Run the debugger with <code>dlv debug main.go</code>, and once the debug session is ready, execute <code>source debug.star</code>.</p>
<pre><code class="lang-bash">$ tinydbg debug main.go
Type <span class="hljs-string">&apos;help&apos;</span> <span class="hljs-keyword">for</span> list of commands.
(dlv) <span class="hljs-built_in">source</span> debug.star
Starting debug session...
Breakpoint 1 <span class="hljs-built_in">set</span> at 0x49d0f6 <span class="hljs-keyword">for</span> main.main() ./main.go:13
Breakpoint 2 <span class="hljs-built_in">set</span> at 0x49d40e <span class="hljs-keyword">for</span> main.processPerson() ./main.go:27
&gt; [Breakpoint 1] main.main() ./main.go:13 (hits goroutine(1):1 total:1) (PC: 0x49d0f6)
     8: <span class="hljs-built_in">type</span> Person struct {
     9:         Name string
    10:         Age  int
    11: }
    12:
=&gt;  13: func <span class="hljs-function"><span class="hljs-title">main</span></span>() {
    14:         people := []Person{
    15:                 {Name: <span class="hljs-string">&quot;Alice&quot;</span>, Age: 25},
    16:                 {Name: <span class="hljs-string">&quot;Bob&quot;</span>, Age: 30},
    17:                 {Name: <span class="hljs-string">&quot;Charlie&quot;</span>, Age: 35},
    18:         }
Processing person 0: Alice
&gt; [Breakpoint 2] main.processPerson() ./main.go:27 (hits goroutine(1):1 total:1) (PC: 0x49d40e)
    22:                 time.Sleep(time.Second) // Add some delay to <span class="hljs-built_in">help</span> with debugging
    23:                 processPerson(p)
    24:         }
    25: }
    26:
=&gt;  27: func processPerson(p Person) {
    28:         fmt.Printf(<span class="hljs-string">&quot;Name: %s, Age: %d\n&quot;</span>, p.Name, p.Age)
    29: }
Current scope: api.EvalScope{GoroutineID:-1, Frame:0, DeferredCall:0}
(no locals)
main.Person {Name: <span class="hljs-string">&quot;Alice&quot;</span>, Age: 25}
&gt; main.processPerson() ./main.go:28 (PC: 0x49d42a)
    23:                 processPerson(p)
    24:         }
    25: }
    26:
    27: func processPerson(p Person) {
=&gt;  28:         fmt.Printf(<span class="hljs-string">&quot;Name: %s, Age: %d\n&quot;</span>, p.Name, p.Age)
    29: }
Current scope: api.EvalScope{GoroutineID:-1, Frame:0, DeferredCall:0}
(no locals)
Debug session completed.
</code></pre>
<p>tinydbg currently retains the Starlark implementation from go-delve/delve, with pkg/terminal/starlark.go + pkg/terminal/starlark_test.go containing about 300 lines of code, and starbind/ containing nearly 3000 lines of code, though this part is auto-generated by scripts. Since this code is relatively self-contained and doesn&apos;t affect many areas like ebpf-based tracing does, we&apos;ve decided to keep this code for now. You can find the source code and star scripts used in the above tests in the tinydbg/examples/starlark_demo directory.</p>
<h3 id="summary">Summary</h3>
<p>I first learned about the Starlark language while studying bazelbuild, and gained a deeper understanding of it while learning go-delve/delve. If we are writing a tool or analysis tool and want to expose our underlying capabilities to allow users to freely exercise their creativity, such as how go-delve/delve enables users to perform automated debugging as needed, we can integrate the Starlark interpreter engine into our program. Then through some glue code connecting Starlark with our program, we can enable the Starlark interpreter to call Starlark functions to execute functions defined in our program. This undoubtedly unleashes our program&apos;s underlying capabilities, allowing users to further explore and utilize them while maintaining controlled access to those low-level capabilities.</p>
<p>This article demonstrates how to easily integrate Starlark into your Go program. For more usage of Starlark, please refer to <a href="https://github.com/bazelbuild/starlark" target="_blank">bazelbuild/starlark</a>.</p>
<p>The article also introduces debugger integration with Starlark and usage examples. When you need automated testing or want to share your debugging sessions, you can achieve this through this approach.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: 9.3 Advanced Feature Extensions">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="101-howto_tracing_via_ebpf.html" class="navigation navigation-next " aria-label="Next page: 9.3.101 Tracing with eBPF">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"9.3.100 Integrating starlark","level":"1.9.3.1","depth":3,"next":{"title":"9.3.101 Tracing with eBPF","level":"1.9.3.2","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.md","ref":"9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.md","articles":[]},"previous":{"title":"9.3 Advanced Feature Extensions","level":"1.9.3","depth":2,"path":"9-develop-sym-debugger/3-高级功能扩展/README.md","ref":"9-develop-sym-debugger/3-高级功能扩展/README.md","articles":[{"title":"9.3.100 Integrating starlark","level":"1.9.3.1","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.md","ref":"9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.md","articles":[]},{"title":"9.3.101 Tracing with eBPF","level":"1.9.3.2","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.md","ref":"9-develop-sym-debugger/3-高级功能扩展/101-howto_tracing_via_ebpf.md","articles":[]},{"title":"9.3.102 Implementing Syntax Highlighting","level":"1.9.3.3","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.md","ref":"9-develop-sym-debugger/3-高级功能扩展/102-howto_syntax_highlight.md","articles":[]},{"title":"9.3.103 Implementing Paged Output","level":"1.9.3.4","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.md","ref":"9-develop-sym-debugger/3-高级功能扩展/103-howto_paging_output.md","articles":[]},{"title":"9.3.104 Reading Separately Stored DWARF Data","level":"1.9.3.5","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.md","ref":"9-develop-sym-debugger/3-高级功能扩展/104-howto_read_separate_dwarfdata.md","articles":[]},{"title":"9.3.105 Automatic Source File Path Mapping","level":"1.9.3.6","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.md","ref":"9-develop-sym-debugger/3-高级功能扩展/105-howto_guess_substitutepath.md","articles":[]},{"title":"9.3.106 Implementing Target Process IO Redirection","level":"1.9.3.7","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.md","ref":"9-develop-sym-debugger/3-高级功能扩展/106-howto_redirect_target_io.md","articles":[]},{"title":"9.3.107 Supporting User Preferences","level":"1.9.3.8","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.md","ref":"9-develop-sym-debugger/3-高级功能扩展/107-howto_customize_tinydbg.md","articles":[]},{"title":"9.3.108 Supporting Multi-client Debug Mode","level":"1.9.3.9","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.md","ref":"9-develop-sym-debugger/3-高级功能扩展/108-howto_accept_multiclient.md","articles":[]},{"title":"9.3.109 Supporting Debug Activity Logging","level":"1.9.3.10","depth":3,"path":"9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.md","ref":"9-develop-sym-debugger/3-高级功能扩展/109-howto_transcript_debugging.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["md-toc"],"pluginsConfig":{"intopic-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true,"label":{"en":"In This Article","zh":"本文目录"}},"md-toc":{"label":"In this article","selector":".markdown-section h2","visible":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"9-develop-sym-debugger/3-高级功能扩展/100-howto_integrate_starlark.md","mtime":"2025-06-15T12:07:46.870Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-06-15T18:01:33.391Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-md-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

